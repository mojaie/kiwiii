// https://github.com/mojaie/kiwiii Version 1.0.0-alpha.6. Copyright 2020 Seiji Matsuoka.
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("lodash"),require("d3"),require("jLouvain")):"function"==typeof define&&define.amd?define(["lodash","d3","jLouvain"],t):e.networkApp=t(e._,e.d3,e.jLouvain)}(this,function(e,t,o){"use strict";const n=!1;e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,o=o&&o.hasOwnProperty("default")?o.default:o;var s={URLQuery:function(){const t=window.location.search.substring(1).split("&").map(e=>e.split("="));return e.fromPairs(t)},compatibility:function(){if(!window.indexedDB)return"Client compatibility error: IndexedDB not supported"},registerServiceWorker:function(){"serviceWorker"in navigator?n?console.info("Service worker is disabled for debugging"):window.addEventListener("load",()=>{navigator.serviceWorker.register("../sw.js")}):console.info("Service worker is not supported")},registerCtrlCommand:function(e,t){document.addEventListener("keydown",o=>{o.ctrlKey&&o.key===e&&t()})}};var l={sortType:function(e){return["numeric","d3_format"].includes(e)?"numeric":["text","compound_id","assay_id","list"].includes(e)?"text":["text_field","checkbox","html"].includes(e)?"html":"none"},formatNum:function(e,o){return void 0===e||null===e||Number.isNaN(e)?"":e==parseFloat(e)?t.format(o)(e):e},partialMatch:function(e,t){return void 0!==t&&null!==t&&""!==t&&-1!==t.toString().toUpperCase().indexOf(e.toString().toUpperCase())},uuidv4:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}};const a={Queued:"ready","In progress":"running",Aborting:"running",Aborted:"aborted",Completed:"done",Failure:"failure"},r={datatable:"nodes",connection:"edges"};function c(e){const t=e.columns.map(e=>("numeric"===e.sort?e.format="numeric":"text"===e.sort?e.format="text":"none"===e.sort&&(e.format="raw"),e));return{id:e.id,name:e.name,dataType:r[e.format],schemaVersion:.8,revision:0,status:a[e.status],fields:t,records:e.records,query:e.query,taskCount:e.searchCount,doneCount:e.searchDoneCount|e.searchCount,resultCount:e.recordCount,progress:100|e.progress,execTime:e.execTime,created:e.startDate|e.responseDate}}function i(e){return{id:e.id,name:e.name,dataType:e.dataType,schemaVersion:"0.10",revision:e.revision,status:e.status,fields:e.fields,records:e.records,query:e.query,progress:e.progress,execTime:e.execTime,created:e.created,reference:{}}}function d(e){let o=e;return o.edges.hasOwnProperty("schemaVersion")||o.edges.hasOwnProperty("$schema")||(o.nodes=c(o.nodes),o.edges=function(e,t){const o={fieldTransform:e.snapshot.fieldTransform,nodePositions:e.snapshot.nodePositions,nodeColor:{},nodeSize:{},nodeLabel:{},edge:{}};return e.snapshot.hasOwnProperty("nodeColor")?(o.nodeColor.id=e.snapshot.nodeColor.id,o.nodeColor.scale=e.snapshot.nodeColor.scale,o.nodeColor.field=t.find(t=>t.key===e.snapshot.nodeColor.column)):o.nodeColor={id:"color",field:t[0],scale:{scale:"linear",domain:[0,1],range:["black","white"],unknown:"gray"}},e.snapshot.hasOwnProperty("nodeSize")?(o.nodeSize.id=e.snapshot.nodeSize.id,o.nodeSize.scale=e.snapshot.nodeSize.scale,o.nodeSize.field=t.find(t=>t.key===e.snapshot.nodeSize.column)):o.nodeSize={id:"size",field:t[0],scale:{scale:"linear",domain:[0,1],range:[20,20],unknown:20}},e.snapshot.hasOwnProperty("nodeLabel")?(o.nodeLabel.id=e.snapshot.nodeLabel.id,o.nodeLabel.size=e.snapshot.nodeLabel.size,o.nodeLabel.text=e.snapshot.nodeLabel.text,o.nodeLabel.visible=e.snapshot.nodeLabel.visible,o.nodeLabel.scale=e.snapshot.nodeLabel.scale,o.nodeLabel.field=t.find(t=>t.key===e.snapshot.nodeLabel.column)):o.nodeLabel={id:"label",size:12,text:"index",visible:!1,field:t[0],scale:{scale:"linear",domain:[0,1],range:["black","white"],unknown:"gray"}},e.snapshot.hasOwnProperty("nodeContent")?o.nodeContent=e.snapshot.nodeContent:o.nodeContent={structure:{visible:!1}},e.snapshot.hasOwnProperty("edge")?o.edge=e.snapshot.edge:o.edge={id:"label",label:{size:10,visible:!1},visible:!0,scale:{scale:"linear",domain:[0,1],range:[5,5],unknown:5}},{id:e.id,name:e.name,dataType:r[e.format],schemaVersion:.8,revision:0,reference:{nodes:e.nodeTableId},status:a[e.status],fields:[{key:"source"},{key:"target"},{key:"weight"}],records:e.records,query:e.query,networkThreshold:e.networkThreshold,taskCount:e.searchCount,doneCount:e.searchDoneCount|e.searchCount,resultCount:e.recordCount,progress:100|e.progress,execTime:e.execTime,created:e.startDate|e.responseDate,snapshot:o}}(o.edges,o.nodes.fields)),"0.8"!=o.edges.schemaVersion&&.1!==o.edges.schemaVersion||((o=function(e){if(e.edges.hasOwnProperty("reference")||(e.edges.reference={nodes:e.edges.nodesID}),e.nodes.fields.find(e=>"_index"===e.key)){const t={};e.nodes.records.forEach((e,o)=>{e.index=o,e.structure=e._structure,t[e._index]=e.index,delete e._index,delete e._structure}),e.edges.records.forEach(e=>{e.source=t[e.source],e.target=t[e.target]}),e.nodes.fields.forEach(e=>{"_index"===e.key&&(e.key="index"),"_structure"===e.key&&(e.key="structure"),"numeric"===e.sort&&(e.format="numeric"),"text"===e.sort&&(e.format="text"),"none"===e.sort&&(e.format="raw")})}return e}(o)).nodes=i(o.nodes),o.edges=function(e){const o={networkThreshold:e.networkThreshold};return o.nodeContentVisible=e.snapshot.nodeContent.structure.visible,o.nodeColor=e.snapshot.nodeColor.scale||{},o.nodeColor.field&&(o.nodeColor.field=e.snapshot.nodeColor.field.key,"_index"===o.nodeColor.field&&(o.nodeColor.field="index")),"ordinal"===o.nodeColor.scale&&(o.nodeColor.range=t.schemeCategory20),o.nodeSize=e.snapshot.nodeSize.scale||{},e.snapshot.nodeSize.field&&(o.nodeSize.field=e.snapshot.nodeSize.field.key,"_index"===o.nodeSize.field&&(o.nodeSize.field="index")),o.nodeLabel={},e.snapshot.nodeLabel.text&&(o.nodeLabel.text=e.snapshot.nodeLabel.text.key,"_index"===o.nodeLabel.text&&(o.nodeLabel.text="index")),o.nodeLabel.size=e.snapshot.nodeLabel.size,o.nodeLabel.visible=e.snapshot.nodeLabel.visible,o.nodeLabelColor=e.snapshot.nodeLabel.scale||{},e.snapshot.nodeLabel.field&&(o.nodeLabelColor.field=e.snapshot.nodeLabel.field.key,"_index"===o.nodeLabelColor.field&&(o.nodeLabelColor.field="index")),"ordinal"===o.nodeLabelColor.scale&&(o.nodeLabelColor.range=t.schemeCategory20),o.edgeVisible=e.snapshot.edge.visible,o.edgeWidth=e.snapshot.edge.scale||{},o.edgeLabel={},o.edgeLabel.size=e.snapshot.edge.label.size,o.edgeLabel.visible=e.snapshot.edge.label.visible,o.networkThreshold=e.networkThreshold||e.query.threshold,o.coords=e.snapshot.nodePositions,{id:e.id,name:e.name,dataType:e.dataType,schemaVersion:"0.10",revision:e.revision,status:e.status,fields:e.fields,records:e.records,query:{params:e.query},progress:e.progress,execTime:e.execTime,created:e.created,snapshot:o,reference:e.reference}}(o.edges)),o.edges.hasOwnProperty("$schema")||(delete o.nodes.schemaVersion,delete o.edges.schemaVersion,delete o.nodes.revision,delete o.edges.revision,o.nodes.$schema="https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json",o.edges.$schema="https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json"),o}var u={convertPackage:function(e){let t={};if(e.hasOwnProperty("views"))t=e;else{const o=new Date,n=e.hasOwnProperty("edges"),s=n?d(e):function(e){let t=e;return t.hasOwnProperty("schemaVersion")||t.hasOwnProperty("$schema")||(t=c(t)),"0.8"==t.schemaVersion&&(t=i(t=function(e){return e.records.forEach((e,t)=>{e.index=t,e.structure=e._structure,delete e._index,delete e._structure}),e.fields.forEach(e=>{"_index"===e.key&&(e.key="index"),"_structure"===e.key&&(e.key="structure"),"numeric"===e.sort&&(e.format="numeric"),"text"===e.sort&&(e.format="text"),"none"===e.sort&&(e.format="raw")}),e}(t))),t.hasOwnProperty("$schema")||(delete t.schemaVersion,delete t.revision,t.$schema="https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json"),t.fields.forEach(e=>{"structure"===e.key&&(e.format="svg"),delete e.width,delete e.height}),t}(e),l=n?s.nodes:s;(t={$schema:"https://mojaie.github.io/kiwiii/specs/package_v1.0.json",name:s.edges.name,views:[],dataset:[]}).dataset.push({$schema:"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json",collectionID:l.id,name:l.name,contents:[{$schema:l.$schema,workflowID:l.reference.workflow,name:l.name,fields:l.fields,records:l.records,created:l.created,status:l.status,query:l.query,execTime:l.execTime,progress:l.progress}]}),t.views.push({$schema:"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json",viewID:l.id,name:l.name,viewType:"datagrid",rows:l.id,fields:l.fields,sortOrder:null,filterText:null,checkpoints:[{type:"convert",date:o.toString(),description:"converted from legacy format"}]}),n&&(t.dataset.push({$schema:"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json",collectionID:s.edges.id,name:s.edges.name,contents:[{$schema:s.edges.$schema,workflowID:s.edges.reference.workflow,name:s.edges.name,fields:s.edges.fields,records:s.edges.records,created:s.edges.created,status:s.edges.status,query:s.edges.query,execTime:s.edges.execTime,progress:s.edges.progress}]}),t.views.push({$schema:"https://mojaie.github.io/kiwiii/specs/network_v1.0.json",viewID:s.edges.id,name:s.edges.name,viewType:"network",nodes:l.id,edges:s.edges.id,nodeColor:s.edges.snapshot.nodeColor,nodeSize:s.edges.snapshot.nodeSize,nodeLabel:s.edges.snapshot.nodeLabel,nodeLabelColor:s.edges.snapshot.nodeLabelColor,edgeWidth:s.edges.snapshot.edgeWidth,edgeLabel:s.edges.snapshot.edgeLabel,networkThreshold:s.edges.snapshot.networkThreshold,networkThresholdCutoff:s.edges.snapshot.networkThresholdCutoff,fieldTransform:s.edges.snapshot.fieldTransform,coords:s.edges.snapshot.coords,checkpoints:[{type:"convert",date:o.toString(),description:"converted from legacy format"}]})),t.views.filter(e=>"network"===e.viewType).forEach(e=>{e.minConnThld=e.networkThresholdCutoff,e.currentConnThld=e.networkThreshold,e.hasOwnProperty("nodeLabel")&&(e.nodeLabel.field=e.nodeLabel.text),e.hasOwnProperty("edgeLabel")&&(e.edgeLabel.field="weight"),e.hasOwnProperty("edgeWidth")&&(e.edgeWidth.field="weight")})}return t.views.filter(e=>"network"===e.viewType).forEach(e=>{e.nodeColor.field||(e.nodeColor.field="index"),e.nodeSize.field||(e.nodeSize.field="index"),e.nodeLabel.field||(e.nodeLabel.field="index"),e.nodeLabelColor.field||(e.nodeLabelColor.field="index"),e.edgeColor?e.edgeColor.field||(e.edgeColor.field="weight"):e.edgeColor={field:"weight",color:"monogray",scale:"linear",domain:[0,1],range:["#999999","#999999"],unknown:"#cccccc"},e.edgeWidth.field||(e.edgeWidth.field="weight"),e.edgeLabel.field||(e.edgeLabel.field="weight"),e.edgeLabelColor?e.edgeLabelColor.field||(e.edgeLabelColor.field="weight"):e.edgeLabelColor={field:"weight",color:"monoblack",scale:"linear",domain:[1,1],range:["#333333","#333333"],unknown:"#cccccc"}}),t}};function p(e,t,o){return new Promise((n,s)=>{const l=window.indexedDB.open(e,t);l.onsuccess=function(){n(this.result)},l.onerror=(e=>s(e)),l.onupgradeneeded=(e=>{o(e.currentTarget.result)})})}const f={pkgs:p("Packages",2,e=>{e.createObjectStore("Packages",{keyPath:"id"})}),assets:p("Assets",1,e=>{e.createObjectStore("Assets",{keyPath:"key"})})};function m(e){return new Promise((t,o)=>f[e].then(e=>{const n=e.transaction(e.name,"readwrite").objectStore(e.name).clear();n.onsuccess=(()=>t()),n.onerror=(e=>o(e))}))}function h(){return new Promise(e=>{const t=[];return f.pkgs.then(o=>{o.transaction(o.name).objectStore(o.name).openCursor().onsuccess=(o=>{const n=o.target.result;n?(t.push(n.value),n.continue()):e(t)})})})}function g(e){return new Promise((t,o)=>f.pkgs.then(n=>{const s=n.transaction(n.name).objectStore(n.name).get(e);s.onsuccess=(e=>t(e.target.result)),s.onerror=(e=>o(e))}))}function y(e){return new Promise((t,o)=>f.pkgs.then(n=>{const s=n.transaction(n.name,"readwrite").objectStore(n.name).put(e);s.onerror=(e=>o(e)),s.onsuccess=(()=>t())}))}function b(e,t){return new Promise((o,n)=>f.pkgs.then(s=>{const l=s.transaction(s.name,"readwrite").objectStore(s.name),a=l.get(e);a.onerror=(e=>n(e)),a.onsuccess=(e=>{const s=e.target.result;t(s);const a=l.put(s);a.onsuccess=(()=>o()),a.onerror=(e=>n(e))})}))}var x={clear:m,clearAll:function(){return Promise.all([m("pkgs"),m("assets")])},getAllItems:h,getItem:g,updateItem:b,deleteItem:function(e){return new Promise((t,o)=>f.pkgs.then(n=>{const s=n.transaction(n.name,"readwrite").objectStore(n.name).delete(e);s.onerror=(e=>o(e)),s.onsuccess=(()=>t())}))},getView:function(e,t){return g(e).then(e=>e.views.find(e=>e.viewID===t))},appendView:function(e,t,o){return b(e,e=>{const n=e.views.findIndex(e=>e.viewID===t);e.views.splice(n+1,0,o)})},updateView:function(t,o,n){return b(t,t=>{const s=t.views.findIndex(e=>e.viewID===o);e.isFunction(n)?n(t.views[s]):t.views[s]=n})},deleteView:function(e,t){return b(e,e=>{const o=e.views.findIndex(e=>e.viewID===t);e.views.splice(o,1);const n={};e.dataset.forEach(e=>{n[e.collectionID]=0}),e.views.forEach(e=>{["rows","items","nodes","edges"].filter(t=>e.hasOwnProperty(t)).forEach(t=>{n[e[t]]+=1})}),Object.entries(n).forEach(t=>{if(!t[1]){const o=e.dataset.findIndex(e=>e.collectionID===t[0]);e.dataset.splice(o,1)}})})},getAllCollections:function(){return h().then(t=>e.flatten(t.map(e=>e.dataset.map(t=>(t.instance=e.id,t)))))},getCollection:function(e,t){return g(e).then(e=>e.dataset.find(e=>e.collectionID===t))},addCollection:function(e,t,o){return b(e,e=>{e.dataset.push(o)})},updateCollection:function(t,o,n){return b(t,t=>{const s=t.dataset.findIndex(e=>e.collectionID===o);e.isFunction(n)?n(t.dataset[s]):t.dataset[s]=n})},importItem:function(e){e=u.convertPackage(e);const t=new Date;return e.id=l.uuidv4().slice(0,8),e.sessionStarted=t.toString(),y(e)},newDatagrid:function(e){const t=(new Date).toLocaleString("en-GB",{timeZone:"Asia/Tokyo"}),o=l.uuidv4().slice(0,8),n=l.uuidv4().slice(0,8),s=e.workflowID.slice(0,8);return y({$schema:"https://mojaie.github.io/kiwiii/specs/package_v1.0.json",id:o,name:e.name,views:[{$schema:"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json",viewID:n,name:e.name,viewType:"datagrid",rows:s,checkpoints:[{type:"creation",date:t}]}],dataset:[{$schema:"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json",collectionID:s,name:e.name,contents:[e]}],sessionStarted:t}).then(()=>({instance:o,viewID:n}))},addDatagrid:function(e,t){const o=l.uuidv4().slice(0,8),n=t.workflowID.slice(0,8);return b(e,e=>{e.views.push({$schema:"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json",viewID:o,name:t.name,viewType:"datagrid",rows:n}),e.dataset.push({$schema:"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json",collectionID:n,name:t.name,contents:[t]})}).then(()=>o)},add384Tiles:function(e,t){const o=l.uuidv4().slice(0,8),n=t.workflowID.slice(0,8);return b(e,e=>{e.views.push({$schema:"https://mojaie.github.io/kiwiii/specs/tile_v1.0.json",viewID:o,name:`${t.name}_tiles`,viewType:"tile",items:n,rowCount:16,columnCount:24,chunksPerRow:10}),e.dataset.push({$schema:"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json",collectionID:n,name:t.name,contents:[t]})}).then(()=>o)},newNetwork:function(e,t,o,n){const s=l.uuidv4().slice(0,8),a=n.workflowID.slice(0,8);return b(e,e=>{e.views.push({$schema:"https://mojaie.github.io/kiwiii/specs/network_v1.0.json",viewID:s,name:`${o}_${n.name}`,viewType:"network",nodes:t,edges:a,minConnThld:n.query.params.threshold}),e.dataset.push({$schema:"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json",collectionID:a,name:n.name,contents:[n]})}).then(()=>s)},getAsset:function(e){return new Promise((t,o)=>f.assets.then(n=>{const s=n.transaction(n.name).objectStore(n.name).get(e);s.onsuccess=(e=>{const o=void 0===e.target.result?void 0:e.target.result.value;t(o)}),s.onerror=(e=>o(e))}))},putAsset:function(e,t){return new Promise((o,n)=>f.assets.then(s=>{const l=s.transaction(s.name,"readwrite").objectStore(s.name).put({key:e,value:t});l.onerror=(e=>n(e)),l.onsuccess=(()=>o())}))}};const v="../assets/",w="../assets/icon/";var k={badge:function(e){e.classed("badge",!0),e.append("img").classed("icon",!0).style("width","1.25rem").style("height","1.25rem"),e.append("span").classed("text",!0)},updateBadge:function(e,t,o,n){e.classed(`badge-${o}`,!0),e.select(".icon").attr("src",n?`${w}${n}.svg`:null),e.select(".text").text(t)},notify:function(e){e.style("opacity",0).style("display","inline").transition().duration(500).ease(t.easeLinear).style("opacity",1).transition().delay(3e3).duration(1e3).ease(t.easeLinear).style("opacity",0).on("end",function(){e.style("display","none")})},loadingCircle:function(e){e.style("display","none").append("img").attr("src",`${v}loading1.gif`).style("width","2rem").style("height","2rem")},alert:function(e){e.classed("alert",!0).classed("px-1",!0).classed("py-0",!0),e.append("img").classed("icon",!0).style("width","1.25rem").style("height","1.25rem"),e.append("span").classed("text",!0).style("font-size","75%")},updateAlert:function(e,t,o,n){e.classed(`alert-${o}`,!0),e.select(".icon").attr("src",n?`${w}${n}.svg`:null),e.select(".text").text(t)},invalidFeedback:function(e){e.classed("invalid-feedback",!0).style("display","none"),e.append("img").classed("icon",!0).attr("src",`${w}caution-salmon.svg`).style("width","1rem").style("height","1rem"),e.append("span").classed("invalid-msg",!0)},updateInvalidMessage:function(e,t){e.select(".invalid-msg").text(t)}};const C="../assets/icon/";var L={iconBaseURL:C,buttonBox:function(e,t,o){e.classed("form-group",!0).classed("mb-1",!0).append("button").classed("btn",!0).classed(`btn-${o}`,!0).classed("btn-sm",!0).text(t)},menuButton:function(e,t,o){e.classed("btn",!0).classed(`btn-${o}`,!0).classed("btn-sm",!0).classed("mr-1",!0).text(t)},menuButtonLink:function(e,t,o,n){e.classed("btn",!0).classed(`btn-${o}`,!0).classed("btn-sm",!0).classed("mr-1",!0).attr("role","button").attr("href","#"),e.append("img").attr("src",n?`${C}${n}.svg`:null).style("width","1.25rem").style("height","1.25rem"),e.append("span").style("vertical-align","middle").text(t)},menuModalLink:function(e,t,o,n,s){e.classed("btn",!0).classed(`btn-${n}`,!0).classed("btn-sm",!0).classed("mr-1",!0).attr("href","#").attr("role","button").attr("data-toggle","modal").attr("data-target",`#${t}`),e.append("img").attr("src",s?`${C}${s}.svg`:null).style("width","1.25rem").style("height","1.25rem"),e.append("span").classed("label",!0).style("vertical-align","middle").text(o)},dropdownMenuButton:function(e,t,o,n){e.classed("btn-group",!0).classed("mr-1",!0);const s=e.append("button").classed("btn",!0).classed(`btn-${o}`,!0).classed("btn-sm",!0).classed("dropdown-toggle",!0).attr("data-toggle","dropdown");s.append("img").attr("src",n?`${C}${n}.svg`:null).style("width","1.25rem").style("height","1.25rem"),s.append("span").style("vertical-align","middle").text(t),e.append("div").classed("dropdown-menu",!0)},dropdownMenuItem:function(e,t,o){e.classed("dropdown-item",!0).attr("href","#"),e.append("img").attr("src",o?`${C}${o}.svg`:null).classed("mr-1",!0).style("width","2rem").style("height","2rem"),e.append("span").text(t)},dropdownMenuModal:function(e,t,o,n){e.classed("dropdown-item",!0).attr("href","#").attr("data-toggle","modal").attr("data-target",`#${o}`),e.append("img").attr("src",`${C}${n}.svg`).classed("mr-1",!0).style("width","2rem").style("height","2rem"),e.append("span").text(t)},dropdownMenuFile:function(e,o,n,s){e.classed("dropdown-item",!0).attr("href","#").on("click",function(){t.select(this).select("input").node().click()}),e.append("form").style("display","none").append("input").attr("type","file").attr("accept",n),e.append("img").attr("src",`${C}${s}.svg`).classed("mr-1",!0).style("width","2rem").style("height","2rem"),e.append("span").text(o)},dropdownMenuFileValue:function(e){return e.select("input").node().files[0]}};function B(e,t){e.classed("modal",!0).attr("tabindex",-1).attr("role","dialog").attr("aria-labelledby","").attr("aria-hidden",!0).attr("id",t),e.append("div").classed("modal-dialog",!0).attr("role","document").append("div").classed("modal-content",!0)}var V={confirmDialog:function(e,t){const o=e.call(B,t).select(".modal-content");o.append("div").classed("modal-body",!0).append("div").classed("message",!0);const n=o.append("div").classed("modal-footer",!0);n.append("button").classed("btn",!0).classed("btn-outline-secondary",!0).classed("cancel",!0).attr("type","button").attr("data-dismiss","modal").text("Cancel"),n.append("button").classed("btn",!0).classed("btn-warning",!0).classed("ok",!0).attr("type","button").attr("data-dismiss","modal").text("OK").on("click",()=>{e.dispatch("submit")})},updateConfirmDialog:function(e,t){e.select(".message").text(t)},submitDialog:function(e,t,o){const n=e.call(B,t).select(".modal-content"),s=n.append("div").classed("modal-header",!0);s.append("h4").classed("modal-title",!0).text(o),s.append("button").attr("type","button").attr("data-dismiss","modal").attr("aria-label","Close").classed("close",!0).append("span").attr("aria-hidden",!0).html("&times;"),n.append("div").classed("modal-body",!0),n.append("div").classed("modal-footer",!0).append("button").classed("btn",!0).classed("btn-primary",!0).classed("submit",!0).attr("type","button").attr("data-dismiss","modal").text("Submit").on("click",()=>{$(`#${t}`).modal("hide"),e.dispatch("submit")})}};const T=[{key:"monoblack",type:"monocolor",colors:["#333333"],unknown:"#333333"},{key:"monogray",type:"monocolor",colors:["#cccccc"],unknown:"#cccccc"},{key:"nodeDefault",type:"monocolor",colors:["#7fffd4"],unknown:"#7fffd4"},{key:"aquamarine",type:"bicolor",colors:["#778899","#7fffd4"],unknown:"#f0f0f0"},{key:"chartreuse",type:"bicolor",colors:["#778899","#7fff00"],unknown:"#f0f0f0"},{key:"salmon",type:"bicolor",colors:["#778899","#fa8072"],unknown:"#f0f0f0"},{key:"violet",type:"bicolor",colors:["#778899","#ee82ee"],unknown:"#f0f0f0"},{key:"temperature",type:"tricolor",colors:["#87ceeb","#fff5ee","#fa8072"],unknown:"#f0f0f0"},{key:"spectrum",type:"tricolor",colors:["#6495ed","#ccff66","#ffa500"],unknown:"#f0f0f0"},{key:"category10",type:"categorical",colors:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5"],unknown:"#f0f0f0"},{key:"cbsafe",type:"categorical",colors:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],unknown:"#f0f0f0"},{key:"category20",type:"categorical",colors:t.schemePaired.concat(t.schemeSet2),unknown:"#f0f0f0"},{key:"category40",type:"categorical",colors:t.schemePaired.concat(t.schemePastel2,t.schemeSet2,t.schemeSet3),unknown:"#f0f0f0"},{key:"custom",type:"custom",colors:["#ffffff"],text:"custom"}],S=[{key:"linear",name:"Linear",func:t.scaleLinear},{key:"log",name:"Log",func:t.scaleLog},{key:"quantize",name:"Quantize",func:t.scaleQuantize},{key:"ordinal",name:"Ordinal",func:t.scaleOrdinal}];var A={colorScales:T,types:S,scaleFunction:function(e){const t=T.find(t=>t.key===e.color);let o,n;t&&"custom"!==t.key?(o=t.colors,n=t.unknown):(o=e.range,n=e.unknown);let s=null;if(3===o.length){const t=(parseFloat(e.domain[0])+parseFloat(e.domain[1]))/2;s=[e.domain[0],t,e.domain[1]]}else s=e.domain;let l=S.find(t=>t.key===e.scale).func();return l=(l=l.domain(s)).range(o),["linear","log"].includes(e.scale)&&(l=l.clamp(!0)),t=>{if(""===t||void 0===t||null===t)return n;if(["linear","log"].includes(e.scale)&&parseFloat(t)!=t)return n;if("log"===e.scale&&t<=0)return n;const o=l(t);return void 0===o?n:o}},isD3Format:function(e){try{t.format(e)}catch(e){return!1}return!0}};function N(e,t,o){const n=e.append("g");n.append("rect").attr("x",0).attr("y",0).attr("width",100).attr("height",10).attr("fill",t[0]),n.append("text").attr("text-anchor","middle").attr("x",50).attr("y",10).attr("font-size",12).text(o)}var I={colorBar:{monocolor:N,bicolor:function(e,t,o){const n=l.uuidv4().slice(0,8);e.call(N,t,o);const s=e.append("defs").append("linearGradient").attr("id",n);s.append("stop").attr("offset",0).attr("stop-color",t[0]),s.append("stop").attr("offset",1).attr("stop-color",t[1]),e.select("rect").attr("fill",`url(#${n})`)},tricolor:function(e,t,o){const n=l.uuidv4().slice(0,8);e.call(N,t,o);const s=e.append("defs").append("linearGradient").attr("id",n);s.append("stop").attr("offset",0).attr("stop-color",t[0]),s.append("stop").attr("offset",.5).attr("stop-color",t[1]),s.append("stop").attr("offset",1).attr("stop-color",t[2]),e.select("rect").attr("fill",`url(#${n})`)},categorical:function(e,t,o){const n=100/t.length,s=e.append("g");t.forEach((e,o)=>{s.append("rect").attr("x",n*o).attr("y",0).attr("width",n).attr("height",10).attr("fill",t[o])}),s.append("text").attr("text-anchor","middle").attr("x",50).attr("y",10).attr("font-size",12).text(o)},custom:N},setSize:function(e,t,o){e.attr("width",t).attr("height",o)}};var z={colorBarLegend:function(e){e.append("rect").classed("bg",!0).attr("x",0).attr("y",0).attr("width",120).attr("height",50).attr("fill","white").attr("opacity",.9),e.append("text").classed("title",!0).attr("text-anchor","middle").attr("x",60).attr("y",15).style("font-size",12),e.append("g").classed("colorbar",!0).attr("transform","translate(10, 20)");const t=e.append("g").classed("label",!0).attr("transform","translate(10, 40)").style("font-size",12);t.append("text").classed("min",!0).attr("text-anchor","start").attr("x",0).attr("y",0),t.append("text").classed("max",!0).attr("text-anchor","end").attr("x",100).attr("y",0)},updateColorBarLegend:function(e,t){const o=A.colorScales.find(e=>e.key===t.color),n=I.colorBar[o.type],s="custom"===o.key?t.range:o.colors;e.select(".title").text(t.field),e.select(".colorbar").selectAll("g,defs").remove(),e.select(".colorbar").call(n,s),e.select(".min").attr("visibility",["bicolor","tricolor"].includes(o.type)?"inherit":"hidden").text(t.domain[0]),e.select(".max").attr("visibility",["bicolor","tricolor"].includes(o.type)?"inherit":"hidden").text(t.domain[1])},updateLegendGroup:function(e,t,o){const n=.2*t.right/120,s=o.split("-"),l=t.right,a=t.bottom,r=.2*l,c=50*r/120,i={left:r/10,right:l-r-r/10}[s[1]],d={top:c/10,bottom:a-c-c/10}[s[0]];e.attr("transform",`translate(${i}, ${d}) scale(${n})`)}};function j(e,t){const o=e.node(),n=o.offsetWidth,s=o.offsetHeight;e.select(".view").attr("viewBox",`0 0 ${n} ${s}`).select(".boundary").attr("width",n).attr("height",s),t.setViewBox(n,s),t.resizeNotifier()}var F={transform:function(e,t,o,n){e.select(".field").attr("transform",`translate(${t}, ${o}) scale(${n})`)},resize:j,viewFrame:function(e,t){e.style("width","100%").style("height","100%"),e.select(".view").remove(),e.append("svg").classed("view",!0),e.call(j,t)},view:function(e,t){e.attr("preserveAspectRatio","xMinYMin meet").attr("pointer-events","all").attr("viewBox",`0 0 ${t.viewBox.right} ${t.viewBox.bottom}`).style("width","100%").style("height","100%"),e.selectAll("g, rect").remove(),e.append("rect").classed("boundary",!0).attr("x",0).attr("y",0).attr("width",t.viewBox.right).attr("height",t.viewBox.bottom).attr("fill","#ffffff").attr("stroke-width",1).attr("stroke","#cccccc"),e.append("g").classed("field",!0).style("opacity",1e-6).transition().duration(1e3).style("opacity",1)}};function D(e){return e.select(".form-control").property("value")}function O(e){return e.select(".form-control").node().checkValidity()}function E(e,t){e.select(".invalid-feedback").style("display",t?"none":"inherit"),e.select(".form-control").style("background-color",t?null:"#ffcccc")}function P(e){return/\s*?\w\s*?/.test(D(e))}function M(e,t,o){e.classed("form-group",!0).classed("form-row",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).text(t),e.append("input").classed("form-control",!0).classed("form-control-sm",!0).classed("form-control-file",!0).classed("col-8",!0).attr("type","file").attr("accept",o).on("change",function(){const t=_(e);e.call(E,t)}),e.append("div").classed("col-4",!0),e.append("div").call(k.invalidFeedback).classed("col-8",!0)}function _(e){return e.select("input").property("files").length>0}var R={updateFormValue:function(e,t){e.select(".form-control").property("value",t),e.call(E,!0)},formValue:D,formValid:O,setValidity:E,textBox:function(e,t){e.classed("form-group",!0).classed("form-row",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).text(t),e.append("input").classed("form-control",!0).classed("form-control-sm",!0).classed("col-8",!0).attr("type","text").on("input",function(){const t=O(e);e.call(E,t)}),e.append("div").classed("col-4",!0),e.append("div").call(k.invalidFeedback).classed("col-8",!0)},readonlyBox:function(e,t){e.classed("form-group",!0).classed("form-row",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).text(t),e.append("input").classed("form-control-plaintext",!0).classed("form-control-sm",!0).classed("col-8",!0).attr("type","text").attr("readonly","readonly")},updateReadonlyValue:function(e,t){e.select(".form-control-plaintext").property("value",t)},readonlyValue:function(e){return e.select(".form-control-plaintext").property("value")},textareaBox:function(e,t,o,n){e.classed("form-group",!0).classed("form-row",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).text(t).append("div").call(k.invalidFeedback),e.append("textarea").classed("form-control",!0).classed("form-control-sm",!0).classed("col-8",!0).attr("rows",o).attr("placeholder",n).on("input",function(){const t=P(e);e.call(E,t)})},textareaBoxLines:function(e){const t=e.select("textarea").property("value");return t?t.split("\n").map(e=>e.replace(/^\s+|\s+$/g,"")).filter(e=>e.length>0):[]},textareaValid:P,numberBox:function(e,t){e.classed("form-group",!0).classed("form-row",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).text(t),e.append("input").classed("form-control",!0).classed("form-control-sm",!0).classed("col-8",!0).attr("type","number").on("input",function(){const t=O(e);e.call(E,t)}),e.append("div").classed("col-4",!0),e.append("div").call(k.invalidFeedback).classed("col-8",!0)},updateNumberRange:function(e,t,o,n){e.select(".form-control").attr("min",t).attr("max",o).attr("step",n).dispatch("input",{bubbles:!0})},checkBox:function(e,t){const o=e.classed("form-group",!0).classed("form-row",!0).classed("form-check",!0).append("label").classed("form-check-label",!0).classed("col-form-label-sm",!0);o.append("input").classed("form-check-input",!0).attr("type","checkbox"),o.append("span").text(t)},updateCheckBox:function(e,t){e.select("input").property("checked",t)},checkBoxValue:function(e){return e.select("input").property("checked")},colorBox:function(e,o){e.classed("form-row",!0).classed("align-items-center",!0).on("change",()=>{t.event.stopPropagation()}),e.append("div").classed("form-group",!0).classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).classed("mb-1",!0).text(o),e.append("div").classed("form-group",!0).classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).classed("mb-1",!0).append("input").classed("form-control",!0).classed("form-control-sm",!0).attr("type","color")},fileInputBox:M,clearFileInput:function(e){const t=e.select("label").text(),o=e.select("input").attr("accept");e.selectAll("*").remove(),e.call(M,t,o)},fileInputValue:function(e){return e.select("input").property("files")[0]},fileInputValid:_};const q="community-dialog",W="Comunity detection";var G={menuLink:function(e){e.call(L.dropdownMenuModal,W,q,"menu-painting")},body:function(e){const t=e.call(V.submitDialog,q,W).select(".modal-body");t.append("div").classed("name",!0).call(R.textBox,"New name").select(".form-control").attr("required","required"),t.append("div").classed("nulliso",!0).call(R.checkBox,"Assign null to isolated nodes")},updateBody:function(e,o){e.select(".name").call(R.formValue,null).on("input",function(){const n=R.formValue(t.select(this)),s=!o.map(e=>e.key).includes(n);s||R.setValidity(t.select(this),!1);const l=s?"Please provide valid field name":`Key '${n}' already exsists`;t.select(this).call(k.updateInvalidMessage,l);const a=s&&R.formValid(t.select(this));e.select(".submit").property("disabled",!a)}),e.select(".nulliso").call(R.updateCheckBox,!0),e.select(".submit").property("disabled",!0)},value:function(e){return{name:R.formValue(e.select(".name")),nulliso:R.checkBoxValue(e.select(".nulliso"))}}};const U="rename-dialog",J="Rename";var H={menuLink:function(e){e.call(L.dropdownMenuModal,J,U,"menu-edittext")},body:function(e){const t=e.call(V.submitDialog,U,J).select(".modal-body").append("div").classed("rename",!0).call(R.textBox,"New name");t.select(".form-control").attr("required","required"),t.select(".invalid-feedback").call(k.updateInvalidMessage,"Please provide a valid name")},updateBody:function(e,o){e.select(".rename").call(R.updateFormValue,o).on("input",function(){const o=R.formValid(t.select(this));e.select(".submit").property("disabled",!o)}).dispatch("input")},value:function(e){return R.formValue(e.select(".rename"))}};const Q="../req/";function K(e,t={}){const o=Object.keys(t).length?`?query=${JSON.stringify(t)}`:"";return fetch(`${Q}${e}${o}`,{credentials:"include"}).then(e=>200!==e.status?Promise.reject(new Error(e.statusText)):Promise.resolve(e))}function Y(e){return e.json()}var X={get:K,json:Y,text:function(e){return e.text()},blob:function(e){return e.blob()},post:function(e,t){return fetch(`${Q}${e}`,{method:"POST",body:t,credentials:"include"}).then(e=>200!==e.status?Promise.reject(new Error(e.statusText)):Promise.resolve(e))},error:function(e){return console.error(e),null},serverStatus:function(){const e={};return K("server").then(Y).then(t=>{e.server=t}).then(()=>K("schema")).then(Y).then(t=>{e.schema=t}).then(()=>e)},batchRequest:function(e,t){const o=e.map((e,o)=>new Promise(n=>{setTimeout(()=>n(e()),o*t*1e3)}));return Promise.all(o)}};function Z(e){const t={};return Object.entries(e.mapping).forEach(e=>{t[e[0]]=[e[1]]}),{created:e.created,fields:[e.field],key:e.key,mapping:t}}var ee={singleToMulti:Z,mappingToTable:function(e){const t=e.hasOwnProperty("field")?Z(e):e;return{fields:[{key:t.key,format:"text"}].concat(t.fields),records:Object.entries(t.mapping).map(e=>{const o={};return o[t.key]=e[0],t.fields.forEach((t,n)=>{o[t.key]=e[1][n]}),o})}},tableToMapping:function(e,t,o=["index"]){const n={created:(new Date).toString(),fields:e.fields.filter(e=>e.key!==t).filter(e=>!o.includes(e.key)),key:t,mapping:{}};return e.records.forEach(e=>{n.mapping[e[t]]=n.fields.map(t=>e[t.key])}),n},csvToMapping:function(e){const t=e.split(/\n|\r|\r\n/),o=t.shift().split(","),n=o.shift(),s=new Date,l=[],a=[];o.forEach((e,t)=>{""!==e&&(l.push(t),a.push({key:e,format:"text"}))});const r={created:s.toString(),fields:a,key:n,mapping:{}};return t.forEach(e=>{const t=e.split(","),o=t.shift();r.mapping[o]=Array(l.length),l.forEach(e=>{r.mapping[o][e]=t[e]})}),r},apply:function(t,o){const n=o.hasOwnProperty("field")?Z(o):o;t.records.filter(e=>n.mapping.hasOwnProperty(e[n.key])).forEach(e=>{n.fields.forEach((t,o)=>{e[t.key]=n.mapping[e[n.key]][o]})}),t.fields=e(t.fields).concat(n.fields).uniqBy("key").value()}};class te{constructor(e){this.autoIndex="index",this.collectionID=e.collectionID||null,this.instance=e.instance||null,this.name=e.name||null,e.records?(this.contents=[e],this.fields=[]):(this.contents=e.contents,this.fields=e.fields||[]),this.contents.forEach(e=>{e.fields.forEach(e=>this.addField(e))})}addField(e){this.fields.find(t=>t.key===e.key)||(e.hasOwnProperty("name")||(e.name=e.key),e.hasOwnProperty("visible")||(e.visible=!0),e.hasOwnProperty("d3_format")&&(e.format="d3_format"),e.hasOwnProperty("format")||(e.format="raw"),this.fields.push(e))}updateFields(e){this.fields=[],e.forEach(e=>this.addField(e))}joinFields(e){this.contents.forEach(t=>{ee.apply(t,e)}),e.hasOwnProperty("fields")?e.fields.forEach(e=>this.addField(e)):this.addField(e.field)}apply(e){this.contents.forEach(t=>{t.records.forEach(t=>{e(t)})})}records(){return e.flatten(this.contents.map(e=>e.records))}fetch(e){const t=this.contents.filter(e=>["running","ready","interrupted","queued"].includes(e.status)).map(t=>{const o={id:t.workflowID,command:e};return X.get("progress",o).then(X.json).then(e=>x.updateCollection(this.instance,this.collectionID,t=>{const n=t.contents.findIndex(e=>e.workflowID===o.id);"failure"===e.status?t.contents[n].status="failure":t.contents[n]=e}))});return Promise.all(t).then(()=>x.getCollection(this.instance,this.collectionID)).then(e=>{this.contents=e.contents})}pull(){return this.fetch("pull")}abort(){return this.fetch("abort")}size(){return e.sum(this.contents.map(e=>e.records.length))}status(){return this.contents.some(e=>"interrupted"===e.status)?"interrupted":this.contents.some(e=>"running"===e.status)?"running":this.contents.some(e=>"queued"===e.status)?"queued":this.contents.some(e=>"ready"===e.status)?"ready":this.contents.some(e=>"aborted"===e.status)?"aborted":this.contents.some(e=>"failure"===e.status)?"failure":"done"}ongoing(){return["ready","queued","running","interrupted"].includes(this.status())}progress(){return e.min(this.contents.map(e=>e.progress))}execTime(){return e.sum(this.contents.map(e=>e.execTime))}export(){return{$schema:"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json",collectionID:this.collectionID,name:this.name,fields:this.fields,contents:this.contents}}}class oe{constructor(e,t,o){this.fieldWidth=e,this.fieldHeight=t,this.viewBox={top:0,right:this.fieldWidth,bottom:this.fieldHeight,left:0},this.focusArea={},this.focusAreaMargin=50,this.boundary={top:0,right:this.fieldWidth,bottom:this.fieldHeight,left:0},this.transform=o||{x:0,y:0,k:1},this.prevTransform={x:this.transform.x,y:this.transform.y,k:this.transform.k},this.resizeNotifier=(()=>{})}setFocusArea(){const e=this.transform.x,t=this.transform.y,o=this.transform.k,n=this.focusAreaMargin;this.focusArea.top=(this.viewBox.top-t)/o-n,this.focusArea.left=(this.viewBox.left-e)/o-n,this.focusArea.bottom=(this.viewBox.bottom-t)/o+n,this.focusArea.right=(this.viewBox.right-e)/o+n}setViewBox(e,t){this.viewBox.right=e,this.viewBox.bottom=t,this.setFocusArea()}setTransform(e,t,o){this.transform.x=e,this.transform.y=t,this.transform.k=o,this.setFocusArea()}fitTransform(){const e=this.viewBox.bottom,t=this.viewBox.right,o=t/e,n=this.boundary.bottom-this.boundary.top,s=this.boundary.right-this.boundary.left,l=o>=s/n,a=l?e/n:t/s,r=l?(t-s*a)/2:0,c=l?0:(e-n*a)/2,i=-this.boundary.left*a+r,d=-this.boundary.top*a+c;this.setTransform(i,d,a)}showTransform(){t.select("#debug-transform").text(JSON.stringify(this.transform))}showFocusArea(){t.select("#debug-focusarea").text(JSON.stringify(this.focusArea))}showViewBox(){t.select("#debug-viewbox").text(JSON.stringify(this.viewBox))}}class ne extends oe{constructor(e,t,o){super(1200,1200,e.fieldTransform),this.focusedViewThreshold=100,this.enableFocusedView=!0,this.focusedView=!1,this.overlookViewThreshold=500,this.enableOverlookView=!0,this.overlookView=!1,this.legendOrient="top-left",this.viewID=e.viewID||null,this.instance=e.instance||null,this.name=e.name,this.nodes=new te(t),this.edges=new te(o);this.nodeColor={field:"index",color:"nodeDefault",scale:"linear",domain:[0,1],range:["#7fffd4","#7fffd4"],unknown:"#7fffd4",legend:!0},Object.assign(this.nodeColor,e.nodeColor||{}),this.nodeSize={field:"index",scale:"linear",domain:[1,1],range:[40,40],unknown:40,legend:!1},Object.assign(this.nodeSize,e.nodeSize||{}),this.nodeLabel={field:"index",size:20,visible:!1},Object.assign(this.nodeLabel,e.nodeLabel||{}),this.nodeLabelColor={field:"index",color:"monoblack",scale:"linear",domain:[1,1],range:["#333333","#333333"],unknown:"#cccccc",legend:!1},Object.assign(this.nodeLabelColor,e.nodeLabelColor||{}),this.edgeColor={field:"weight",color:"monogray",scale:"linear",domain:[0,1],range:["#999999","#999999"],unknown:"#cccccc"},Object.assign(this.edgeColor,e.edgeColor||{}),this.edgeWidth={field:"weight",scale:"linear",domain:[.5,1],range:[10,10],unknown:1},Object.assign(this.edgeWidth,e.edgeWidth||{}),this.edgeLabel={field:"weight",size:12,visible:!1},Object.assign(this.edgeLabel,e.edgeLabel||{}),this.edgeLabelColor={field:"weight",color:"monoblack",scale:"linear",domain:[1,1],range:["#333333","#333333"],unknown:"#cccccc"},Object.assign(this.edgeLabelColor,e.edgeLabelColor||{}),this.connThldField=e.connThldField||"weight",this.minConnThld=e.minConnThld,this.currentConnThld=e.currentConnThld||e.minConnThld,this.coords=e.coords,this.forceActive=!this.coords,this.forceType=e.forceType||"aggregate",this.zoomListener=null,this.dragListener=null,this.updateAllNotifier=null,this.updateComponentNotifier=null,this.updateNodeNotifier=null,this.updateEdgeNotifier=null,this.updateNodeAttrNotifier=null,this.updateEdgeAttrNotifier=null,this.updateLegendNotifier=null,this.updateControlBoxNotifier=(()=>{}),this.updateInteractionNotifier=(()=>{}),this.fitNotifier=(()=>{}),this.setForceNotifier=(()=>{}),this.stickNotifier=(()=>{}),this.relaxNotifier=(()=>{}),this.restartNotifier=(()=>{}),this.tickCallback=(()=>{}),this.ns=null,this.es=null}updateWorkingCopy(){this.ns&&(this.coords=this.ns.map(e=>({x:e.x,y:e.y}))),this.ns=JSON.parse(JSON.stringify(this.nodes.records())),this.ns.forEach(e=>{e.adjacency=[]}),this.es=JSON.parse(JSON.stringify(this.edges.records())),this.es.forEach((e,t)=>{e.num=t,this.ns[e.source].adjacency.push([e.target,t]),this.ns[e.target].adjacency.push([e.source,t])}),this.coords&&this.setAllCoords(this.coords)}setBoundary(){const e=this.ns.map(e=>e.x),t=this.ns.map(e=>e.y);this.boundary.top=Math.min.apply(null,t),this.boundary.left=Math.min.apply(null,e),this.boundary.bottom=Math.max.apply(null,t),this.boundary.right=Math.max.apply(null,e)}setAllCoords(e){this.ns.forEach(t=>{t.x=e[t.index].x,t.y=e[t.index].y,t.adjacency.forEach(o=>{const n=o[0],s=o[1];t.index<n?(this.es[s].sx=e[t.index].x,this.es[s].sy=e[t.index].y):(this.es[s].tx=e[t.index].x,this.es[s].ty=e[t.index].y)})}),this.setBoundary()}setCoords(e,t,o){this.ns[e].x=t,this.ns[e].y=o,this.ns[e].adjacency.forEach(n=>{const s=n[0],l=n[1];e<s?(this.es[l].sx=t,this.es[l].sy=o):(this.es[l].tx=t,this.es[l].ty=o)}),this.setBoundary()}nodesToRender(){return this.ns.filter(e=>e.y>this.focusArea.top&&e.x>this.focusArea.left&&e.y<this.focusArea.bottom&&e.x<this.focusArea.right)}currentEdges(){return this.es.filter(e=>e[this.connThldField]>=this.currentConnThld)}edgesToRender(){return this.currentEdges().filter(e=>this.focusArea.top<Math.max(e.sy,e.ty)&&this.focusArea.left<Math.max(e.sx,e.tx)&&this.focusArea.bottom>Math.min(e.sy,e.ty)&&this.focusArea.right>Math.min(e.sx,e.tx))}save(){return this.coords=this.ns.map(e=>({x:e.x,y:e.y})),x.updateItem(this.instance,e=>{const t=e.dataset.findIndex(e=>e.collectionID===this.nodes.collectionID);e.dataset[t]=this.nodes.export();const o=e.dataset.findIndex(e=>e.collectionID===this.edges.collectionID);e.dataset[o]=this.edges.export();const n=e.views.findIndex(e=>e.viewID===this.viewID);e.views[n]=this.export()})}export(){return{$schema:"https://mojaie.github.io/kiwiii/specs/network_v1.0.json",viewID:this.viewID,name:this.name,viewType:"network",nodes:this.nodes.collectionID,edges:this.edges.collectionID,nodeColor:this.nodeColor,nodeSize:this.nodeSize,nodeLabel:this.nodeLabel,nodeLabelColor:this.nodeLabelColor,edgeColor:this.edgeColor,edgeWidth:this.edgeWidth,edgeLabel:this.edgeLabel,edgeLabelColor:this.edgeLabelColor,connThldField:this.connThldField,currentConnThld:this.currentConnThld,minConnThld:this.minConnThld,fieldTransform:this.transform,coords:this.coords}}}var se={communityDetection:function(e,t,n){const s=n.nodeField||"index",l=n.weightField||"weight";if(!t.length){const t={};return e.forEach(e=>{t[e]=n.nulliso?null:e}),t}const a=e.map(e=>e[s]),r=t.map(e=>({source:e.source[s],target:e.target[s],weight:e[l]})),c={},i=o().nodes(a).edges(r)();return Object.entries(i).forEach(e=>{c.hasOwnProperty(e[1])||(c[e[1]]=[]),c[e[1]].push(e[0])}),Object.entries(c).sort((e,t)=>e[1].length<t[1].length).forEach((e,t)=>{1===e[1].length?i[e[1][0]]=n.nulliso?null:t:e[1].forEach(e=>{i[e]=t})}),i}};function le(e){return e.selectAll("input:checked").data().map(e=>e.key)}function ae(e){return le(e).length>0}function re(e,t){e.select(".invalid-feedback").style("display",t?"none":"inherit"),e.select(".form-control").style("background-color",t?null:"LightPink")}function ce(e,t){const o=e.select(".selected");o.selectAll("svg").remove(),o.datum(t),o.append("svg").attr("viewBox","0 0 100 10").attr("preserveAspectRatio","none").call(I.colorBar[t.type],t.colors,t.text).call(I.setSize,100,10)}var ie={selectBox:function(e,t){e.classed("form-group",!0).classed("form-row",!0).classed("align-items-center",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).text(t),e.append("select").classed("form-control",!0).classed("form-control-sm",!0).classed("col-8",!0).on("input",function(){const t=R.formValid(e);e.call(R.setValidity,t)})},updateSelectBoxOptions:function(e,t){const o=e.select("select").selectAll("option").data(t,e=>e.key);o.exit().remove(),o.enter().append("option").attr("value",e=>e.key).text(e=>e.name)},selectedRecord:function(e){const t=R.formValue(e);return e.selectAll("select option").data().find(e=>e.key===t)},checklistBox:function(e,t){e.classed("form-group",!0).classed("form-row",!0).classed("align-items-center",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).text(t).append("div").call(k.invalidFeedback),e.append("ul").classed("form-control",!0).classed("form-control-sm",!0).classed("col-8",!0)},updateChecklistItems:function(e,t){const o=e.select("ul").selectAll("li").data(t,e=>e.key);o.exit().remove();const n=o.enter().append("li").attr("class","form-check").append("label").attr("class","form-check-label");n.append("input").attr("type","checkbox").attr("class","form-check-input").property("value",e=>e.key),n.append("span").text(e=>e.name)},checkRequired:function(e){e.selectAll("input").on("change",function(){const t=ae(e);e.call(re,t)})},updateChecklistValues:function(e,o){e.selectAll("input").each(function(e){t.select(this).property("checked",o.includes(e.key))}),e.call(re,!0)},checklistValues:le,anyChecked:ae,setChecklistValidity:re,colorScaleBox:function(e,t){e.classed("form-group",!0).classed("form-row",!0).classed("align-items-center",!0),e.append("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("col-4",!0).text(t||"Colorscale");const o=e.append("div").classed("form-control",!0).classed("form-control-sm",!0).classed("col-8",!0),n=o.append("div").classed("btn-group",!0).classed("mr-1",!0);n.append("button").classed("btn",!0).classed("btn-light",!0).classed("btn-sm",!0).classed("dropdown-toggle",!0).attr("data-toggle","dropdown"),n.append("div").classed("dropdown-menu",!0).classed("py-0",!0),o.append("span").classed("selected",!0)},colorScaleBoxItems:function(e,o){const n=e.select(".dropdown-menu").selectAll("a").data(o,e=>e);n.exit().remove(),n.enter().append("a").classed("dropdown-item",!0).classed("py-0",!0).attr("href","#").attr("title",e=>e.key).on("click",function(t){e.call(ce,t),e.dispatch("change",{bubbles:!0})}).append("svg").each(function(e){t.select(this).attr("viewBox","0 0 100 10").attr("preserveAspectRatio","none").call(I.colorBar[e.type],e.colors,e.text).call(I.setSize,100,10)})},updateColorScaleBox:function(e,t){const o=e.select(".dropdown-menu").selectAll("a").data().find(e=>e.key===t);e.call(ce,o)},colorScaleBoxValue:function(e){return e.select(".selected").datum().key},colorScaleBoxItem:function(e){return e.select(".selected").datum()}};function de(e,t){const o=!t&&e.validity.stepMismatch;return e.checkValidity()||o}function ue(e){const t=e.select(".min").attr("step"),o=de(e.select(".min").node(),t),n=de(e.select(".max").node(),t);return o&&n}function pe(e){const t=e.validity.stepMismatch;return(e.checkValidity()||t)&&e.value>0}function fe(e){const t=pe(e.select(".min").node()),o=pe(e.select(".max").node());return ue(e)&&t&&o}var me={rangeBox:function(e,t){e.classed("form-row",!0).classed("form-group",!0).classed("align-items-center",!0).append("div").classed("col-form-label",!0).classed("col-form-label-sm",!0).text(t);const o=e.append("div");o.append("label").text("min"),o.append("input").classed("min",!0);const n=e.append("div");n.append("label").text("max"),n.append("input").classed("max",!0),e.selectAll("div").classed("form-group",!0).classed("col-4",!0).classed("mb-0",!0),e.selectAll("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("py-0",!0),e.selectAll("input").classed("form-control",!0).classed("form-control-sm",!0).attr("type","number"),e.append("div").classed("col-4",!0),e.append("div").call(k.invalidFeedback).classed("col-8",!0)},linearRange:function(e,o,n,s){e.selectAll(".min, .max").attr("min",o||null).attr("max",n||null).attr("step",s||null).attr("required","required").on("input",function(){const o=de(this,s);t.select(this).style("background-color",o?null:"#ffcccc"),e.select(".invalid-feedback").style("display",ue(e)?"none":"inherit")}).dispatch("input")},logRange:function(e){e.selectAll(".min, .max").attr("required","required").on("input",function(){const o=pe(this);t.select(this).style("background-color",o?null:"#ffcccc"),e.select(".invalid-feedback").style("display",fe(e)?"none":"inherit")}).dispatch("input")},updateRangeValues:function(e,t){e.select(".min").property("value",t[0]),e.select(".max").property("value",t[1]),e.selectAll(".min,.max").dispatch("input",{bubbles:!0})},rangeValues:function(e){return[e.select(".min").property("value"),e.select(".max").property("value")]},linearRangeValid:ue,logRangeValid:fe,colorRangeBox:function(e,o){e.classed("form-row",!0).classed("form-group",!0).classed("align-items-center",!0),e.append("div").classed("col-form-label",!0).classed("col-form-label-sm",!0).text(o);const n=e.append("div");n.append("label").text("min"),n.append("input").classed("min",!0);const s=e.append("div");s.append("label").text("mid"),s.append("input").classed("mid",!0);const l=e.append("div");l.append("label").text("max"),l.append("input").classed("max",!0),e.on("change",()=>{t.event.stopPropagation()}),e.selectAll("div").classed("form-group",!0).classed("col-3",!0).classed("mb-0",!0),e.selectAll("label").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("py-0",!0),e.selectAll("input").classed("form-control",!0).classed("form-control-sm",!0).attr("type","color")},updateColorRangeValues:function(e,t){e.select(".min").property("value",t[0]),e.select(".mid").property("value",t[1]),e.select(".max").property("value",t[2])},colorRangeValues:function(e){return[e.select(".min").property("value"),e.select(".mid").property("value"),e.select(".max").property("value")]}};var he={dropdownFormGroup:function(e,t){const o=l.uuidv4().slice(0,8);e.classed("mb-3",!0).append("div").classed("form-group",!0).classed("form-row",!0).classed("justify-content-end",!0).append("button").classed("btn",!0).classed("btn-sm",!0).classed("btn-outline-primary",!0).classed("dropdown-toggle",!0).attr("data-toggle","collapse").attr("data-target",`#${o}-collapse`).attr("aria-expanded","false").attr("aria-controls",`${o}-collapse`).text(t),e.append("div").classed("collapse",!0).attr("id",`${o}-collapse`).append("div").classed("card",!0).classed("card-body",!0)}};var ge={colorRangeGroup:function(e,t){e.classed("mb-3",!0),e.append("div").classed("colorscale",!0).classed("mb-2",!0).call(ie.colorScaleBox,"Colorscale").call(ie.colorScaleBoxItems,t);const o=e.append("div").call(he.dropdownFormGroup,"Custom color").select(".card-body").classed("p-2",!0);o.append("div").classed("rangetype",!0).classed("mb-1",!0).call(ie.selectBox,"Range type").call(ie.updateSelectBoxOptions,[{key:"continuous",name:"Continuous"},{key:"two-piece",name:"Two-piece"}]),o.append("div").classed("range",!0).classed("mb-1",!0).call(me.colorRangeBox,"Range"),o.append("div").classed("unknown",!0).classed("mb-1",!0).call(R.colorBox,"Unknown")},updateColorRangeGroup:function(e,t,o,n){const s=()=>{const t=ie.colorScaleBoxValue(e.select(".colorscale")),o=R.formValue(e.select(".rangetype")),n="custom"===t;e.selectAll(".rangetype, .range, .unknown").selectAll("select, input").property("disabled",!n),e.select(".range").select(".mid").property("disabled",!n||"continuous"===o)};e.select(".colorscale").call(ie.updateColorScaleBox,t).on("change",function(){s()});const l=2===o.length?"continuous":"two-piece";e.select(".rangetype").call(R.updateFormValue,l).on("change",function(){s()}).dispatch("change");const a=2===o.length?[o[0],null,o[1]]:o;e.select(".range").call(me.updateColorRangeValues,a).on("focusin",()=>{e.dispatch("change",{bubbles:!0})}),e.select(".unknown").call(R.updateFormValue,n).on("focusin",()=>{e.dispatch("change",{bubbles:!0})})},colorGroupValues:function(e){const t=ie.colorScaleBoxItem(e.select(".colorscale")),o=R.formValue(e.select(".rangetype")),n=me.colorRangeValues(e.select(".range")),s=R.formValue(e.select(".unknown"));return{color:t.key,colorScaleType:t.type,range:"continuous"===o?[n[0],n[2]]:n,unknown:s}},scaleBoxGroup:function(e){e.classed("mb-3",!0),e.append("div").classed("scale",!0).classed("mb-1",!0).call(ie.selectBox,"Scale").call(ie.updateSelectBoxOptions,[{key:"linear",name:"Linear"},{key:"log",name:"Log"}]).on("change",function(){const o="log"===R.formValue(t.select(this));e.select(".domain").call(o?me.logRange:me.linearRange).call(k.updateInvalidMessage,o?"Please provide a valid range (larger than 0)":"Please provide a valid number")}),e.append("div").classed("domain",!0).classed("mb-1",!0).call(me.rangeBox,"Domain")},updateScaleBoxGroup:function(e,t,o){e.select(".scale").call(R.updateFormValue,t).dispatch("change"),e.select(".domain").call(me.updateRangeValues,o)},scaleGroupValues:function(e){const t=R.formValue(e.select(".scale")),o=me.rangeValues(e.select(".domain"));return{scale:t||"linear",domain:o}},scaleBoxGroupValid:function(e){const t="log"===R.formValue(e.select(".scale")),o=e.select(".domain");return t?me.logRangeValid(o):me.linearRangeValid(o)}};function ye(e,o,n){e.append("div").classed("field",!0).call(ie.selectBox,n||"Field"),e.append("div").classed("range",!0).call(ge.colorRangeGroup,o).on("change",function(){const o=ge.colorGroupValues(t.select(this)),n=["categorical","monocolor"].includes(o.colorScaleType);e.select(".scale").selectAll("select,input").property("disabled",n)}),e.append("div").classed("scale",!0).call(ge.scaleBoxGroup),e.append("div").classed("legend",!0).call(R.checkBox,"Show legend")}function be(e,t,o){e.select(".field").call(ie.updateSelectBoxOptions,t).call(R.updateFormValue,o.field),e.select(".range").call(ge.updateColorRangeGroup,o.color,o.range,o.unknown),e.select(".scale").call(ge.updateScaleBoxGroup,o.scale,o.domain).dispatch("change"),e.select(".legend").call(R.updateCheckBox,o.legend)}function xe(e){return ge.scaleBoxGroupValid(e.select(".scale"))}function ve(e){const t=ge.colorGroupValues(e.select(".range")),o=ge.scaleGroupValues(e.select(".scale"));return{field:R.formValue(e.select(".field")),color:t.color,range:t.range,unknown:t.unknown,scale:"categorical"===t.colorScaleType?"ordinal":o.scale,domain:o.domain,legend:R.checkBoxValue(e.select(".legend"))}}var we={colorControlBox:ye,updateColorControl:be,colorControlValid:xe,colorControlState:ve,sizeControlBox:function(e,t){e.append("div").classed("field",!0).call(ie.selectBox,t||"Field"),e.append("div").classed("range",!0).classed("mb-2",!0).call(me.rangeBox,"Range").call(me.linearRange,.1,999,.1).call(k.updateInvalidMessage,"Please provide a valid range (0.1-999)"),e.append("div").classed("unknown",!0).call(R.numberBox,"Unknown").call(R.updateNumberRange,.1,999,.1).call(k.updateInvalidMessage,"Please provide a valid number (0.1-999)").select("input").classed("col-8",!1).classed("col-3",!0),e.append("div").classed("scale",!0).call(ge.scaleBoxGroup)},updateSizeControl:function(e,t,o){e.select(".field").call(ie.updateSelectBoxOptions,t).call(R.updateFormValue,o.field),e.select(".range").call(me.updateRangeValues,o.range),e.select(".unknown").call(R.updateFormValue,o.unknown),e.select(".scale").call(ge.updateScaleBoxGroup,o.scale,o.domain)},sizeControlValid:function(e){const t=me.linearRangeValid(e.select(".range")),o=R.formValid(e.select(".unknown")),n=ge.scaleBoxGroupValid(e.select(".scale"));return t&&o&&n},sizeControlState:function(e){const t=ge.scaleGroupValues(e.select(".scale"));return{field:R.formValue(e.select(".field")),range:me.rangeValues(e.select(".range")),unknown:R.formValue(e.select(".unknown")),scale:t.scale,domain:t.domain}},labelControlBox:function(e,t){e.append("div").append("div").classed("visible",!0).call(R.checkBox,"Show labels");const o=e.append("div").classed("mb-3",!0);o.append("div").classed("text",!0).classed("mb-1",!0).call(ie.selectBox,"Text field"),o.append("div").classed("size",!0).classed("mb-1",!0).call(R.numberBox,"Font size").call(R.updateNumberRange,.1,999,.1).call(k.updateInvalidMessage,"Please provide a valid number (0.1-999)").select(".form-control").attr("required","required"),e.call(ye,t,"Color field"),e.select(".legend input").property("disabled",!0)},updateLabelControl:function(e,t,o,n){e.select(".visible").call(R.updateCheckBox,o.visible),e.select(".text").call(ie.updateSelectBoxOptions,t).call(R.updateFormValue,o.field),e.select(".size").call(R.updateFormValue,o.size),e.call(be,t,n)},labelControlValid:function(e){return R.formValid(e.select(".size"))&&xe(e)},labelControlState:function(e){return{label:{field:R.formValue(e.select(".text")),size:R.formValue(e.select(".size")),visible:R.checkBoxValue(e.select(".visible"))},labelColor:ve(e)}},controlBoxFrame:function(e,t,o){e.append("nav").append("div").classed("nav",!0).classed("nav-tabs",!0).attr("id",t).attr("role","tablist"),e.append("div").classed("tab-content",!0).classed("p-2",!0).attr("id",o)},controlBoxNav:function(e,t,o){e.classed("nav-item",!0).classed("nav-link",!0).classed("py-1",!0).attr("id",`${t}-tab`).attr("data-toggle","tab").attr("href",`#${t}`).attr("role","tab").attr("aria-controls",t).attr("aria-selected","false").text(o)},controlBoxItem:function(e,t){e.classed("tab-pane",!0).classed("fade",!0).classed("container",!0).classed("px-0",!0).attr("id",t).attr("role","tabpanel").attr("aria-labelledby",`${t}-tab`)}};var ke={explorativeNetwork:function(t,o){let n=0;function s(){const s={};t.forEach((t,n)=>{if(!t.adjacency.length)return 0;s[n]=e.max(t.adjacency.map(e=>o[e[1]].weight))});const l={};return o.forEach((t,o)=>{const a=e.min([s[t.source],s[t.target]]);l[o]=(t.weight-n)/(a-n)}),{elevations:s,pathWeights:l}}return s.baseFactor=function(e){return n=e,s},s}};const Ce=180,Le=180;function Be(e,t,o){const n=e.selectAll(".node").data(t,e=>e.index);n.exit().remove();const s=n.enter().append("g").attr("class","node").call(Ae);s.append("circle").attr("class","node-symbol"),s.append("g").attr("class","node-content").attr("transform",`translate(${-Ce/2},${-Le/2})`),s.append("text").attr("class","node-label").attr("x",0).attr("text-anchor","middle"),s.append("foreignObject").attr("class","node-html").append("xhtml:div");const l=s.merge(n);o?l.select(".node-content").html(e=>e.structure):l.select(".node-content").select("svg").remove()}function Ve(e,t){const o=e.selectAll(".link").data(t,e=>`${e.source.index}_${e.target.index}`);o.exit().remove();const n=o.enter().append("g").attr("class","link");n.append("line").attr("class","edge-line").style("stroke-opacity",.6),n.append("text").attr("class","edge-label").attr("text-anchor","middle"),n.call(Ne)}function Te(e,t){const o=A.scaleFunction(t.nodeColor),n=A.scaleFunction(t.nodeSize),s=A.scaleFunction(t.nodeLabelColor),a=t.nodes.fields.find(e=>e.key===t.nodeLabel.field);if(e.selectAll(".node").select(".node-symbol").attr("r",e=>n(e[t.nodeSize.field])).style("fill",e=>o(e[t.nodeColor.field])),"html"===a.format){const o=200,l=e.selectAll(".node").select(".node-html");l.attr("x",-o/2).attr("y",e=>t.focusedView?Ce/2-10:parseFloat(n(e[t.nodeSize.field]))).attr("width",o).attr("height",1).attr("overflow","visible"),l.select("div").style("font-size",`${t.nodeLabel.size}px`).style("color",e=>s(e[t.nodeLabelColor.field])).style("text-align","center").style("display",t.nodeLabel.visible?"block":"none").html(e=>e[t.nodeLabel.field]),e.selectAll(".node").select(".node-label").text("")}else e.selectAll(".node").select(".node-label").attr("font-size",t.nodeLabel.size).attr("y",e=>t.focusedView?Ce/2-10:parseFloat(n(e[t.nodeSize.field]))).attr("visibility",t.nodeLabel.visible?"inherit":"hidden").style("fill",e=>s(e[t.nodeLabelColor.field])).text(e=>(e=>"d3_format"===a.format?l.formatNum(e,a.d3_format):e)(e[t.nodeLabel.field])),e.selectAll(".node").select(".node-html div").html("")}function Se(e,t){const o=A.scaleFunction(t.edgeColor),n=A.scaleFunction(t.edgeWidth),s=A.scaleFunction(t.edgeLabelColor),a=t.edges.fields.find(e=>e.key===t.edgeLabel.field);e.selectAll(".link").select(".edge-line").style("stroke",e=>o(e[t.edgeColor.field])).style("stroke-width",e=>n(e[t.edgeWidth.field])),e.selectAll(".link").select(".edge-label").attr("font-size",t.edgeLabel.size).attr("visibility",t.edgeLabel.visible?"inherit":"hidden").style("fill",e=>s(e[t.edgeLabelColor.field])).text(e=>(e=>"d3_format"===a.format?l.formatNum(e,a.d3_format):e)(e[t.edgeLabel.field]))}function Ae(e){e.attr("transform",e=>`translate(${e.x}, ${e.y})`)}function Ne(e){e.attr("transform",e=>`translate(${e.sx}, ${e.sy})`),e.select(".edge-line").attr("x1",0).attr("y1",0).attr("x2",e=>e.tx-e.sx).attr("y2",e=>e.ty-e.sy),e.select(".edge-label").attr("x",e=>(e.tx-e.sx)/2).attr("y",e=>(e.ty-e.sy)/2)}function $e(e,t){e.call(Te,t),e.call(Se,t)}function Ie(e,t){const o=t.nodesToRender(),n=o.length;t.enableFocusedView&&(t.focusedView=n<t.focusedViewThreshold),t.enableOverlookView&&(t.overlookView=n>t.overlookViewThreshold);const s=t.overlookView?[]:t.edgesToRender();e.select(".node-layer").call(Be,o,t.focusedView),e.select(".edge-layer").call(Ve,s),e.call($e,t)}function ze(e,t,o){e.attr("transform",`translate(${t}, ${o})`)}function je(e,t,o,n,s){e.attr("transform",`translate(${t}, ${o})`),e.select(".edge-line").attr("x1",0).attr("y1",0).attr("x2",n-t).attr("y2",s-o),e.select(".edge-label").attr("x",(n-t)/2).attr("y",(s-o)/2)}var Fe={updateNodes:Be,updateEdges:Ve,updateNodeCoords:Ae,updateEdgeCoords:Ne,updateNodeAttrs:Te,updateEdgeAttrs:Se,updateAttrs:$e,updateComponents:Ie,move:function(e,o,n,s){const l=t.select(o).call(ze,n,s).datum();e.select(".edge-layer").selectAll(".link").filter(e=>l.adjacency.map(e=>e[1]).includes(e.num)).each(function(e){l.index===e.source.index?t.select(this).call(je,n,s,e.tx,e.ty):l.index===e.target.index&&t.select(this).call(je,e.sx,e.sy,n,s)})},moveEdge:je,networkView:function(e,t){e.call(F.view,t);const o=e.select(".field"),n=o.append("g").classed("edge-layer",!0),s=o.append("g").classed("node-layer",!0),l=e.append("g").classed("legends",!0);l.append("g").classed("nodecolor",!0).call(z.colorBarLegend),t.updateAllNotifier=(()=>{if(t.updateWorkingCopy(),!t.nodes.fields.includes("elevation")){const e=ke.explorativeNetwork(t.ns,t.es).baseFactor(t.minConnThld)(),o={key:"index",field:{key:"elevation",name:"Elevation",d3_format:".3f"},mapping:e.elevations};t.nodes.joinFields(o);const n={key:"index",field:{key:"pweight",name:"Path weight",d3_format:".3f"},mapping:e.pathWeights};t.edges.contents[0].records.forEach((t,o)=>{t.pweight=e.pathWeights[o]}),t.edges.contents[0].fields.find(e=>"pweight"===e.key)||t.edges.contents[0].fields.push(n.field),t.edges.addField(n.field),t.updateWorkingCopy()}t.updateControlBoxNotifier(),t.setForceNotifier(),t.updateComponentNotifier()}),t.updateComponentNotifier=(()=>{t.updateLegendNotifier();const o=t.ns.map(e=>({x:e.x,y:e.y}));t.setAllCoords(o),e.call(Ie,t),t.updateInteractionNotifier()}),t.updateNodeNotifier=(()=>{s.call(Be,t.nodesToRender()),t.updateLegendNotifier()}),t.updateEdgeNotifier=(()=>{n.call(Ve,t.edgesToRender())}),t.updateNodeAttrNotifier=(()=>{s.call(Te,t),t.updateLegendNotifier()}),t.updateEdgeAttrNotifier=(()=>{n.call(Se,t)}),t.updateLegendNotifier=(()=>{l.call(z.updateLegendGroup,t.viewBox,t.legendOrient),l.select(".nodecolor").attr("visibility",t.nodeColor.legend?"inherit":"hidden").call(z.updateColorBarLegend,t.nodeColor)})}};function De(e,o){return t.drag().on("drag",function(){e.call(Fe.move,this,t.event.x,t.event.y)}).on("end",function(e){o.setCoords(e.index,t.event.x,t.event.y)})}function Oe(e,o){let n={x:0,y:0,k:1};return e.on("dblclick.zoom",null).on(".drag",null),t.zoom().on("zoom",function(){const s=t.event.transform;if(e.call(F.transform,s.x,s.y,s.k),!o.focusedView){const e=n,t=s.x>e.x+20||s.x<e.x-20,l=s.y>e.y+20||s.y<e.y-20,a=s.k>e.k;(t||l&&!a)&&(o.setTransform(s.x,s.y,s.k),n={x:s.x,y:s.y,k:s.k},o.updateComponentNotifier())}}).on("end",function(){const e=t.event.transform;o.setTransform(e.x,e.y,e.k),n={x:e.x,y:e.y,k:e.k},o.updateComponentNotifier()})}function Ee(e,o){return e=>{e.on("touchstart",function(){t.event.preventDefault()}).on("touchmove",function(){t.event.preventDefault()}).on("click.select",function(){t.event.stopPropagation();const e=t.select(this).datum().index,n=o.ns[e].selected;o.ns.forEach(e=>{e.selected=!1}),o.es.forEach(e=>{e.selected=!1}),o.ns[e].selected=!n,o.updateComponentNotifier()})}}function Pe(e,o){e.call(F.transform,o.x,o.y,o.k).call(t.zoom().transform,t.zoomIdentity.translate(o.x,o.y).scale(o.k))}function Me(t,o){const n=o.nodesToRender(),[s,l]=e.partition(n,e=>e.selected),a=n.length;o.enableFocusedView&&(o.focusedView=a<o.focusedViewThreshold),o.enableOverlookView&&(o.overlookView=a>o.overlookViewThreshold);const r=o.overlookView?[]:o.edgesToRender(),[c,i]=e.partition(r,e=>e.selected);t.select(".node-layer").call(Fe.updateNodes,l,o.focusedView).selectAll(".node .node-symbol").attr("stroke-opacity",0),t.select(".edge-layer").call(Fe.updateEdges,i),t.select(".selected-nodes").call(Fe.updateNodes,s,o.focusedView).selectAll(".node .node-symbol").attr("stroke","red").attr("stroke-width",10).attr("stroke-opacity",.5),t.select(".selected-edges").call(Fe.updateEdges,c),t.call(Fe.updateAttrs,o)}var _e={dragListener:De,zoomListener:Oe,setInteraction:function(e,o){const n=e.select(".field").append("g").classed("selected-obj",!0);n.append("g").classed("selected-edges",!0),n.append("g").classed("selected-nodes",!0),e.append("g").classed("interactions",!0).append("rect").classed("rect-select",!0).attr("fill","none").attr("stroke","black").attr("stroke-width",1).attr("stroke-dasharray","5,5").attr("visibility","hidden"),e.on("touchstart",function(){t.event.preventDefault()}).on("touchmove",function(){t.event.preventDefault()}).on("click",function(){event.shiftKey&&t.event.preventDefault(),o.ns.forEach(e=>{e.selected=!1}),o.es.forEach(e=>{e.selected=!1}),o.updateComponentNotifier()}),document.addEventListener("keydown",n=>{"Shift"===n.key&&(e.style("cursor","crosshair"),o.zoomListener=function(e,o){e.on(".zoom",null);const n=e.select(".interactions .rect-select"),s={x:0,y:0};let l=[];return t.drag().on("start",function(){s.x=t.event.x,s.y=t.event.y,l=o.ns.map(e=>e.selected),n.attr("visibility","visible").attr("x",s.x).attr("y",s.y)}).on("drag",function(){const l=Math.min(s.x,t.event.x),a=Math.abs(s.x-t.event.x),r=Math.min(s.y,t.event.y),c=Math.abs(s.y-t.event.y),i=o.transform,d=e=>(e-i.x)/i.k,u=e=>(e-i.y)/i.k;e.selectAll(".node").each(function(e){const o=t.select(this.parentNode).classed("selected-nodes")!==(e.x>d(l)&&e.y>u(r)&&e.x<d(l+a)&&e.y<u(r+c));t.select(this).select(".node-symbol").attr("stroke",o?"red":null).attr("stroke-width",o?10:null).attr("stroke-opacity",o?.5:0),n.attr("x",l).attr("y",r).attr("width",a).attr("height",c)})}).on("end",function(){const e=Math.min(s.x,t.event.x),a=Math.abs(s.x-t.event.x),r=Math.min(s.y,t.event.y),c=Math.abs(s.y-t.event.y),i=o.transform,d=e=>(e-i.x)/i.k,u=e=>(e-i.y)/i.k;o.ns.filter(t=>t.x>d(e)&&t.y>u(r)&&t.x<d(e+a)&&t.y<u(r+c)).forEach(e=>{e.selected=!l[e.index],e.adjacency.forEach(t=>{o.es[t[1]].selected=o.ns[e.index].selected&&o.ns[t[0]].selected})}),o.updateComponentNotifier(),n.attr("visibility","hidden").attr("width",0).attr("height",0)})}(e,o),o.selectListener=function(e,o){return e=>{e.on("touchstart",function(){t.event.preventDefault()}).on("touchmove",function(){t.event.preventDefault()}).on("click.select",function(){t.event.stopPropagation();const e=t.select(this).datum(),n=e.index;o.ns[n].selected=!o.ns[n].selected,e.adjacency.forEach(e=>{o.es[e[1]].selected=o.ns[n].selected&&o.ns[e[0]].selected}),o.updateComponentNotifier()})}}(0,o),o.updateInteractionNotifier())}),document.addEventListener("keyup",t=>{"Shift"===t.key&&(e.style("cursor","auto"),o.zoomListener=Oe(e,o),o.selectListener=Ee(0,o),o.updateInteractionNotifier())}),o.zoomListener=Oe(e,o),o.dragListener=De(e,o),o.selectListener=Ee(0,o),o.updateInteractionNotifier=(()=>{e.call(o.zoomListener),e.selectAll(".node").call(o.selectListener),e.selectAll(".node-layer .node").call(o.dragListener),e.selectAll(".selected-obj").call(function(e,o){const n={x:0,y:0};return t.drag().on("start",function(){n.x=t.event.x,n.y=t.event.y}).on("drag",function(){const o=t.event.x-n.x,s=t.event.y-n.y;t.select(this).attr("transform",`translate(${o}, ${s})`),e.selectAll(".selected-nodes .node").each(function(n){const l=n.x+o,a=n.y+s;e.selectAll(".edge-layer .link").filter(e=>n.adjacency.map(e=>e[1]).includes(e.num)).each(function(e){n.index===e.source.index?t.select(this).call(Fe.moveEdge,l,a,e.tx,e.ty):n.index===e.target.index&&t.select(this).call(Fe.moveEdge,e.sx,e.sy,l,a)})})}).on("end",function(){const s=t.event.x-n.x,l=t.event.y-n.y;e.selectAll(".selected-nodes .node").each(function(e){const n=e.x+s,a=e.y+l;o.setCoords(e.index,n,a),t.select(this).attr("transform",`translate(${n}, ${a})`)}),e.selectAll(".selected-edges .link").attr("transform",e=>`translate(${e.sx}, ${e.sy})`),t.select(this).attr("transform","translate(0, 0)")})}(e,o)),e.call(Pe,o.transform)}),o.updateComponentNotifier=(()=>{o.updateLegendNotifier();const t=o.ns.map(e=>({x:e.x,y:e.y}));o.setAllCoords(t),e.call(Me,o),o.updateInteractionNotifier()}),o.fitNotifier=(()=>{o.fitTransform(),o.updateComponentNotifier(),e.call(Pe,o.transform)})}};const Re=[{key:"aggregate",name:"Aggregate",force:t.forceSimulation().force("link",t.forceLink().id(e=>e.index).distance(60).strength(1)).force("charge",t.forceManyBody().strength(-600).distanceMin(15).distanceMax(720)).force("collide",t.forceCollide().radius(90)).force("x",t.forceX().strength(.002)).force("y",t.forceY().strength(.002))},{key:"tree",name:"Tree",force:t.forceSimulation().force("link",t.forceLink().id(e=>e.index).distance(60).strength(2)).force("charge",t.forceManyBody().strength(-6e3).distanceMin(15).distanceMax(720)).force("collide",t.forceCollide().radius(90)).force("x",t.forceX().strength(2e-4)).force("y",t.forceY().strength(2e-4))},{key:"sparse",name:"Sparse",force:t.forceSimulation().force("link",t.forceLink().id(e=>e.index).distance(60).strength(2)).force("charge",t.forceManyBody().strength(-6e3).distanceMin(15).distanceMax(3600)).force("collide",t.forceCollide().radius(90)).force("x",t.forceX().strength(2e-4)).force("y",t.forceY().strength(2e-4))}];function qe(e,o,n){return Re.find(t=>t.key===e).force.force("center",t.forceCenter(o/2,n/2)).stop()}function We(e,t,o){t.alpha(0).stop(),e.selectAll(".node").each(e=>{e.fx=e.x,e.fy=e.y}),o.dragListener=_e.dragListener(e,o),o.forceActive=!1}function Ge(e,o,n){e.selectAll(".node").each(e=>{e.fx=null,e.fy=null}),n.dragListener=function(e,o,n){return t.drag().on("start",()=>{t.event.active||n.relaxNotifier()}).on("drag",e=>{e.fx=t.event.x,e.fy=t.event.y}).on("end",e=>{t.event.active||o.alphaTarget(0),e.fx=null,e.fy=null})}(0,o,n),n.forceActive=!0}var Ue={forceType:Re,forceSimulation:qe,activate:function(e,t){t.setForceNotifier=(()=>{const o=qe(t.forceType,t.fieldWidth,t.fieldHeight);o.nodes(t.ns).force("link").links(t.currentEdges()),o.on("tick",()=>{const n=t.ns.map(e=>({x:e.x,y:e.y}));t.setAllCoords(n),e.selectAll(".node").call(Fe.updateNodeCoords),e.selectAll(".link").call(Fe.updateEdgeCoords),t.tickCallback(o)}).on("end",()=>{t.updateComponentNotifier(),t.tickCallback(o)}),t.forceActive?t.coords?t.relaxNotifier():t.restartNotifier():t.stickNotifier(),t.stickNotifier=(()=>{e.call(We,o,t)}),t.relaxNotifier=(()=>{e.call(Ge,o,t),o.alpha(.1).restart()}),t.restartNotifier=(()=>{e.call(Ge,o,t),o.alpha(1).restart()})})}};function Je(e,o){e.append("div").classed("mb-3",!0).append("div").classed("fit",!0).call(L.buttonBox,"Fit to screen","primary");const n=e.append("div").classed("mb-3",!0);n.append("div").classed("focused",!0).classed("mb-1",!0).call(R.checkBox,"Enable focused view"),n.append("div").classed("overlook",!0).classed("mb-1",!0).call(R.checkBox,"Enable overlook view");e.append("div").classed("legend",!0).classed("mb-3",!0).call(ie.selectBox,"Legend").call(ie.updateSelectBoxOptions,[{key:"top-left",name:"Top-left"},{key:"top-right",name:"Top-right"},{key:"bottom-left",name:"Bottom-left"},{key:"bottom-right",name:"Bottom-right"}]).on("change",function(){o.legendOrient=R.formValue(t.select(this)),o.updateLegendNotifier()});const s=e.append("div").classed("thld-group",!0).classed("mb-3",!0);s.append("div").classed("field",!0).classed("mb-1",!0).call(ie.selectBox,"Connection"),s.append("div").classed("thld",!0).classed("mb-1",!0).call(R.numberBox,"Threshold").call(R.updateNumberRange,o.minConnThld,1,.01).call(k.updateInvalidMessage,`Please provide a valid range (${o.minConnThld}-1.00)`).select(".form-control").attr("required","required"),s.append("div").classed("logd",!0).classed("mb-1",!0).call(R.readonlyBox,"logD");const l=e.append("div").classed("form-group",!0).classed("form-row",!0);l.append("div").classed("col-12",!0).append("div").classed("forcetype",!0).classed("mb-1",!0).call(ie.selectBox,"Force").call(ie.updateSelectBoxOptions,Ue.forceType).on("change",function(){const e=R.formValue(t.select(this));o.forceType=e,o.setForceNotifier()}),l.append("div").classed("col-6",!0).append("span").classed("col-form-label",!0).classed("col-form-label-sm",!0).classed("mb-1",!0).text("Temperature"),l.append("div").classed("col-12",!0).append("div").classed("temperature",!0).classed("progress",!0).append("div").classed("progress-bar",!0).classed("w-30",!0).attr("id","temperature").attr("role","progressbar").attr("aria-valuemin",0).attr("aria-valuemax",100),l.append("div").classed("col-12",!0).append("div").classed("stick",!0).classed("mb-1",!0).call(R.checkBox,"Stick nodes"),l.append("div").classed("col-12",!0).append("div").classed("restart",!0).classed("mb-1",!0).call(L.buttonBox,"Activate","warning")}function He(e,o){e.select(".fit").on("click",function(){o.fitNotifier()}),e.select(".focused").call(R.updateCheckBox,o.enableFocusedView).on("change",function(){o.enableFocusedView=R.checkBoxValue(t.select(this)),o.focusedView=R.checkBoxValue(t.select(this)),o.updateComponentNotifier()}),e.select(".overlook").call(R.updateCheckBox,o.enableOverlookView).on("change",function(){o.enableOverlookView=R.checkBoxValue(t.select(this)),o.overlookView=R.checkBoxValue(t.select(this)),o.updateComponentNotifier()});const n=e.select(".thld-group"),s=o.edges.fields.filter(e=>"none"!==l.sortType(e.format)).filter(e=>!["source","target"].includes(e.key));n.select(".field").call(ie.updateSelectBoxOptions,s).call(R.updateFormValue,o.connThldField),n.select(".thld").call(R.updateFormValue,o.currentConnThld),n.selectAll(".field, .thld").on("change",function(){if(!R.formValid(n.select(".thld")))return;const e=R.formValue(n.select(".field")),t=R.formValue(n.select(".thld"));o.connThldField=e,o.currentConnThld=t,n.select(".logd").dispatch("update"),o.setForceNotifier(),o.updateComponentNotifier()}),n.select(".logd").on("update",function(){const e=o.connThldField,n=o.currentConnThld,s=o.es.filter(t=>t[e]>=n).length,l=o.ns.length,a=l*(l-1)/2,r=t.format(".2f")(Math.log10(s/a));t.select(this).call(R.updateReadonlyValue,r)}).dispatch("update"),o.tickCallback=(t=>{const o=t.alpha(),n=o<=t.alphaMin(),s=parseInt(n?0:100*o);e.select(".temperature").select(".progress-bar").classed("bg-success",n).classed("bg-warning",!n).style("width",`${s}%`).attr("aria-valuenow",s)}),e.select(".stick").call(R.updateCheckBox,!o.forceActive).on("change",function(){const n=R.checkBoxValue(t.select(this));o.forceActive=!n,e.select(".temperature").style("background-color",n?"#a3e4d7":"#e9ecef").select(".progress-bar").style("width","0%").attr("aria-valuenow",0),n?o.stickNotifier():o.relaxNotifier(),o.updateComponentNotifier()}),e.select(".restart").on("click",function(){e.select(".stick").call(R.updateCheckBox,!1).dispatch("change"),o.restartNotifier()})}function Qe(t,o){const n=o.nodes.fields.filter(e=>"none"!==l.sortType(e.format));t.call(we.updateColorControl,n,o.nodeColor).on("change",function(){if(we.colorControlValid(t)){if(o.nodeColor=we.colorControlState(t),"ordinal"===o.nodeColor.scale){const t=o.nodes.records().map(e=>e[o.nodeColor.field]);o.nodeColor.domain=e.uniq(t).sort()}o.updateNodeAttrNotifier()}})}function Ke(t,o){const n=o.edges.fields.filter(e=>"none"!==l.sortType(e.format)).filter(e=>!["source","target"].includes(e.key));t.call(we.updateColorControl,n,o.edgeColor).on("change",function(){if(we.colorControlValid(t)){if(o.edgeColor=we.colorControlState(t),"ordinal"===o.edgeColor.scale){const t=o.edges.records().map(e=>e[o.edgeColor.field]);o.edgeColor.domain=e.uniq(t).sort()}o.updateEdgeAttrNotifier()}}),t.select(".legend input").property("disabled",!0)}function Ye(e,t){const o=t.nodes.fields.filter(e=>"none"!==l.sortType(e.format));e.call(we.updateSizeControl,o,t.nodeSize).on("change",function(){we.sizeControlValid(e)&&(t.nodeSize=we.sizeControlState(e),t.updateNodeAttrNotifier())})}function Xe(e,t){const o=t.edges.fields.filter(e=>"none"!==l.sortType(e.format)).filter(e=>!["source","target"].includes(e.key));e.call(we.updateSizeControl,o,t.edgeWidth).on("change",function(){we.sizeControlValid(e)&&(t.edgeWidth=we.sizeControlState(e),t.updateEdgeAttrNotifier())})}function Ze(t,o){const n=o.nodes.fields.filter(e=>"none"!==l.sortType(e.format));t.call(we.updateLabelControl,n,o.nodeLabel,o.nodeLabelColor).on("change",function(){if(!we.labelControlValid(t))return;const n=we.labelControlState(t);if(o.nodeLabel=n.label,o.nodeLabelColor=n.labelColor,"ordinal"===o.nodeLabelColor.scale){const t=o.nodes.records().map(e=>e[o.nodeLabelColor.field]);o.nodeLabelColor.domain=e.uniq(t).sort()}o.updateNodeAttrNotifier()})}function et(t,o){const n=o.edges.fields.filter(e=>"none"!==l.sortType(e.format)).filter(e=>!["source","target"].includes(e.key));t.call(we.updateLabelControl,n,o.edgeLabel,o.edgeLabelColor).on("change",function(){if(!we.labelControlValid(t))return;const n=we.labelControlState(t);if(o.edgeLabel=n.label,o.edgeLabelColor=n.labelColor,"ordinal"===o.edgeLabelColor.scale){const t=o.edges.records().map(e=>e[o.edgeLabelColor.field]);o.edgeLabelColor.domain=e.uniq(t).sort()}o.updateEdgeAttrNotifier()})}function tt(e,t){e.select(".control-main").call(He,t),e.select(".control-color").call(Qe,t),e.select(".control-size").call(Ye,t),e.select(".control-label").call(Ze,t),e.select(".control-edgecolor").call(Ke,t),e.select(".control-edgewidth").call(Xe,t),e.select(".control-edgelabel").call(et,t)}var ot={controlBox:function(e,t){e.select("nav").remove(),e.select(".tab-content").remove(),e.call(we.controlBoxFrame,"control-frame-nav","control-frame-content");const o=e.select(".nav-tabs"),n=e.select(".tab-content");o.append("a").classed("active",!0).attr("aria-selected","true").call(we.controlBoxNav,"control-main","Main"),n.append("div").classed("show",!0).classed("active",!0).classed("control-main",!0).call(we.controlBoxItem,"control-main").call(Je,t),o.append("a").call(we.controlBoxNav,"control-color","Color"),n.append("div").classed("control-color",!0).call(we.controlBoxItem,"control-color").call(we.colorControlBox,A.colorScales),o.append("a").call(we.controlBoxNav,"control-size","Size"),n.append("div").classed("control-size",!0).call(we.controlBoxItem,"control-size").call(we.sizeControlBox),o.append("a").call(we.controlBoxNav,"control-label","Label"),n.append("div").classed("control-label",!0).call(we.controlBoxItem,"control-label").call(we.labelControlBox,A.colorScales),o.append("a").call(we.controlBoxNav,"control-edgecolor","eColor"),n.append("div").classed("control-edgecolor",!0).call(we.controlBoxItem,"control-edgecolor").call(we.colorControlBox,A.colorScales),o.append("a").call(we.controlBoxNav,"control-edgewidth","eWidth"),n.append("div").classed("control-edgewidth",!0).call(we.controlBoxItem,"control-edgewidth").call(we.sizeControlBox),o.append("a").call(we.controlBoxNav,"control-edgelabel","eLabel"),n.append("div").classed("control-edgelabel",!0).call(we.controlBoxItem,"control-edgelabel").call(we.labelControlBox,A.colorScales),t.updateControlBoxNotifier=(()=>{e.call(tt,t)})},updateControlBox:tt};function nt(o){t.select("title").text(o.name),t.select("#menubar").selectAll(".refresh, .abort").style("display",o.edges.ongoing()?null:"none"),t.select("#menubar .name").text(o.name);const n=t.select("#menubar .loading-circle"),s=o.edges.status(),l="done"===s?s:`${s} ${o.edges.progress()}%`,a=t.format(","),r=t.format(",.4g");t.select("#menubar .nodes-count").call(k.updateBadge,`${a(o.nodes.size())} nodes`,"light","nodes-gray").select(".text").style("color","gray"),t.select("#menubar .edges-count").call(k.updateBadge,`${a(o.edges.size())} edges`,"light","edges-gray").select(".text").style("color","gray"),t.select("#menubar .fetch-status").call(k.updateBadge,l,"light",{done:"check-green",running:"running-darkorange",ready:"clock-cornflowerblue",queued:"clock-cornflowerblue",interrupted:"caution-salmon",aborted:"caution-salmon",failure:"caution-salmon"}[s]).select(".text").style("color",{done:"green",running:"darkorange",ready:"cornflowerblue",queued:"cornflowerblue",interrupted:"salmon",aborted:"salmon",failure:"salmon"}[s]),t.select("#menubar .exec-time").call(k.updateBadge,`${r(o.edges.execTime())} seconds`,"light","clock-cornflowerblue").select(".text").style("color","cornflowerblue");const c=t.select("#dialogs");c.select(".communityd").call(G.updateBody,o.nodes.fields).on("submit",function(){n.style("display","inline-block");const s=G.value(t.select(this)),l=o.nodes.records(),a=o.currentEdges(),r={nodeField:"index",weightField:o.connThldField,nulliso:s.nulliso},c=se.communityDetection(l,a,r),i={key:"index",field:{key:s.name,name:s.name,format:"d3_format",d3_format:"d"},mapping:c};o.nodes.joinFields(i);const d=o.nodes.records().map(e=>e[s.name]);o.nodeColor={field:s.name,color:"category40",scale:"ordinal",domain:e.uniq(d).sort(),range:["#7fffd4","#7fffd4"],unknown:"#7fffd4"},o.updateAllNotifier(),nt(o)}),c.select(".renamed").call(H.updateBody,o.name).on("submit",function(){n.style("display","inline-block"),o.name=H.value(t.select(this)),nt(o)}),c.select(".abortd").call(V.updateConfirmDialog,"Are you sure you want to abort this calculation job?").on("submit",function(){return n.style("display","inline-block"),o.edges.abort().then(()=>{o.updateAllNotifier(),nt(o)})}),n.style("display","none")}return{run:function(){const e=s.compatibility();if(e)return void t.select("body").style("color","#ff0000").text(e);document.location.protocol,"onLine"in navigator&&navigator.onLine,s.registerServiceWorker();const o=s.URLQuery().instance||null,n=s.URLQuery().view||null;return x.getView(o,n).then(e=>{if(!e)throw"ERROR: invalid URL";return e.instance=o,Promise.all([x.getCollection(o,e.nodes),x.getCollection(o,e.edges)]).then(n=>{n[0].instance=o,n[1].instance=o,function(e,o,n){const s=t.select("#menubar").classed("my-1",!0);s.selectAll("div,span,a").remove();const l=t.select("#dialogs");l.selectAll("div").remove();const a=new ne(e,o,n);a.fieldWidth=1200,a.fieldHeight=1200;const r=s.append("div").call(L.dropdownMenuButton,"Menu","primary","network-white").select(".dropdown-menu");r.append("a").call(G.menuLink),r.append("a").call(H.menuLink),r.append("a").call(L.dropdownMenuItem,"Save","menu-save").on("click",function(){return a.save().then(()=>s.select(".notify-saved").call(k.notify))}),s.append("a").call(L.menuButtonLink,"Dashboard","outline-secondary","status-gray").attr("href","dashboard.html").attr("target","_blank"),s.append("a").classed("refresh",!0).call(L.menuButtonLink,"Refresh","outline-secondary","refresh-gray").on("click",function(){return t.select("#menubar .loading-circle").style("display","inline-block"),a.edges.pull().then(()=>(a.updateAllNotifier(),nt(a)))}),s.append("a").classed("abort",!0).call(L.menuButtonLink,"Abort server job","warning","delete-gray").attr("data-toggle","modal").attr("data-target","#abort-dialog"),s.append("span").classed("loading-circle",!0).call(k.loadingCircle),s.append("span").classed("notify-saved",!0).call(k.alert).call(k.updateAlert,"State saved","success","check-green").style("display","none"),s.append("span").classed("name",!0),s.append("span").classed("nodes-count",!0).call(k.badge),s.append("span").classed("edges-count",!0).call(k.badge),s.append("span").classed("fetch-status",!0).call(k.badge),s.append("span").classed("exec-time",!0).call(k.badge),l.append("div").classed("communityd",!0).call(G.body),l.append("div").classed("renamed",!0).call(H.body),l.append("div").classed("abortd",!0).call(V.confirmDialog,"abort-dialog"),t.select("#nw-frame").call(F.viewFrame,a).select(".view").call(Fe.networkView,a).call(Ue.activate,a).call(_e.setInteraction,a),t.select("#nw-control").call(ot.controlBox,a),window.onresize=(()=>t.select("#nw-frame").call(F.resize,a)),a.updateAllNotifier(),nt(a)}(e,n[0],n[1])})}).catch(e=>{console.error(e),t.select("#nw-frame").style("color","red").text(e)})}}});
//# sourceMappingURL=networkApp.js.map
