{"version":3,"file":"kwdatatable.js","sources":["../src/helper/file.js","../src/helper/mapper.js","../src/store/StoreConnection.js","../src/helper/formatValue.js","../src/component/Component.js","../src/common.js","../src/component/DataGrid.js","../src/datatable.js","../src/helper/d3Form.js","../src/helper/definition.js","../src/helper/KArray.js","../src/helper/window.js","../src/fetcher.js","../src/helper/misc.js","../src/store/IDBStore.js","../src/helper/image.js","../src/component/Dialog.js","../src/component/Header.js"],"sourcesContent":["\n/** @module helper/file */\n\nimport pako from 'pako';\n\nimport {default as def} from './definition.js';\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    e.format = 'raw';\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: def.defaultFieldProperties([\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ]),\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\nfunction v07_to_v08_convert(json) {\n  if (json.hasOwnProperty('edges')) {\n    const nodes = v07_to_v08_nodes(json.nodes);\n    const edges = v07_to_v08_edges(json.edges, nodes.fields);\n    return {nodes: nodes, edges: edges};\n  } else {\n    return v07_to_v08_nodes(json);\n  }\n}\n\n\nfunction readFile(file, sizeLimit, blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    const truncated = sizeLimit ? file.slice(0, sizeLimit) : file;\n    reader.onload = event => resolve(event.target.result);\n    reader.onerror = error => reject(error);\n    if (blob) {\n      reader.readAsArrayBuffer(truncated);\n    } else {\n      reader.readAsText(truncated);\n    }\n  });\n}\n\n\nfunction parseJSON(data, compressed) {\n  const text = compressed ? pako.inflate(data, {to: 'string'}) : data;\n  const json = JSON.parse(text);\n  if (json.hasOwnProperty('schemaVersion')) return json;\n  if (json.hasOwnProperty('edges')) {\n    if (json.edges.hasOwnProperty('schemaVersion')) return json;\n  }\n  return v07_to_v08_convert(json);\n}\n\n\nfunction loadJSON(file) {\n  const compressed = file.name.endsWith('c') || file.name.endsWith('.gz');\n  return readFile(file, false, compressed)\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction fetchJSON(url) {\n  const decoded = decodeURIComponent(url);\n  const compressed = decoded.endsWith('c') || decoded.endsWith('.gz');\n  return fetch(decoded)\n    .then(res => compressed ? res.arrayBuffer() : res.json())\n    .then(data => parseJSON(data, compressed));\n}\n\n\nfunction downloadDataFile(data, name) {\n  try {\n    // cannot hundle large file with dataURI scheme\n    // url = 'data:application/json,' + encodeURIComponent(JSON.stringify(json))\n    const url = window.URL.createObjectURL(new Blob([data]));\n    const a = document.createElement('a');\n    a.download = name;\n    a.href = url;\n    // a.click() does not work on firefox\n    a.dispatchEvent(new MouseEvent('click', {\n      'view': window,\n      'bubbles': true,\n      'cancelable': false\n    }));\n    // window.URL.revokeObjectURL(url) does not work on firefox\n  } catch (e) {\n    // no DOM (unit testing)\n  }\n}\n\n\nfunction downloadJSON(json, name, compress=true) {\n  const str = JSON.stringify(json);\n  const data = compress ? pako.gzip(str) : str;\n  const c = compress ? 'c' : 'r';\n  const ext = json.hasOwnProperty('edges') ? `.gf${c}` :  `.nd${c}`;\n  downloadDataFile(data, `${name}${ext}`);\n}\n\n\nexport default {\n  readFile, parseJSON, loadJSON, fetchJSON,\n  downloadDataFile, downloadJSON\n};\n","\n/** @module helper/dataStructure */\n\nimport KArray from './KArray.js';\nimport {default as def} from './definition.js';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: def.defaultFieldProperties([keyField].concat(mp.fields)),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: def.defaultFieldProperties(table.fields\n      .filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key))),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: def.defaultFieldProperties(fields),\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields = def.defaultFieldProperties(\n    KArray.from(data.fields).concat(mp.fields).unique('key'));\n}\n\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\nimport {default as def} from '../helper/definition.js';\nimport {default as mapper} from '../helper/mapper.js';\nimport {default as store} from './IDBStore.js';\n\n\nfunction getAppSetting(key) {\n  return store.getAppSetting(key)\n    .catch(err => {\n      console.error(`Unexpected key: ${key}`);\n      Promise.reject(err);\n    });\n}\n\n\nfunction setAppSetting(key, value) {\n  return store.putAppSetting(key, value)\n    .catch(err => {\n      console.error(`Unexpected key: ${key} or value: ${value}`);\n      Promise.reject(err);\n    });\n}\n\n\nfunction getResources() {\n  return store.getResources();\n}\n\n\nfunction setResources(rsrcs) {\n  return store.putResources(rsrcs)\n    .catch(err => {\n      console.error(`Unexpected resources: ${rsrcs}`);\n      Promise.reject(err);\n    });\n}\n\n\nfunction getAllTables() {\n  return store.getAllItems();\n}\n\n\nfunction getTablesByDataType(type) {\n  return store.getItemsByDataType(type)\n    .catch(err => {\n      console.error(`Unexpected dataType: ${type}`);\n      Promise.reject(err);\n    });\n}\n\n\nfunction getTable(id) {\n  return store.getItemById(id)\n    .catch(err => {\n      console.error(`Unexpected table ID: ${id}`);\n      Promise.reject(err);\n    });\n}\n\n\nfunction setFieldProperties(id, updates) {\n  return store.updateItem(id, item => {\n    item.fields.forEach((fd, i) => {\n      fd.visible = updates.visibles.includes(fd.key);\n      fd.format = updates.formats[i];\n      if (updates.d3_formats[i]) fd.d3_format = updates.d3_formats[i];\n    });\n    item.revision++;\n  })\n  .catch(err => {\n    console.error(`Unexpected table ID: ${id} or updates: ${updates}`);\n    Promise.reject(err);\n  });\n}\n\n\nfunction joinFields(id, mapping) {\n  return store.updateItem(id, item => {\n    mapper.apply(item, mapping);\n    item.revision++;\n  })\n  .catch(err => {\n    console.error(`Unexpected table ID: ${id} or mapping: ${mapping}`);\n    Promise.reject(err);\n  });\n}\n\n\nfunction updateTableAttribute(id, key, value) {\n  return store.updateItem(id, item => {\n    item[key] = value;\n    item.revision++;\n  })\n  .catch(err => {\n    console.error(`Unexpected table ID: ${id}, key: ${key} or value: ${value}`);\n    Promise.reject(err);\n  });\n}\n\n\nfunction insertTable(data) {\n  data.fields = def.defaultFieldProperties(data.fields);\n  return store.putItem(data)\n    .catch(err => {\n      console.error(`Unexpected data: ${data}`);\n      Promise.reject(err);\n    });\n}\n\n\nfunction updateTable(data) {\n  if (data.status === 'failure') {  // No data found on server\n    return updateTableAttribute(data.id, 'status', 'failure');\n  }\n  // update\n  return store.updateItem(data.id, item => {\n    data.fields = def.defaultFieldProperties(data.fields);\n    Object.assign(item, data);\n    item.revision++;\n  });\n}\n\n\nfunction deleteTable(id) {\n  return store.deleteItem(id)\n    .catch(err => {\n      console.error(`Unexpected table ID: ${id}`);\n      Promise.reject(err);\n    });\n}\n\n\nfunction reset() {\n  return store.reset();\n}\n\n\nexport default {\n  getAppSetting, setAppSetting, getResources, setResources,\n  getAllTables, getTablesByDataType, getTable,\n  setFieldProperties, joinFields,\n  updateTableAttribute, insertTable, updateTable,\n  deleteTable, reset\n};\n","\n/** @module helper/formatValue */\n\nimport d3 from 'd3';\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\nfunction numericAsc(a, b) {\n  const fa = parseFloat(a);\n  const fb = parseFloat(b);\n  if (isNaN(fa) || isNaN(fb)) {\n    return String(b).localeCompare(String(a));\n  }\n  return fb - fa;\n}\n\n\nfunction numericDesc(a, b) {\n  return numericAsc(b, a);\n}\n\n\nfunction textAsc(a, b) {\n  return String(b).localeCompare(String(a));\n}\n\n\nfunction textDesc(a, b) {\n  return textAsc(b, a);\n}\n\n\nexport default {\n  formatNum, partialMatch,\n  numericAsc, numericDesc, textAsc, textDesc\n};\n","\n/** @module component/Component */\n\nimport d3 from 'd3';\nimport {default as def} from '../helper/definition.js';\nimport {default as fmt} from '../helper/formatValue.js';\n\n\nfunction selectOptions(selection, data, key, text) {\n  const options = selection.selectAll('option')\n    .data(data, key);\n  options.exit().remove();\n  options.enter().append('option')\n    .merge(options)\n      .attr('value', key)\n      .text(text);\n}\n\n\nfunction checkboxList(selection, data, name, key, text) {\n  const items = selection.selectAll('li').data(data, key);\n  items.exit().remove();\n  const entered = items.enter().append('li')\n    .attr('class', 'form-check')\n    .append('label');\n  entered.append('input');\n  entered.append('span');\n  const updated = entered.merge(items.select('label'))\n    .attr('class', 'form-check-label');\n  updated.select('input')\n    .attr('type', 'checkbox')\n    .attr('class', 'form-check-input')\n    .attr('name', name)\n    .attr('value', key);\n  updated.select('span')\n    .text(text);\n}\n\n\n// checkbox list with tooltip\n// call $('[data-toggle=\"tooltip\"]').tooltip() after this function\nfunction checkboxListT(selection, data, name, key, text) {\n  const items = selection.selectAll('li').data(data, key);\n  items.exit().remove();\n  const entered = items.enter().append('li')\n    .attr('class', 'form-check')\n    .append('label');\n  entered.append('input');\n  entered.append('a');\n  const updated = entered.merge(items.select('label'))\n    .attr('class', 'form-check-label');\n  updated.select('input')\n    .attr('type', 'checkbox')\n    .attr('class', 'form-check-input')\n    .attr('name', name)\n    .attr('value', key);\n  updated.select('a')\n    .attr('data-toggle', 'tooltip')\n    .attr('data-placement', 'bottom')\n    .attr('title', d => d.description || 'No')\n    .text(text);\n}\n\n\nfunction createTable(selection, data) {\n  // Header\n  if (selection.select('thead').size()) selection.select('thead').remove();\n  selection.append('thead').append('tr');\n  // Records\n  if (selection.select('tbody').size()) selection.select('tbody').remove();\n    selection.append('tbody');\n\n  const cols = data.fields.filter(e => e.visible);\n  const header = selection.select('thead tr').selectAll('th')\n    .data(cols, d => d.key);\n  header.exit().remove();\n  header.enter().append('th')\n    .merge(header)\n      .text(d => d.name);\n}\n\n\nfunction updateTableRecords(selection, rcds, keyFunc) {\n  const header = selection.select('thead tr').selectAll('th')\n    .data();\n  const rowSelection = selection.select('tbody').selectAll('tr')\n    .data(rcds, keyFunc);\n  rowSelection.exit().remove();\n  const rowEntered = rowSelection.enter().append('tr');\n  rowEntered.selectAll('td')\n    .data(d => header.map(e => d[e.key]))\n    .enter().append('td');\n  rowEntered.merge(rowSelection)\n    .selectAll('td')\n      .classed('align-middle', true)\n    .html(function (d, i) {\n      if (d === undefined) return '';\n      if (header[i].format === 'd3_format') {\n        return fmt.formatNum(d, header[i].d3_format);\n      }\n      if (header[i].format === 'plot') return '[plot]';\n      if (header[i].format === 'image') return '[image]';\n      if (header[i].format === 'control') return;\n      return d;\n    })\n    .each((d, i, nodes) => {\n      // This should be called after html\n      if (header[i].format === 'control') d3.select(nodes[i]).call(d);\n    });\n}\n\n\nfunction appendTableRows(selection, rcds, keyFunc) {\n  const newRcds = selection.select('tbody').selectAll('tr').data();\n  Array.prototype.push.apply(newRcds, rcds);\n  updateTableRecords(selection, newRcds, keyFunc);\n}\n\n\nfunction addSort(selection) {\n  selection.select('thead tr').selectAll('th')\n    .filter(d => def.sortType(d.format) !== 'none')\n    .append('span').append('a')\n      .attr('id', d => `sort-${d.key}`)\n      .text('^v')\n      .style('display', 'inline-block')\n      .style('width', '30px')\n      .style('text-align', 'center')\n    .on('click', d => {\n      const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n      const isNum = def.sortType(d.format) === 'numeric';\n      const cmp = isAsc\n        ? (isNum ? fmt.numericAsc : fmt.textAsc)\n        : (isNum ? fmt.numericDesc : fmt.textDesc);\n      selection.select('tbody').selectAll('tr')\n        .sort((a, b) => cmp(a[d.key], b[d.key]));\n      d3.select(`#sort-${d.key}`)\n        .text(isAsc ? '^' : 'v');\n    });\n}\n\n\nfunction formatNumbers(selection) {\n  // DEPRECATED: no longer used\n  selection.select('thead tr').selectAll('th')\n    .each((col, colIdx) => {\n      if (col.digit === 'raw') return;\n      selection.select('tbody').selectAll('tr')\n        .selectAll('td')\n          .filter((d, i) => i === colIdx)\n          .text(d => fmt.formatNum(d, col.digit));\n    });\n}\n\n\nexport default {\n  selectOptions, checkboxList, checkboxListT,\n  createTable, updateTableRecords,\n  appendTableRows, addSort, formatNumbers\n};\n","\nimport {default as def} from './helper/definition.js';\nimport {default as win} from './helper/window.js';\nimport {default as misc} from './helper/misc.js';\nimport {default as store} from './store/StoreConnection.js';\nimport {default as dialog} from './component/Dialog.js';\nimport {default as fetcher} from './fetcher.js';\n\n\nfunction interactiveInsert(data) {\n  return store.getTable(data.id)\n    .then(found => {\n      if (!found) return Promise.resolve(data); // no existing table\n      if (data.revision == found.revision) return Promise.reject(data.id); // same revision\n      // data id conflict\n      $('#importconfirm-dialog').modal('toggle');\n      return new Promise(res => {\n        dialog.importConfirmDialog(action => {\n          if (action === 'overwrite') {\n            res(data);\n          }\n          if (action === 'keepboth') {\n            data.id = misc.uuidv4();\n            res(data);\n          }\n        });\n      });\n    })\n    .then(\n      data => store.insertTable(data).then(() => data.id), // insert or update table\n      id => {\n        if (id) return Promise.resolve(id); // same revision -> call existing table\n        return Promise.reject();\n      }\n    );\n}\n\n\nfunction fetchResults(command='update') {\n  return store.getTable(win.URLQuery().id)\n    .then(data => {\n      if (!def.ongoing(data)) return Promise.reject();\n      return data;\n    })\n    .then(data => {\n      const query = {id: data.id, command: command};\n      return fetcher.get('res', query)\n        .then(fetcher.json)\n        .then(store.updateTable, fetcher.error);\n    }, () => Promise.resolve());\n}\n\n\nfunction registerServiceWorker() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker\n      .register('sw.js')\n      .then(reg => {\n        console.info('ServiceWorker registration successful with scope: ', reg.scope);\n      }).catch(err => {\n        console.info('ServiceWorker registration failed: ', err);\n      });\n  } else {\n    console.info('Off-line mode is not supported');\n  }\n}\n\n\nfunction loader() {\n  /*\n  if (document.location.protocol === \"file:\") {\n    console.info('Off-line mode (local file)');\n    store.setGlobalConfig('onLine', false);\n    return Promise.resolve();\n  }\n  if ('onLine' in navigator) {\n    if (!navigator.onLine) {\n      console.info('Off-line mode (no internet connection)');\n      store.setGlobalConfig('onLine', false);\n      return Promise.resolve();\n    }\n  }*/\n  const server = fetcher.get('server')\n    .then(fetcher.json)\n    .catch(() => null);\n  const local = store.getAppSetting('serverInstance');\n  return Promise.all([server, local]).then(ps => {\n    const serverStatus = ps[0];\n    const clientInstance = ps[1];\n    if (!serverStatus) return Promise.resolve(null);\n    if (!serverStatus.debugMode) {\n      registerServiceWorker();\n    } else {\n      console.info('Off-line mode is disabled for debugging');\n    }\n    if (serverStatus.instance === clientInstance) {\n      console.info('Resource schema is already up to date');\n      return Promise.resolve(serverStatus);\n    } else {\n      return fetcher.get('schema')\n        .then(fetcher.json)\n        .then(schema => {\n          console.info(`New resource schema version: ${serverStatus.instance}`);\n          return Promise.all([\n            store.setResources(schema.resources),\n            store.setAppSetting('templates', schema.templates),\n            store.setAppSetting(\n              'compoundIDPlaceholder', schema.compoundIDPlaceholder),\n              store.setAppSetting(\n                'defaultDataType', schema.defaultDataType),\n            store.setAppSetting('serverInstance', serverStatus.instance),\n            store.setAppSetting('rdkit', serverStatus.rdkit)\n          ])\n          .then(() => Promise.resolve(serverStatus));\n        }, fetcher.error);\n    }\n  });\n}\n\n\nexport default {\n  interactiveInsert, fetchResults, registerServiceWorker, loader\n};\n","\n/** @module component/DataGrid */\n\nimport d3 from 'd3';\nimport {default as def} from '../helper/definition.js';\nimport {default as fmt} from '../helper/formatValue.js';\nimport {default as img} from '../helper/image.js';\n\n\nconst defaultColumnWidth = {\n  numeric: 120,\n  text: 200,\n  none: 200\n};\n\nconst defaultColumnHeight = {\n  numeric: 40,\n  text: 40,\n  none: 200\n};\n\nconst scrollBarSpace = 20;\n\n\n\nfunction createDataGrid(selection, data) {\n  // Header\n  if (selection.select('div.dg-header').size()) {\n    selection.select('div.dg-header').remove();\n  }\n  selection.append('div').classed('dg-header', true);\n  // Body\n  if (selection.select('div.dg-viewport').size()) {\n    selection.select('div.dg-viewport').remove();\n  }\n  selection.append('div').classed('dg-viewport', true)\n    .append('div').classed('dg-body', true);\n  const cols = data.fields.filter(e => e.visible)\n    .map(e => {\n      e.width = defaultColumnWidth[def.sortType(e.format)];\n      e.height = defaultColumnHeight[def.sortType(e.format)];\n      return e;\n    });\n  const rowSize = {\n    height: cols.reduce((a, b) => a.height > b.height ? a : b).height,\n    width: cols.reduce((a, b) => ({width: a.width + b.width})).width\n  };\n  selection.style('width', `${rowSize.width + scrollBarSpace}px`);\n  selection.select('.dg-header').datum(rowSize);\n  const header = selection.select('.dg-header')\n    .selectAll('.dg-hcell')\n      .data(cols, d => d.key);\n  header.exit().remove();\n  header.enter().append('div')\n      .classed('dg-hcell', true)\n      .style('display', 'inline-block')\n    .merge(header)\n      .style('width', d => `${d.width}px`)\n      .text(d => d.name);\n}\n\n\nfunction updateRows(selection, rcds, keyFunc, position, visibleRows) {\n  const rSize = selection.select('.dg-header').datum();\n  const cData = selection.select('.dg-header').selectAll('.dg-hcell')\n    .data();\n  const topPos = Math.min(position, Math.max(0, rcds.length - visibleRows + 1));\n  const bottomPos = topPos + visibleRows;\n  const rcdSlice = rcds.slice(topPos, Math.min(bottomPos, rcds.length));\n  const rowSelection = selection.select('.dg-body')\n    .selectAll('.dg-row')\n      .data(rcdSlice, keyFunc)\n      .style('height', `${rSize.height}px`);\n  rowSelection.exit().remove();\n  const rowEntered = rowSelection.enter().append('div')\n      .attr('class', 'dg-row')\n      .style('position', \"absolute\");\n  rowEntered.selectAll('.dg-cell')\n    .data(cData.map(e => e.width))\n    .enter().append('div')\n      .classed('dg-cell', true)\n      .classed('align-middle', true)\n      .style('display', 'inline-block')\n      .style('width', d => `${d}px`);\n  // TODO: need refactoring\n  rowEntered.merge(rowSelection)\n      .order()\n      .each(function(d, ri) {\n        const rowPos = (position + ri) * rSize.height;\n        d3.select(this)\n          .style('transform', `translate(0px, ${rowPos}px)`)\n          .classed('odd', (position + ri) % 2 === 0)\n        .selectAll('.dg-cell')\n          .html(function(_, i) {\n            d3.select(this).attr('id', `c${ri}-${i}`);\n            const value = d[cData[i].key];\n            if (value === undefined) return '';\n            if (cData[i].format === 'd3_format') {\n              return fmt.formatNum(value, cData[i].d3_format);\n            }\n            if (cData[i].format === 'plot') return '';\n            if (cData[i].format === 'compound_id') {\n              return `<a href=\"profile.html?compound=${value}\" target=\"_blank\">${value}</a>`;\n            }\n            if (cData[i].format === 'image') {  // data URI\n              return `<img src=\"${value}\" width=\"180\" height=\"180\"/>`;\n            }\n            return value;\n          })\n          .each(function(_, i) {\n            if (cData[i].format !== 'plot') return;\n            if (!d.hasOwnProperty(cData[i].key)) return;\n            const value = d[cData[i].key];\n            img.showPlot(value, `#c${ri}-${i}`);\n          });\n    });\n}\n\n\nfunction dataGridRecords(selection, rcds, keyFunc) {\n  const rSize = selection.select('.dg-header').datum();\n  const bodyHeight = rcds.length * rSize.height;\n  let position;\n  let visibleRows;\n  selection.select('.dg-body')\n    .style('height', `${bodyHeight}px`)\n    .style('position', \"relative\");\n  selection.select('.dg-viewport')\n    .style('overflow-y', 'auto')\n    .on('scroll', function() {\n      const scrollTop = d3.select(this).node().scrollTop;\n      const newPos = Math.min(Math.floor(scrollTop / rSize.height), rcds.length);\n      if (newPos !== position) {\n        position = newPos;\n        updateRows(selection, rcds, keyFunc, position, visibleRows);\n      }\n    });\n  d3.select(window)\n    .on('resize', function() {\n      const viewport = selection.select('.dg-viewport');\n      const viewportTop = viewport.node().getBoundingClientRect().top;\n      const viewportHeight = window.innerHeight - viewportTop - 5;\n      viewport.style('height', `${viewportHeight}px`);\n      const newVis = Math.ceil(viewportHeight / rSize.height) + 1;\n      if (newVis !== visibleRows) {\n        visibleRows = newVis;\n        viewport.dispatch('scroll');\n      }\n    })\n    .dispatch('resize');\n}\n\n\nfunction addSort(selection, rcds, keyFunc) {\n  selection.select('.dg-header').selectAll('.dg-hcell')\n    .filter(d => def.sortType(d.format) !== 'none')\n    .append('span').append('a')\n      .attr('id', d => `sort-${d.key}`)\n      .text('^v')\n      .style('display', 'inline-block')\n      .style('width', '30px')\n      .style('text-align', 'center')\n    .on('click', d => {\n      const isAsc = d3.select(`#sort-${d.key}`).text() === 'v';\n      d3.select(`#sort-${d.key}`).text(isAsc ? '^' : 'v');\n      const isNum = def.sortType(d.format) === 'numeric';\n      const cmp = isAsc\n        ? (isNum ? fmt.numericAsc : fmt.textAsc)\n        : (isNum ? fmt.numericDesc : fmt.textDesc);\n      const sorted = rcds.sort((a, b) => cmp(a[d.key], b[d.key]));\n      dataGridRecords(selection, sorted, keyFunc);\n    });\n}\n\n\nexport default {\n  createDataGrid, dataGridRecords, addSort\n};\n","\n/** @module datatable */\n\nimport d3 from 'd3';\n\nimport {default as d3form} from './helper/d3Form.js';\nimport {default as hfile} from './helper/file.js';\nimport {default as win} from './helper/window.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as common} from './common.js';\nimport {default as store} from './store/StoreConnection.js';\nimport {default as dialog} from './component/Dialog.js';\nimport {default as header} from './component/Header.js';\nimport {default as grid} from './component/DataGrid.js';\n\n\nfunction render() {\n  return store.getTable(win.URLQuery().id)\n    .then(data => {\n      dialog.columnDialog(data.fields, render);\n      dialog.fieldFileDialog(mapping => {\n        return store.joinFields(win.URLQuery().id, mapping).then(render);\n      });\n      header.renderStatus(\n        data, () => common.fetchResults().then(render),\n        () => common.fetchResults('abort').then(render));\n      d3.select('#rename')\n        .on('click', () => {\n          d3.select('#prompt-title').text('Rename table');\n          d3.select('#prompt-label').text('New name');\n          d3.select('#prompt-input').attr('value', data.name);\n          d3.select('#prompt-submit')\n            .on('click', () => {\n              const name = d3form.value('#prompt-input');\n              return store.updateTableAttribute(data.id, 'name', name)\n                .then(() => store.getTable(win.URLQuery().id)) // updateTableAttribute returns 1\n                .then(t => header.renderStatus(\n                  t, () => common.fetchResults().then(render),\n                  () => common.fetchResults('abort').then(render))\n                );\n            });\n        });\n      // Following operations use data.records\n      d3.select('#datatable')\n        .call(grid.createDataGrid, data)\n        .call(grid.dataGridRecords, data.records, d => d.index)\n        .call(grid.addSort, data.records, d => d.index);\n      store.getResources().then(rsrc => {\n        const actres = rsrc.filter(e => e.domain === 'activity');\n        const compoundIDs = data.records.map(e => e.id);\n        dialog.fieldFetchDialog(compoundIDs, data.fields, actres, mapping => {\n          return store.joinFields(win.URLQuery().id, mapping).then(render);\n        });\n      });\n      dialog.graphDialog(params => {\n        const formData = new FormData();\n        formData.append('contents', new Blob([JSON.stringify(data)]));\n        formData.append('params', JSON.stringify(params));\n        return fetcher.post('simnet', formData)\n          .then(fetcher.json)\n          .then(json => {\n            json.networkThreshold = json.query.threshold;\n            return common.interactiveInsert(json)\n              .then(id => {\n                d3.select('#loading-circle').style('display', 'none');\n                window.open(`graph.html?id=${id}`, '_blank');\n              });\n          }, fetcher.error);\n      });\n      d3.select('#export')\n        .on('click', () => hfile.downloadJSON(data, data.name, true));\n      d3.select('#excel')\n        .on('click', () => {\n          const formData = new FormData();\n          formData.append('contents', new Blob([JSON.stringify(data)]));\n          return fetcher.post('xlsx', formData)\n            .then(fetcher.blob)\n            .then(blob => hfile.downloadDataFile(blob, `${data.name}.xlsx`),\n                  fetcher.error);\n        });\n      d3.select('#sdfile')\n        .on('click', () => {\n          const formData = new FormData();\n          formData.append('contents', new Blob([JSON.stringify(data)]));\n          return fetcher.post('sdfout', formData)\n            .then(fetcher.text)\n            .then(text => hfile.downloadDataFile(text, `${data.name}.sdf`),\n                  fetcher.error);\n        });\n    });\n}\n\n\nfunction loadNewTable(data) {\n  return common.interactiveInsert(data)\n    .then(id => {\n      // window.open(`datatable.html?id=${id}`);\n      window.location = `datatable.html?id=${id}`;\n    });\n}\n\n\nfunction run() {\n  d3.select('#import-json')\n    .on('click', () => document.getElementById('select-file').click());\n  d3.select('#select-file')\n    .on('change', () => {\n      const file = document.getElementById('select-file').files[0];\n      hfile.loadJSON(file).then(loadNewTable);\n    });\n  // location parameter enables direct access to datatable JSON via HTTP\n  if (win.URLQuery().hasOwnProperty('location')) {\n    const url = win.URLQuery().location;\n    return hfile.fetchJSON(url)\n      .then(common.interactiveInsert)\n      .then(id => {\n        window.location = `datatable.html?id=${id}`;\n      });\n  }\n  return common.loader().then(serverStatus => {\n    if (!serverStatus) {\n      // Disable offline comannds\n      d3.selectAll('.online-command')\n        .style('color', '#cccccc')\n        .classed('disabled', true)\n        .on('click', () => d3.event.stopPropagation());\n    }\n    // Loading tables\n    if (win.URLQuery().hasOwnProperty('id')) {\n      header.initializeWithData();\n      return common.fetchResults().then(render);\n    } else {\n      header.initialize();\n      dialog.sdfDialog(loadNewTable);\n      if (!serverStatus) return Promise.resolve();\n      return store.getResources().then(rsrc => {\n        const chemres = rsrc.filter(e => e.domain === 'chemical');\n        dialog.pickDialog(chemres, loadNewTable);\n        dialog.structDialog(chemres, loadNewTable);\n        dialog.propDialog(chemres, loadNewTable);\n      });\n    }\n  });\n}\n\n\nexport default {\n  grid, render, run\n};\n","\n/** @module helper/d3Form */\n\nimport d3 from 'd3';\n\n\nfunction value(selector) {\n  return d3.select(selector).node().value;\n}\n\n\nfunction valueInt(selector) {\n  return parseInt(d3.select(selector).node().value);\n}\n\n\nfunction valueFloat(selector) {\n  return parseFloat(d3.select(selector).node().value);\n}\n\n\nfunction checked(selector) {\n  return d3.select(selector).node().checked;\n}\n\n\nfunction firstFile(selector) {\n  return d3.select(selector).node().files[0];\n}\n\n\nfunction inputValues(selector) {\n  return d3.selectAll(selector).selectAll('input').nodes().map(e => e.value);\n}\n\n\nfunction checkboxValues(selector) {\n  return d3.selectAll(selector).selectAll('input:checked').nodes().map(e => e.value);\n}\n\n\nfunction optionValues(selector) {\n  return d3.selectAll(selector).selectAll('select').nodes().map(e => e.value);\n}\n\n\nfunction textareaLines(selector) {\n  return d3.select(selector).node().value.split('\\n').filter(e => e.length > 0);\n}\n\n\nfunction optionData(selector) {\n  const si = d3.select(selector).property('selectedIndex');\n  return d3.select(selector).selectAll('option').data().find((d, i) => i === si);\n}\n\n\nfunction checkboxData(selector) {\n  return d3.selectAll(selector).selectAll('input:checked').data();\n}\n\n\nexport default {\n  value, valueInt, valueFloat, checked,\n  firstFile, inputValues, checkboxValues, optionValues, textareaLines,\n  optionData, checkboxData\n};\n","\n/** @module helper/definition */\n\n\nfunction defaultFieldProperties(fields) {\n  return fields.map(e => {\n    if (!e.hasOwnProperty('name')) e.name = e.key;\n    if (!e.hasOwnProperty('visible')) e.visible = true;\n    if (e.hasOwnProperty('d3_format')) e.format = 'd3_format';\n    if (!e.hasOwnProperty('format')) e.format = 'raw';\n    return e;\n  });\n}\n\n\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id'].includes(fmt)) return 'text';\n  return 'none';\n}\n\n\nfunction ongoing(data) {\n  return ['running', 'ready'].includes(data.status);\n}\n\n\nexport default {\n  defaultFieldProperties, sortType, ongoing\n};\n","\n\nclass KArray extends Array {\n  /**\n   * Return array of object filtered by given unique key\n   */\n  unique(key) {\n    return this.reduce((a, b) => {\n      if (a.find(e => e[key] === b[key]) === undefined) a.push(b);\n      return a;\n    }, new KArray());\n  }\n\n\n  /**\n   * Merge arrays\n   */\n  extend() {\n    return this.reduce((a, b) => {\n      Array.prototype.push.apply(a, b);\n      return a;\n    }, new KArray());\n  }\n\n\n  // Merge arrays(Asynchronous)\n  extendAsync() {\n    return Promise.all(this).then(res => {\n      return res.reduce((a, b) => {\n        Array.prototype.push.apply(a, b);\n        return a;\n      }, new KArray());\n    });\n  }\n\n  toArray() {\n    return new Array(this);\n  }\n\n  toObject() {\n    const obj = {};\n    this.forEach(kv => {\n      obj[kv[0]] = kv[1];\n    });\n    return obj;\n  }\n}\n\nexport default KArray;\n","\nimport KArray from './KArray.js';\n\n\nfunction URLQuery() {\n  return KArray.from(window.location.search.substring(1).split(\"&\"))\n    .map(e => e.split('=')).toObject();\n}\n\n\nexport default {\n  URLQuery\n};\n","\nconst baseURL = '';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\n\nexport default {\n  get, json, text, blob, post, error\n};\n","\n/** @module helper/parser */\n\nfunction getSDFPropList(str) {\n  const re = />.*?<(\\S+)>/g;\n  const uniqCols = new Set();\n  let arr;\n  while ((arr = re.exec(str)) !== null) {\n    uniqCols.add(arr[1]);\n  }\n  return Array.from(uniqCols);\n}\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n// TODO: not used\nfunction queryFormData(query) {\n  const formData = new FormData();\n  Object.entries(query).forEach(kv => {\n    if (Array.isArray(kv[1])) {\n      kv[1].forEach(e => formData.append(kv[0], e));\n    } else {\n      formData.set(kv[0], kv[1]);\n    }\n  });\n  return formData;\n}\n\n\n// TODO: not used\nfunction queryURL(query) {\n  const queryStr = [];\n  Object.entries(query).forEach(e => {\n    const val = Array.isArray(e[1]) ? JSON.stringify(e[1]) : e[1];\n    const key = e[0];\n    // const encoded = encodeURIComponent(val);\n    queryStr.push(`${key}=${val}`);\n  });\n  return queryStr.join('&');\n}\n\n\n// TODO: not used\nfunction capitalized(str) {\n  return str.replace(/(?:^|\\s)\\S/g, e => e.toUpperCase());\n}\n\n\nexport default {\n  getSDFPropList, uuidv4\n};\n","\nimport Dexie from 'Dexie';\n\n// TODO: can indexed records improve query performance ?\n\nconst schema = {\n  app: 'key',\n  items: 'id, dataType, created',\n  resources: 'id'\n};\n\nlet idb = new Dexie('Store');\nidb.version(1).stores(schema);\n\n\nfunction getAppSetting(key) {\n  return idb.app.where('key').equals(key).first()\n    .then(res => {\n      if (res === undefined) return undefined;\n      return res.value;\n    });\n}\n\n\nfunction putAppSetting(k, v) {  // returns id in success\n  return idb.app.put({ key: k, value: v });\n}\n\n\nfunction getResources() {\n  return idb.resources.toArray();\n}\n\n\nfunction putResources(data) { // returns last id in success\n  return idb.resources.bulkPut(data);\n}\n\n\nfunction getAllItems() {\n  return idb.items.orderBy('created').reverse()\n    .toArray();\n}\n\n\nfunction getItemsByDataType(type) {\n  return idb.items.where('dataType').equals(type).reverse()\n    .sortBy('created');\n}\n\n\nfunction getItemById(tableId) {\n  return idb.items.where('id').equals(tableId).first();\n}\n\n\nfunction updateItem(tableId, callback) {  // returns num of updated items\n  return idb.items.where('id').equals(tableId).modify(callback);\n}\n\n\nfunction deleteItem(tableId) { // returns num of deleted items\n  return idb.items.where('id').equals(tableId).delete();\n}\n\n\nfunction putItem(data) { // returns id in success\n  return idb.items.put(data);\n}\n\n\nfunction reset() {\n  // Try this before tackling with local db troubles\n  return idb.delete().then(() => {\n    idb = new Dexie('Store');\n    idb.version(1).stores(schema);\n  });\n}\n\nexport default {\n  getAppSetting, putAppSetting, getResources, putResources,\n  getAllItems, getItemsByDataType, getItemById,\n  updateItem, deleteItem, putItem, reset\n};\n","\n/** @module helper/image */\n\nimport vega from 'vega';\n\nfunction showPlot(vegaSpec, selector) {\n  new vega.View(vega.parse(vegaSpec))\n    .initialize(selector)\n    .run();\n}\n\n\nfunction plotThumbnail(vegaSpec) {\n  const view = new vega.View(vega.parse(vegaSpec));\n  return view.toImageURL('png');  // Promise\n}\n\n\nexport default {\n  showPlot, plotThumbnail\n};\n","\n/** @module component/Dialog */\n\nimport d3 from 'd3';\n\nimport KArray from '../helper/KArray.js';\nimport {default as d3form} from '../helper/d3Form.js';\nimport {default as mapper} from '../helper/mapper.js';\nimport {default as def} from '../helper/definition.js';\nimport {default as fmt} from '../helper/formatValue.js';\nimport {default as win} from '../helper/window.js';\nimport {default as hfile} from '../helper/file.js';\nimport {default as misc} from '../helper/misc.js';\nimport {default as himg} from '../helper/image.js';\nimport {default as store} from '../store/StoreConnection.js';\nimport {default as cmp} from './Component.js';\nimport {default as fetcher} from '../fetcher.js';\n\n\nfunction pickDialog(resources, callback) {\n  store.getAppSetting('compoundIDPlaceholder').then(ids => {\n    d3.select('#pick-queryarea').text(ids);\n  });\n  d3.select('#pick-submit')\n    .on('click', () => {\n      d3.select('#loading-icon').style('display', 'inline');\n      const query = {\n        type: 'chemsearch',\n        targets: resources.filter(e => e.domain === 'chemical').map(e => e.id),\n        key: 'compound_id',\n        values: d3form.textareaLines('#pick-queryarea')\n      };\n      return fetcher.get('run', query)\n        .then(fetcher.json)\n        .then(callback, fetcher.error);\n    });\n}\n\n\nfunction propDialog(resources, callback) {\n  d3.select('#prop-targets')\n    .call(cmp.checkboxList, resources, 'targets', d => d.id, d => d.name)\n    .on('change', function () {\n      const cols = KArray.from(d3form.checkboxData('#prop-targets'))\n        .map(d => d.fields)\n        .extend().unique('key');\n      d3.select('#prop-key')\n        .call(cmp.selectOptions, cols, d => d.key, d => d.name);\n    });\n  d3.select('#prop-submit')\n    .on('click', () => {\n      d3.select('#loading-circle').style('display', 'inline');\n      const query = {\n        type: 'chemprop',\n        targets: d3form.checkboxValues('#prop-targets'),\n        key: d3form.optionData('#prop-key').key,\n        values: d3form.textareaLines('#prop-queryarea'),\n        operator: d3form.value('#prop-operator')\n      };\n      return fetcher.get('async', query)\n        .then(fetcher.json)\n        .then(callback, fetcher.error);\n    });\n}\n\n\nfunction structDialog(resources, callback) {\n  d3.select('#struct-qsrc')\n    .call(cmp.selectOptions, resources, d => d.id, d => d.name);\n  d3.select('#struct-targets')\n    .call(cmp.checkboxList, resources, 'targets', d => d.id, d => d.name);\n  store.getAppSetting('rdkit').then(rdk => {\n    d3.select('#struct-method').selectAll('option.rd')\n      .attr('disabled', rdk ? null : 'disabled');\n  });\n  d3.selectAll('#struct-method,#struct-thldtype')\n    .on('change', function () {\n      const method = d3form.value('#struct-method');\n      const thldtype = d3form.value('#struct-thldtype');\n      d3.select('#struct-thld')\n        .attr('disabled', ['gls', 'rdmorgan', 'rdfmcs'].includes(method) ? null : 'disabled')\n        .attr('value', thldtype === 'edge' ? 15 : 0.7)\n        .attr('min', thldtype === 'edge' ? 5 : 0)\n        .attr('max', thldtype === 'edge' ? 999 : 1.0)\n        .attr('step', thldtype === 'edge' ? 1 : 0.01);\n      d3.select('#struct-thldtype')\n        .attr('disabled', ['gls', 'rdmorgan', 'rdfmcs'].includes(method) ? null : 'disabled')\n        .property('value', ['gls', 'rdfmcs'].includes(method) ? undefined : 'sim');\n      d3.select('#struct-thldtype option.sim')\n        .attr('disabled', ['gls', 'rdmorgan', 'rdfmcs'].includes(method) ? null : 'disabled');\n      d3.select('#struct-thldtype option.edge')\n        .attr('disabled', ['gls', 'rdfmcs'].includes(method) ? null : 'disabled');\n      d3.select('#struct-options').selectAll('.gls')\n        .attr('disabled', method === 'gls' ? null : 'disabled');\n      d3.select('#struct-options .fmcs')\n        .attr('disabled', method === 'rdfmcs' ? null : 'disabled');\n    })\n    .dispatch('change');\n  d3.select('#struct-format')\n    .on('change', function () {\n      d3.select('#struct-qsrc')\n        .attr('disabled', this.value === 'dbid' ? null : 'disabled');\n    });\n  d3.select('#struct-preview')\n    .on('click', () => {\n      const f = d3form.value('#struct-format');\n      const query = {\n        format: f,\n        source: f === 'dbid' ? d3form.value('#struct-qsrc') : null,\n        value: f === 'molfile'\n          ? d3form.value('#struct-queryarea') : d3form.textareaLines('#struct-queryarea')[0],\n      };\n      return fetcher.get('strprev', query)\n        .then(fetcher.text)\n        .then(res => d3.select('#struct-image').html(res), fetcher.error);\n    });\n  d3.select('#struct-submit')\n    .on('click', () => {\n      const method = d3form.value('#struct-method');\n      d3.select('#loading-circle').style('display', 'inline');\n      const f = d3form.value('#struct-format');\n      const query = {\n        type: d3form.value('#struct-method'),\n        targets: d3form.checkboxValues('#struct-targets'),\n        queryMol: {\n          format: f,\n          source: f === 'dbid' ? d3form.value('#struct-qsrc') : null,\n          value: f === 'molfile'\n            ? d3form.value('#struct-queryarea') : d3form.textareaLines('#struct-queryarea')[0]\n        },\n        params: {\n          measure: d3form.value('#struct-thldtype'),\n          threshold: d3form.valueFloat('#struct-thld'),\n          ignoreHs: d3form.checked('#struct-ignoreh'),\n          diameter: method === 'gls' ? d3form.valueInt('#struct-diam') : null,\n          maxTreeSize: method === 'gls' ? d3form.valueInt('#struct-tree') : null,\n          molSizeCutoff: method === 'gls' ? d3form.valueInt('#struct-skip') : null,\n          timeout: method === 'rdfmcs' ? d3form.valueInt('#struct-timeout') : null\n        }\n      };\n      const command = query.type === 'exact' ? 'run' : 'async';\n      return fetcher.get(command, query)\n        .then(fetcher.json)\n        .then(callback, fetcher.error);\n    });\n}\n\n\nfunction sdfDialog(callback) {\n  d3.select('#sdf-file')\n    .on('change', () => {\n      const reader = new FileReader();\n      const file = document.getElementById('sdf-file').files[0];\n      reader.onload = (e) => {\n        d3.select('#sdf-cols')\n          .call(cmp.checkboxList, misc.getSDFPropList(e.target.result),\n                'fields', d => d, d => d\n          );\n      };\n      // Scan only first 100mb of the file due to memory limit.\n      reader.readAsText(file.slice(0, 100 * 1024 * 1024));\n    });\n  d3.select('#sdf-selectall')\n    .on('change', () => {\n      d3.select('#sdf-cols').selectAll('input')\n        .property('checked', d3form.checked('#sdf-selectall'));\n    });\n  d3.select('#sdf-submit')\n    .on('click', () => {\n      d3.select('#loading-circle').style('display', 'inline');\n      const params = {\n        fields: d3form.checkboxValues('#sdf-cols'),\n        implh: d3form.checked('#sdf-implh'),\n        recalc: d3form.checked('#sdf-recalc')\n      };\n      const formData = new FormData();\n      formData.append('contents', d3form.firstFile('#sdf-file'));\n      formData.append('params', JSON.stringify(params));\n      return fetcher.post('sdfin', formData)\n        .then(fetcher.json)\n        .then(callback, fetcher.error);\n    });\n}\n\n\nfunction columnDialog(dataFields, callback) {\n  const table = {\n    fields: def.defaultFieldProperties([\n      {key: 'name', format: 'text'},\n      {key: 'visible', format: 'control'},\n      {key: 'format', format: 'control'},\n      {key: 'd3_format', format: 'control'}\n    ])\n  };\n  const records = dataFields.map(e => {\n    const rcd = {};\n    const generalFormat = ['text', 'numeric', 'd3_format', 'raw', 'compound_id'];\n    rcd.name = e.name;\n    rcd.visible = selection => selection\n        .classed('column-vis', true)\n        .classed(`row-${e.key}`, true)\n      .append('input')\n        .attr('type', 'checkbox')\n        .attr('value', e.key)\n        .property('checked', e.visible);\n    rcd.format = selection => selection\n        .classed('column-format', true)\n        .classed(`row-${e.key}`, true)\n      .append('select')\n        .call(cmp.selectOptions,\n              generalFormat.includes(e.format) ? generalFormat : [e.format],\n              d => d, d => d)\n        .attr('disabled', generalFormat.includes(e.format) ? null : 'disabled')\n        .property('value', e.format)\n        .on('change', function () {\n          d3.select(`.column-d3f.row-${e.key} input`)\n            .attr('disabled', this.value === 'd3_format' ? null : 'disabled');\n        });\n    rcd.d3_format = selection => selection\n        .classed('column-d3f', true)\n        .classed(`row-${e.key}`, true)\n      .append('input')\n        .attr('size', 10)\n        .attr('disabled', e.format === 'd3_format' ? null : 'disabled')\n        .property('value', e.d3_format);\n    return rcd;\n  });\n  d3.select('#column-table')\n    .call(cmp.createTable, table)\n    .call(cmp.updateTableRecords, records, d => d.key);\n  d3.select('#column-submit')\n    .on('click', () => {\n      const query = {\n        visibles: d3form.checkboxValues('.column-vis'),\n        formats: d3form.optionValues('.column-format'),\n        d3_formats: d3form.inputValues('.column-d3f')\n      };\n      return store.setFieldProperties(win.URLQuery().id, query)\n        .then(callback);\n    });\n}\n\n\n// TODO:\nfunction fieldFetchDialog(compoundIDs, dataFields, resources, callback) {\n  // Prevent implicit submission\n  document.getElementById('join-search')\n    .addEventListener('keypress', event => {\n      if (event.keyCode === 13) event.preventDefault();\n    });\n  const dataKeys = dataFields.map(e => e.key);\n  const resourceFields = KArray.from(resources.map(e => e.fields))\n    .extend().unique('key').filter(e => e.key !== 'id');\n  d3.select('#join-keys')\n    .call(cmp.checkboxList, resourceFields, 'keys', d => d.key, d => d.name)\n    .selectAll('li')\n    .each(function(d) { // disable already shown columns\n      d3.select(this).selectAll('label').select('input')\n        .property('checked', dataKeys.includes(d.key))\n        .attr('disabled', dataKeys.includes(d.key) ? 'disabled' : null);\n    });\n  d3.select('#join-search')\n    .on('keyup', function () {\n      const match = d => fmt.partialMatch(d3form.value(this), d.name);\n      d3.select('#join-keys').selectAll('li')\n        .style('visibility', d => match(d) ? null : 'hidden')\n        .style('position', d => match(d) ? null : 'absolute');\n    });\n  d3.select('#join-submit')\n    .on('click', () => {\n      d3.select('#loading-circle').style('display', 'inline');\n      const selected = d3form.checkboxValues('#join-keys');\n      const queryFieldKeys = resourceFields.map(e => e.key)\n        .filter(e => !dataKeys.includes(e))\n        .filter(e => selected.includes(e));\n      const query = {\n        type: 'fieldfilter',\n        targetFields: queryFieldKeys,\n        key: 'compound_id',\n        values: compoundIDs\n      };\n      return fetcher.get('run', query)\n        .then(fetcher.json)\n        .then(json => callback(mapper.tableToMapping(json, 'id')),\n              fetcher.error);\n  });\n}\n\n\nfunction fieldFileDialog(callback) {\n  // TODO: need to refactor\n  d3.select('#importcol-file')\n    .on('change', () => {\n      const file = document.getElementById('importcol-file').files[0];\n      const isCsv = file.name.split('.').pop() === 'csv';\n      hfile.readFile(file).then(res => {\n        const mapping = isCsv ? mapper.csvToMapping(res) : JSON.parse(res);\n        const tbl = mapper.mappingToTable(mapping);\n        d3.select('#importcol-preview').call(cmp.createTable, tbl)\n          .call(cmp.updateTableRecords,\n                tbl.records.slice(0, 5), d => d[tbl.fields[0].key]);\n        // bind mapping\n        d3.select('#importcol-preview').datum(mapping);\n      });\n    });\n  d3.select('#importcol-submit')\n    .on('click', () => {\n      let mapping = d3.select('#importcol-preview').datum();\n      d3.select('#importcol-preview').datum(null);  // unbind mapping\n      // Generate thumbnails\n      const plotCols = [];\n      if (mapping.hasOwnProperty('field')) {\n        mapping = mapper.singleToMulti(mapping);\n      }\n      mapping.fields.forEach((e, i) => {\n        if (e.format === 'plot') {\n          mapping.fields[i].format = 'image';\n          plotCols.push(i);\n        }\n      });\n      if (plotCols.length > 0) {\n        const ps = [];\n        Object.entries(mapping.mapping).forEach(m => {\n          plotCols.forEach(e => {\n            const p = himg.plotThumbnail(m[1][e])\n              .then(img => {\n                mapping.mapping[m[0]][e] = img;\n              });\n            ps.push(p);\n          });\n        });\n        Promise.all(ps).then(() => callback(mapping));\n      } else {\n        callback(mapping);\n      }\n    });\n}\n\n\nfunction graphDialog(callback) {\n  store.getAppSetting('rdkit').then(rdk => {\n    d3.select('#graph-measure').selectAll('option.rd')\n      .attr('disabled', rdk ? null : 'disabled');\n  });\n  d3.select('#graph-measure')\n    .on('change', function () {\n      d3.select('#graph-options').selectAll('.gls')\n        .attr('disabled', this.value === 'gls' ? null : 'disabled');\n      d3.select('#graph-options').selectAll('.fmcs')\n        .attr('disabled', this.value === 'rdfmcs' ? null : 'disabled');\n    });\n  d3.select('#graph-submit')\n    .on('click', () => {\n      d3.select('#loading-circle').style('display', 'inline');\n      const measure = d3form.value('#graph-measure');\n      const params = {\n        measure: measure,\n        threshold: d3form.valueFloat('#graph-thld'),\n        ignoreHs: d3form.checked('#graph-ignoreh'),\n        diameter: measure === 'gls' ? d3form.valueInt('#graph-diam') : null,\n        maxTreeSize: measure === 'gls' ? d3form.valueInt('#graph-tree') : null,\n        molSizeCutoff: measure === 'gls' ? d3form.valueInt('#graph-skip') : null,\n        timeout: measure === 'rdfmcs' ? d3form.valueInt('#graph-timeout') : null\n      };\n      callback(params);\n    });\n}\n\n\nfunction graphConfigDialog(currentThld, minThld, callback) {\n  d3.select('#graphconfig-thld')\n    .attr('value', currentThld)\n    .attr('max', 1.0)\n    .attr('min', minThld);\n  d3.select('#graphconfig-submit')\n    .on('click', () => {\n      const newThld = d3form.valueFloat('#graphconfig-thld');\n      if (newThld < minThld) return;  // TODO: fool proof\n      callback(newThld);\n    });\n}\n\n\nfunction communityDialog(callback) {\n  d3.select('#community-name').attr('value', 'comm_');\n  d3.select('#community-submit')\n    .on('click', () => {\n      const query = {\n        name: d3form.value('#community-name'),\n        nulliso: d3form.checked('#community-nulliso')\n      };\n      callback(query);\n    });\n}\n\n\nfunction importConfirmDialog(callback) {\n  d3.select('#importconfirm-overwrite')\n    .on('click', () => callback('overwrite'));\n  d3.select('#importconfirm-keepboth')\n    .on('click', () => callback('keepboth'));\n  d3.select('#importconfirm-cancel')\n    .on('click', () => callback('cancel'));\n}\n\n\nexport default {\n  pickDialog, propDialog, structDialog, sdfDialog,\n  columnDialog, fieldFetchDialog, fieldFileDialog, graphDialog,\n  graphConfigDialog, communityDialog, importConfirmDialog\n};\n","\n/** @module component/Header */\n\nimport d3 from 'd3';\nimport {default as def} from '../helper/definition.js';\n\n\nfunction renderStatus(data, refresh_callback, abort_callback) {\n  d3.select('#loading-circle').style('display', 'none');\n  d3.select('title').text(data.name);\n  d3.select('#title').text(data.name);\n  d3.select('#refresh')\n    .style('display', def.ongoing(data) ? 'inline-block' : 'none');\n  d3.select('#abort')\n    .style('display', def.ongoing(data) ? 'inline-block' : 'none');\n  const doneText = {\n    'nodes': 'entries found',\n    'edges': 'connections created'\n  };\n  const dtx = doneText[data.dataType];\n  d3.select('#progress')\n    .text(`(${data.status} - ${data.records.length} ${dtx} in ${data.execTime} sec.)`);\n  if (def.ongoing(data)) {\n    d3.select('#progress').append('div').append('progress')\n      .attr('max', 100)\n      .attr('value', data.progress)\n      .text(`${data.progress}%`);\n  }\n  d3.select('#refresh').on('click', refresh_callback);\n  d3.select('#abort')\n    .on('click', () => {\n      d3.select('#confirm-message')\n        .text('Are you sure you want to abort this calculation job?');\n      d3.select('#confirm-submit')\n        .classed('btn-primary', false)\n        .classed('btn-warning', true)\n        .on('click', abort_callback);\n    });\n  console.info('Query');\n  console.info(data.query);  // query datails are available on browser console.\n}\n\n\nfunction initializeWithData() {\n  d3.select('#new-data').style('display', 'none');\n  d3.select('#loading-circle').style('display', 'none');\n}\n\n\nfunction initialize() {\n  d3.select('#data-control').style('display', 'none');\n  d3.select('#nodedata').style('display', 'none');\n  d3.select('#refresh').style('display', 'none');\n  d3.select('#abort').style('display', 'none');\n  d3.select('#loading-circle').style('display', 'none');\n  d3.select('#status').selectAll('li').style('display', 'none');\n}\n\n\nexport default {\n  renderStatus, initializeWithData, initialize\n};\n"],"names":["v07_to_v08_nodes","json","fields","columns","map","e","format","id","name","dataType","dataTypeConv","schemaVersion","revision","status","statusConv","records","query","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","progress","execTime","created","startDate","responseDate","v07_to_v08_convert","hasOwnProperty","nodes","edges","nodeFields","snp","fieldTransform","snapshot","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","field","find","key","column","domain","range","unknown","size","text","visible","nodeContent","structure","label","reference","nodeTableId","def","defaultFieldProperties","networkThreshold","v07_to_v08_edges","readFile","file","sizeLimit","blob","Promise","resolve","reject","reader","FileReader","truncated","slice","onload","event","target","result","onerror","error","readAsArrayBuffer","readAsText","parseJSON","data","compressed","pako","inflate","to","JSON","parse","downloadDataFile","url","window","URL","createObjectURL","Blob","a","document","createElement","download","href","dispatchEvent","MouseEvent","view","bubbles","cancelable","singleToMulti","mapping","newMapping","Object","entries","forEach","m","updateTableAttribute","value","store","updateItem","item","catch","err","console","numericAsc","b","fa","parseFloat","fb","isNaN","String","localeCompare","textAsc","updateTableRecords","selection","rcds","keyFunc","header","select","selectAll","rowSelection","exit","remove","rowEntered","enter","append","d","merge","classed","html","i","undefined","fmt","formatNum","d3_format","each","d3","call","registerServiceWorker","navigator","serviceWorker","register","then","reg","info","scope","dataGridRecords","rSize","datum","bodyHeight","length","height","position","visibleRows","style","on","scrollTop","this","node","newPos","Math","min","floor","cData","topPos","max","bottomPos","rcdSlice","attr","width","order","ri","rowPos","_","img","showPlot","updateRows","viewport","viewportTop","getBoundingClientRect","top","viewportHeight","innerHeight","newVis","ceil","dispatch","render","getTable","win","URLQuery","dialog","columnDialog","fieldFileDialog","joinFields","renderStatus","common","fetchResults","d3form","t","grid","createDataGrid","index","addSort","getResources","rsrc","actres","filter","compoundIDs","fieldFetchDialog","graphDialog","params","formData","FormData","stringify","fetcher","post","threshold","interactiveInsert","open","hfile","downloadJSON","loadNewTable","location","selector","valueInt","parseInt","valueFloat","checked","firstFile","files","inputValues","checkboxValues","optionValues","textareaLines","split","optionData","si","property","checkboxData","sortType","includes","ongoing","Queued","In progress","Aborting","Aborted","Completed","Failure","datatable","connection","loadJSON","endsWith","fetchJSON","decoded","decodeURIComponent","fetch","res","arrayBuffer","compress","str","gzip","c","KArray","Array","[object Object]","reduce","push","prototype","apply","all","obj","kv","from","search","substring","toObject","baseURL","get","q","keys","credentials","Error","statusText","response","formdata","method","body","getSDFPropList","re","uniqCols","Set","arr","exec","add","uuidv4","replace","r","random","toString","mappingToTable","mp","keyField","concat","entry","rcd","f","tableToMapping","table","ignore","Date","row","csvToMapping","csvString","lines","shift","now","headerIdx","h","line","values","k","fd","unique","schema","app","items","resources","idb","Dexie","version","stores","where","equals","first","putAppSetting","v","put","toArray","putResources","bulkPut","getAllItems","orderBy","reverse","getItemsByDataType","type","sortBy","getItemById","tableId","callback","modify","deleteItem","delete","putItem","getAppSetting","setAppSetting","setResources","rsrcs","getAllTables","getTablesByDataType","setFieldProperties","updates","visibles","formats","d3_formats","mapper","insertTable","updateTable","assign","deleteTable","reset","d3format","Number","partialMatch","toUpperCase","indexOf","numericDesc","textDesc","vegaSpec","vega","View","initialize","run","plotThumbnail","toImageURL","selectOptions","options","checkboxList","entered","updated","checkboxListT","description","createTable","cols","appendTableRows","newRcds","isAsc","isNum","cmp","sort","formatNumbers","col","colIdx","digit","pickDialog","ids","targets","propDialog","extend","operator","structDialog","rdk","thldtype","source","queryMol","measure","ignoreHs","diameter","maxTreeSize","molSizeCutoff","timeout","command","sdfDialog","getElementById","misc","implh","recalc","dataFields","generalFormat","addEventListener","keyCode","preventDefault","dataKeys","resourceFields","match","selected","targetFields","isCsv","pop","tbl","plotCols","ps","p","himg","graphConfigDialog","currentThld","minThld","newThld","communityDialog","nulliso","importConfirmDialog","found","$","modal","action","loader","server","local","serverStatus","clientInstance","debugMode","instance","templates","compoundIDPlaceholder","defaultDataType","rdkit","refresh_callback","abort_callback","dtx","initializeWithData","defaultColumnWidth","numeric","none","defaultColumnHeight","scrollBarSpace","rowSize","sorted","click","stopPropagation","chemres"],"mappings":"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"}