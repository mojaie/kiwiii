{"version":3,"file":"kw-network.js","sources":["../src/common/misc.js","../src/common/legacySchema.js","../src/common/idb.js","../src/common/fetcher.js","../src/common/mapper.js","../src/common/collection.js","../src/common/transform.js","../src/common/scale.js","../src/component/badge.js","../src/component/formBox.js","../src/component/shape.js","../src/component/formListBox.js","../src/component/formRangeBox.js","../src/component/dropdown.js","../src/component/formBoxGroup.js","../src/component/controlBox.js","../src/component/button.js","../src/component/legend.js","../src/component/transform.js","../src/network/explorativeNetwork.js","../src/network/component.js","../src/network/interaction.js","../src/network/force.js","../src/network/controlBox.js","../src/network.js","../src/network/state.js"],"sourcesContent":["\n/** @module common/misc */\n\nimport d3 from 'd3';\n\n\n// TODO: re-define\nfunction sortType(fmt) {\n  if (['numeric', 'd3_format'].includes(fmt)) return 'numeric';\n  if (['text', 'compound_id', 'assay_id', 'list'].includes(fmt)) return 'text';\n  if (['text_field', 'checkbox', 'html'].includes(fmt)) return 'html';\n  return 'none';\n}\n\n\n/**\n * Format number\n * @param {object} value - value\n * @param {string} type - si | scientific | rounded | raw\n */\nfunction formatNum(value, d3format) {\n  if (value === undefined || value === null || Number.isNaN(value)) return '';\n  return value == parseFloat(value) ? d3.format(d3format)(value) : value;\n}\n\n\nfunction partialMatch(query, target) {\n  if (target === undefined || target === null || target === '') return false;\n  return target.toString().toUpperCase()\n    .indexOf(query.toString().toUpperCase()) !== -1;\n}\n\n\n// Ref. https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\nfunction uuidv4() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n\nexport default {\n  sortType, formatNum, partialMatch, uuidv4\n};\n","\n/** @module common/legacySchema */\n\nimport d3 from 'd3';\n\n\nconst statusConv = {\n  Queued: 'ready',\n  'In progress': 'running',\n  Aborting: 'running',\n  Aborted: 'aborted',\n  Completed: 'done',\n  Failure: 'failure'\n};\n\nconst dataTypeConv = {\n  datatable: 'nodes',\n  connection: 'edges'\n};\n\nfunction v07_to_v08_nodes(json) {\n  const fields = json.columns.map(e => {\n    if (e.sort === 'numeric') {\n      e.format = 'numeric';\n    } else if (e.sort === 'text') {\n      e.format = 'text';\n    } else if (e.sort === 'none') {\n      e.format = 'raw';\n    }\n    return e;\n  });\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    status: statusConv[json.status],\n    fields: fields,\n    records: json.records,\n    query: json.query,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n  };\n}\n\nfunction v07_to_v08_edges(json, nodeFields) {\n  const snp = {\n    fieldTransform: json.snapshot.fieldTransform,\n    nodePositions: json.snapshot.nodePositions,\n    nodeColor: {},\n    nodeSize: {},\n    nodeLabel: {},\n    edge: {}\n  };\n  if (json.snapshot.hasOwnProperty('nodeColor')) {\n    snp.nodeColor.id = json.snapshot.nodeColor.id;\n    snp.nodeColor.scale = json.snapshot.nodeColor.scale;\n    snp.nodeColor.field = nodeFields.find(e => e.key === json.snapshot.nodeColor.column);\n  } else {\n    snp.nodeColor = {\n      id: 'color', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeSize')) {\n    snp.nodeSize.id = json.snapshot.nodeSize.id;\n    snp.nodeSize.scale = json.snapshot.nodeSize.scale;\n    snp.nodeSize.field = nodeFields.find(e => e.key === json.snapshot.nodeSize.column);\n  } else {\n    snp.nodeSize = {\n      id: 'size', field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: [20, 20], unknown: 20}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeLabel')) {\n    snp.nodeLabel.id = json.snapshot.nodeLabel.id;\n    snp.nodeLabel.size = json.snapshot.nodeLabel.size;\n    snp.nodeLabel.text = json.snapshot.nodeLabel.text;\n    snp.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n    snp.nodeLabel.scale = json.snapshot.nodeLabel.scale;\n    snp.nodeLabel.field = nodeFields.find(e => e.key === json.snapshot.nodeLabel.column);\n  } else {\n    snp.nodeLabel = {\n      id: 'label', size: 12, text: 'index', visible: false, field: nodeFields[0],\n      scale: {scale: 'linear', domain: [0, 1], range: ['black', 'white'], unknown: 'gray'}\n    };\n  }\n  if (json.snapshot.hasOwnProperty('nodeContent')) {\n    snp.nodeContent = json.snapshot.nodeContent;\n  } else {\n    snp.nodeContent = {structure: {visible: false}};\n  }\n  if (json.snapshot.hasOwnProperty('edge')) {\n    snp.edge = json.snapshot.edge;\n  } else {\n    snp.edge = {\n      id: 'label', label: {size: 10, visible: false}, visible: true,\n      scale: {scale: 'linear', domain: [0, 1], range: [5, 5], unknown: 5}\n    };\n  }\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: dataTypeConv[json.format],\n    schemaVersion: 0.8,\n    revision: 0,\n    reference: {\n      nodes: json.nodeTableId\n    },\n    status: statusConv[json.status],\n    fields: [\n      {'key': 'source'},\n      {'key': 'target'},\n      {'key': 'weight'}\n    ],\n    records: json.records,\n    query: json.query,\n    networkThreshold: json.networkThreshold,\n    taskCount: json.searchCount,\n    doneCount: json.searchDoneCount | json.searchCount,\n    resultCount: json.recordCount,\n    progress: json.progress | 100,\n    execTime: json.execTime,\n    created: json.startDate | json.responseDate,\n    snapshot: snp\n  };\n}\n\n\nfunction v08_nodes(json) {\n  json.records.forEach((e, i) => {\n    e.index = i;\n    e.structure = e._structure;\n    delete e._index;\n    delete e._structure;\n  });\n  json.fields.forEach(e => {\n    if (e.key === '_index') e.key = 'index';\n    if (e.key === '_structure') e.key = 'structure';\n    if (e.sort === 'numeric') e.format = 'numeric';\n    if (e.sort === 'text') e.format = 'text';\n    if (e.sort === 'none') e.format = 'raw';\n  });\n  return json;\n}\n\nfunction v08_graph(json) {\n  if (!json.edges.hasOwnProperty('reference')) { // ver0.8.0-0.8.1\n    json.edges.reference = {nodes: json.edges.nodesID};\n  }\n  if (json.nodes.fields.find(e => e.key === '_index')) {\n    const idx_converter = {};\n    json.nodes.records.forEach((e, i) => {\n        e.index = i;\n        e.structure = e._structure;\n        idx_converter[e._index] = e.index;\n        delete e._index;\n        delete e._structure;\n    });\n    json.edges.records.forEach(e => {\n        e.source = idx_converter[e.source];\n        e.target = idx_converter[e.target];\n    });\n    json.nodes.fields.forEach(e => {\n      if (e.key === '_index') e.key = 'index';\n      if (e.key === '_structure') e.key = 'structure';\n      if (e.sort === 'numeric') e.format = 'numeric';\n      if (e.sort === 'text') e.format = 'text';\n      if (e.sort === 'none') e.format = 'raw';\n    });\n  }\n  return json;\n}\n\nfunction v10_nodes(json) {\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: json.query,\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    reference: {}\n  };\n}\n\n\nfunction v10_edges(json) {\n  const snapshot = {\n    networkThreshold: json.networkThreshold\n  };\n  snapshot.nodeContentVisible = json.snapshot.nodeContent.structure.visible;\n  snapshot.nodeColor = json.snapshot.nodeColor.scale || {};\n  if (snapshot.nodeColor.field) {\n    snapshot.nodeColor.field = json.snapshot.nodeColor.field.key;\n    if (snapshot.nodeColor.field === '_index') {\n      snapshot.nodeColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeColor.scale === 'ordinal') {\n    snapshot.nodeColor.range = d3.schemeCategory20;\n  }\n  snapshot.nodeSize = json.snapshot.nodeSize.scale || {};\n  if (json.snapshot.nodeSize.field) {\n    snapshot.nodeSize.field = json.snapshot.nodeSize.field.key;\n    if (snapshot.nodeSize.field === '_index') {\n      snapshot.nodeSize.field = 'index';\n    }\n  }\n  snapshot.nodeLabel = {};\n  if (json.snapshot.nodeLabel.text) {\n    snapshot.nodeLabel.text = json.snapshot.nodeLabel.text.key;\n    if (snapshot.nodeLabel.text === '_index') {\n      snapshot.nodeLabel.text = 'index';\n    }\n  }\n  snapshot.nodeLabel.size = json.snapshot.nodeLabel.size;\n  snapshot.nodeLabel.visible = json.snapshot.nodeLabel.visible;\n  snapshot.nodeLabelColor = json.snapshot.nodeLabel.scale || {};\n  if (json.snapshot.nodeLabel.field) {\n    snapshot.nodeLabelColor.field = json.snapshot.nodeLabel.field.key;\n    if (snapshot.nodeLabelColor.field === '_index') {\n      snapshot.nodeLabelColor.field = 'index';\n    }\n  }\n  if (snapshot.nodeLabelColor.scale === 'ordinal') {\n    snapshot.nodeLabelColor.range = d3.schemeCategory20;\n  }\n  snapshot.edgeVisible = json.snapshot.edge.visible;\n  snapshot.edgeWidth = json.snapshot.edge.scale || {};\n  snapshot.edgeLabel = {};\n  snapshot.edgeLabel.size = json.snapshot.edge.label.size;\n  snapshot.edgeLabel.visible = json.snapshot.edge.label.visible;\n  snapshot.networkThreshold = json.networkThreshold || json.query.threshold;\n  snapshot.coords = json.snapshot.nodePositions;\n  // TODO: when created date is lost\n  return {\n    id: json.id,\n    name: json.name,\n    dataType: json.dataType,\n    schemaVersion: '0.10',\n    revision: json.revision,\n    status: json.status,\n    fields: json.fields,\n    records: json.records,\n    query: {params: json.query},\n    progress: json.progress,\n    execTime: json.execTime,\n    created: json.created,\n    snapshot: snapshot,\n    reference: json.reference\n  };\n}\n\nfunction convertTable(json) {\n  let data = json;\n  if (!(data.hasOwnProperty('schemaVersion') || data.hasOwnProperty('$schema'))) { // v0.7\n    data = v07_to_v08_nodes(data);\n  }\n  if (data.schemaVersion == '0.8') {\n    data = v08_nodes(data);\n    data = v10_nodes(data);\n  }\n  if (!data.hasOwnProperty('$schema')) {\n    delete data.schemaVersion;\n    delete data.revision;\n    data.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  data.fields.forEach(e => {\n    if (e.key === 'structure') {\n      e.format = 'svg';\n    }\n    delete e.width;\n    delete e.height;\n  });\n  return data;\n}\n\nfunction convertNetwork(json) {\n  let data = json;\n  if (!(data.edges.hasOwnProperty('schemaVersion') || data.edges.hasOwnProperty('$schema'))) { // v0.7\n    data.nodes = v07_to_v08_nodes(data.nodes);\n    data.edges = v07_to_v08_edges(data.edges, data.nodes.fields);\n  }\n  if (data.edges.schemaVersion == '0.8' || data.edges.schemaVersion === 0.1) {  // wrong conversion of '0.10'\n    data = v08_graph(data);\n    data.nodes = v10_nodes(data.nodes);\n    data.edges = v10_edges(data.edges);\n  }\n  if (!data.edges.hasOwnProperty('$schema')) {\n    delete data.nodes.schemaVersion;\n    delete data.edges.schemaVersion;\n    delete data.nodes.revision;\n    delete data.edges.revision;\n    data.nodes.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n    data.edges.$schema = \"https://mojaie.github.io/flashflood/_static/specs/job_result_v1.0.json\";\n  }\n  return data;\n}\n\n\nfunction convertPackage(json) {\n  let specs = {};\n  if (!json.hasOwnProperty('views')) {\n    const now = new Date();\n    const isNW = json.hasOwnProperty('edges');\n    const data = isNW ? convertNetwork(json) : convertTable(json);\n    const nodes = isNW ? data.nodes : data;\n    specs = {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n      name: data.edges.name,\n      views: [],\n      dataset: []\n    };\n    specs.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: nodes.id,\n      name: nodes.name,\n      contents: [{\n        $schema: nodes.$schema,\n        workflowID: nodes.reference.workflow,\n        name: nodes.name,\n        fields: nodes.fields,\n        records: nodes.records,\n        created: nodes.created,\n        status: nodes.status,\n        query: nodes.query,\n        execTime: nodes.execTime,\n        progress: nodes.progress\n      }]\n    });\n    specs.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: nodes.id,\n      name: nodes.name,\n      viewType: \"datagrid\",\n      rows: nodes.id,\n      fields: nodes.fields,\n      sortOrder: null,\n      filterText: null,\n      checkpoints: [{\n        type: 'convert',\n        date: now.toString(),\n        description: 'converted from legacy format'\n      }]\n    });\n    if (isNW) {\n      specs.dataset.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: data.edges.id,\n        name: data.edges.name,\n        contents: [{\n          $schema: data.edges.$schema,\n          workflowID: data.edges.reference.workflow,\n          name: data.edges.name,\n          fields: data.edges.fields,\n          records: data.edges.records,\n          created: data.edges.created,\n          status: data.edges.status,\n          query: data.edges.query,\n          execTime: data.edges.execTime,\n          progress: data.edges.progress\n        }]\n      });\n      specs.views.push({\n        $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n        viewID: data.edges.id,\n        name: data.edges.name,\n        viewType: \"network\",\n        nodes: nodes.id,\n        edges: data.edges.id,\n        nodeColor: data.edges.snapshot.nodeColor,\n        nodeSize: data.edges.snapshot.nodeSize,\n        nodeLabel: data.edges.snapshot.nodeLabel,\n        nodeLabelColor: data.edges.snapshot.nodeLabelColor,\n        edgeWidth: data.edges.snapshot.edgeWidth,\n        edgeLabel: data.edges.snapshot.edgeLabel,\n        networkThreshold: data.edges.snapshot.networkThreshold,\n        networkThresholdCutoff: data.edges.snapshot.networkThresholdCutoff,\n        fieldTransform: data.edges.snapshot.fieldTransform,\n        coords: data.edges.snapshot.coords,\n        checkpoints: [{\n          type: 'convert',\n          date: now.toString(),\n          description: 'converted from legacy format'\n        }]\n      });\n    }\n    specs.views.filter(e => e.viewType === 'network')\n      .forEach(view => {\n        view.minConnThld = view.networkThresholdCutoff;\n        view.currentConnThld = view.networkThreshold;\n        if (view.hasOwnProperty('nodeLabel')) {\n          view.nodeLabel.field = view.nodeLabel.text;\n        }\n        if (view.hasOwnProperty('edgeLabel')) {\n          view.edgeLabel.field = 'weight';\n        }\n        if (view.hasOwnProperty('edgeWidth')) {\n          view.edgeWidth.field = 'weight';\n        }\n      });\n  } else {\n    specs = json;\n  }\n  specs.views.filter(e => e.viewType === 'network')\n    .forEach(view => {\n      if (!view.nodeColor.field) { view.nodeColor.field = 'index' ;}\n      if (!view.nodeSize.field) { view.nodeSize.field = 'index' ;}\n      if (!view.nodeLabel.field) { view.nodeLabel.field = 'index' ;}\n      if (!view.nodeLabelColor.field) { view.nodeLabelColor.field = 'index' ;}\n      if (!view.edgeColor) {\n        view.edgeColor = {\n          field: 'weight', color: 'monogray',\n          scale: 'linear', domain: [0, 1],\n          range: ['#999999', '#999999'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeColor.field) { view.edgeColor.field = 'weight' ;}\n      if (!view.edgeWidth.field) { view.edgeWidth.field = 'weight' ;}\n      if (!view.edgeLabel.field) { view.edgeLabel.field = 'weight' ;}\n      if (!view.edgeLabelColor) {\n        view.edgeLabelColor = {\n          field: 'weight', color: 'monoblack',\n          scale: 'linear', domain: [1, 1],\n          range: ['#333333', '#333333'], unknown: '#cccccc'\n        };\n      } else if (!view.edgeLabelColor.field) { view.edgeLabelColor.field = 'weight' ;}\n    });\n  return specs;\n}\n\n\nexport default {\n  convertPackage\n};\n","\n/** @module common/idb */\n\nimport _ from 'lodash';\n\nimport {default as misc} from './misc.js';\nimport {default as legacy} from './legacySchema.js';\n\n\n// Increment versions if IDB schema has updated.\nconst pkgStoreVersion = 2;\nconst assetStoreVersion = 1;\n\n\nfunction connect(name, version, createObj) {\n  return new Promise((resolve, reject) => {\n    const request = window.indexedDB.open(name, version);\n    request.onsuccess = function () {\n      resolve(this.result);\n    };\n    request.onerror = event => reject(event);\n    request.onupgradeneeded = event => {\n      createObj(event.currentTarget.result);\n    };\n  });\n}\n\n\nconst instance = {\n  pkgs: connect(\"Packages\", pkgStoreVersion, db => {\n    db.createObjectStore(\"Packages\", {keyPath: 'id'});\n  }),\n  assets: connect(\"Assets\", assetStoreVersion, db => {\n    db.createObjectStore(\"Assets\", {keyPath: 'key'});\n  })\n};\n\n\n/**\n * Clear database\n * @param {string} dbid - database ID\n */\nfunction clear(dbid) {\n  return new Promise((resolve, reject) => {\n    return instance[dbid].then(db => {\n      const req = db.transaction(db.name, 'readwrite')\n          .objectStore(db.name).clear();\n        req.onsuccess = () => resolve();\n        req.onerror = event => reject(event);\n    });\n  });\n}\n\n\n/**\n * Delete all data in the local storage\n */\nfunction clearAll() {\n  return Promise.all([clear('pkgs'), clear('assets')]);\n}\n\n\n/**\n * Returns all packages\n * @return {Promise} Promise of list of packages\n */\nfunction getAllItems() {\n  return new Promise(resolve => {\n    const res = [];\n    return instance.pkgs.then(db => {\n      db.transaction(db.name)\n        .objectStore(db.name).openCursor()\n        .onsuccess = event => {\n          const cursor = event.target.result;\n          if (cursor) {\n            res.push(cursor.value);\n            cursor.continue();\n          } else {\n            resolve(res);\n          }\n        };\n    });\n  });\n}\n\n\n/**\n * Get packages by instance ID\n * @param {string} id - Package instance ID\n * @return {array} data store object\n */\nfunction getItem(id) {\n  return new Promise((resolve, reject) => {\n    return instance.pkgs.then(db => {\n      const req = db.transaction(db.name)\n        .objectStore(db.name).get(id);\n      req.onsuccess = event => resolve(event.target.result);\n      req.onerror = event => reject(event);\n    });\n  });\n}\n\n\n/**\n * Put data object in the store\n * @param {string} value - value to store\n */\nfunction putItem(value) {\n  return new Promise((resolve, reject) => {\n    return instance.pkgs.then(db => {\n      const obj = db.transaction(db.name, 'readwrite')\n        .objectStore(db.name);\n      const req = obj.put(value);\n      req.onerror = event => reject(event);\n      req.onsuccess = () => resolve();\n    });\n  });\n}\n\n\n/**\n * Update package in the store\n * @param {string} id - Package instance ID\n * @param {function} updater - update function\n */\nfunction updateItem(id, updater) {\n  return new Promise((resolve, reject) => {\n    return instance.pkgs.then(db => {\n      const obj = db.transaction(db.name, 'readwrite')\n        .objectStore(db.name);\n      const req = obj.get(id);\n      req.onerror = event => reject(event);\n      req.onsuccess = event => {\n        const res = event.target.result;\n        updater(res);\n        const upd = obj.put(res);\n        upd.onsuccess = () => resolve();\n        upd.onerror = event => reject(event);\n      };\n    });\n  });\n}\n\n\n/**\n * Delete a package\n * @param {string} id - Package instance ID\n */\nfunction deleteItem(id) {\n  return new Promise((resolve, reject) => {\n    return instance.pkgs.then(db => {\n      const req = db.transaction(db.name, 'readwrite')\n        .objectStore(db.name).delete(id);\n      req.onerror = event => reject(event);\n      req.onsuccess = () => resolve();\n    });\n  });\n}\n\n\n/**\n * Returns a view\n * @param {string} id - Package instance ID\n * @param {string} viewID - view ID\n * @return {array} view objects\n */\nfunction getView(id, viewID) {\n  return getItem(id)\n    .then(pkg => pkg.views.find(e => e.viewID === viewID));\n}\n\n\n/**\n * Append a view next to a specific view\n * @param {string} id - Package instance ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object\n */\nfunction appendView(id, viewID, viewObj) {\n  return updateItem(id, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos + 1, 0, viewObj);\n  });\n}\n\n\n/**\n * Update view\n * @param {string} id - Package instance ID\n * @param {string} viewID - view ID\n * @param {object} viewObj - view object or update function\n */\nfunction updateView(id, viewID, viewObj) {\n  return updateItem(id, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    if (_.isFunction(viewObj)) {\n      viewObj(item.views[pos]);\n    } else {\n      item.views[pos] = viewObj;\n    }\n  });\n}\n\n\n/**\n * Delete a data object from the store\n * @param {string} id - Package instance ID\n * @return {integer} - number of deleted items\n */\nfunction deleteView(id, viewID) {\n  return updateItem(id, item => {\n    const pos = item.views.findIndex(e => e.viewID === viewID);\n    item.views.splice(pos, 1);\n    // prune orphaned collections\n    const bin = {};\n    item.dataset.forEach(e => { bin[e.collectionID] = 0; });\n    item.views.forEach(view => {\n      ['rows', 'items', 'nodes', 'edges']\n        .filter(e => view.hasOwnProperty(e))\n        .forEach(e => { bin[view[e]] += 1; });\n    });\n    Object.entries(bin).forEach(entry => {\n      if (!entry[1]) {\n        const i = item.dataset.findIndex(e => e.collectionID === entry[0]);\n        item.dataset.splice(i, 1);\n      }\n    });\n  });\n}\n\n\n/**\n * Returns all collections in the store\n * @return {array} Collection objects\n */\nfunction getAllCollections() {\n  return getAllItems()\n    .then(items => _.flatten(\n      items.map(item => {\n        return item.dataset.map(coll => {\n          coll.instance = item.id;\n          return coll;\n        });\n      })\n    ));\n}\n\n\n/**\n * Returns a collection\n * @param {string} id - Package instance ID\n * @param {string} collID - Collection ID\n * @return {array} Collection objects\n */\nfunction getCollection(id, collID) {\n  return getItem(id)\n    .then(pkg => pkg.dataset.find(e => e.collectionID === collID));\n}\n\n\nfunction addCollection(id, collID, collObj) {\n  return updateItem(id, item => {\n    item.dataset.push(collObj);\n  });\n}\n\n/**\n * Update collection\n * @param {string} id - Package instance ID\n * @param {string} collID - Collection ID\n * @param {object} collObj - Collection object or update function\n */\nfunction updateCollection(id, collID, collObj) {\n  return updateItem(id, item => {\n    const pos = item.dataset.findIndex(e => e.collectionID === collID);\n    if (_.isFunction(collObj)) {\n      collObj(item.dataset[pos]);\n    } else {\n      item.dataset[pos] = collObj;\n    }\n  });\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} data - data\n * @return {string} - id if sucessfully added\n */\nfunction importItem(data) {\n  // Legacy format converter\n  data = legacy.convertPackage(data);\n\n  const now = new Date();\n  data.id = misc.uuidv4().slice(0, 8);\n  data.sessionStarted = now.toString();\n  return putItem(data);\n}\n\n\n/**\n * Insert a data object to the store\n * @param {object} response - response data\n * @return {string} - viewID if sucessfully added\n */\nfunction newDatagrid(response) {\n  const now = new Date();\n  const date = now.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo'});\n  const instance = misc.uuidv4().slice(0, 8);\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  const data = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    id: instance,\n    name: response.name,\n    views: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n        viewID: viewID,\n        name: response.name,\n        viewType: \"datagrid\",\n        rows: collectionID,\n        checkpoints: [\n          {type: 'creation', date: date}\n        ]\n      }\n    ],\n    dataset: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: collectionID,\n        name: response.name,\n        contents: [response]\n      }\n    ],\n    sessionStarted: date\n  };\n  return putItem(data)\n    .then(() => ({instance: instance, viewID:viewID}));\n}\n\n\nfunction addDatagrid(instance, response) {\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  return updateItem(instance, item => {\n    item.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/datagrid_v1.0.json\",\n      viewID: viewID,\n      name: response.name,\n      viewType: \"datagrid\",\n      rows: collectionID,\n    });\n    item.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: collectionID,\n      name: response.name,\n      contents: [response]\n    });\n  }).then(() => viewID);\n}\n\n\nfunction new384Tiles(response) {\n  const now = new Date();\n  const date = now.toLocaleString('en-GB', { timeZone: 'Asia/Tokyo'});\n  const instance = misc.uuidv4().slice(0, 8);\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  const data = {\n    $schema: \"https://mojaie.github.io/kiwiii/specs/package_v1.0.json\",\n    id: instance,\n    name: response.name,\n    views: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/tile_v1.0.json\",\n        viewID: viewID,\n        name: `${response.name}_tiles`,\n        viewType: 'tile',\n        items: collectionID,\n        rowCount: 16,\n        columnCount: 24\n      }\n    ],\n    dataset: [\n      {\n        $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n        collectionID: collectionID,\n        name: response.name,\n        contents: [response]\n      }\n    ],\n    sessionStarted: date\n  };\n  return putItem(data)\n    .then(() => ({instance: instance, viewID:viewID}));\n}\n\n\nfunction add384Tiles(instance, response) {\n  const viewID = misc.uuidv4().slice(0, 8);\n  const collectionID = response.workflowID.slice(0, 8);\n  return updateItem(instance, item => {\n    item.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/tile_v1.0.json\",\n      viewID: viewID,\n      name: `${response.name}_tiles`,\n      viewType: 'tile',\n      items: collectionID,\n      rowCount: 16,\n      columnCount: 24,\n      chunksPerRow: 10\n    });\n    item.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: collectionID,\n      name: response.name,\n      contents: [response]\n    });\n  }).then(() => viewID);\n}\n\n\n/**\n * Store new network view\n * @param {string} instance - Package instance ID\n * @param {string} nodesID - ID of nodes collection\n * @param {string} nodesName - Name of nodes collection\n * @param {object} response - Response object\n */\nfunction newNetwork(instance, nodesID, nodesName, response) {\n  const viewID = misc.uuidv4().slice(0, 8);\n  const edgesID = response.workflowID.slice(0, 8);\n  return updateItem(instance, item => {\n    item.views.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n      viewID: viewID,\n      name: `${nodesName}_${response.name}`,\n      viewType: 'network',\n      nodes: nodesID,\n      edges: edgesID,\n      minConnThld: response.query.params.threshold\n    });\n    item.dataset.push({\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: edgesID,\n      name: response.name,\n      contents: [response]\n    });\n  }).then(() => viewID);\n}\n\n\n/**\n * Get asset by a key\n * @param {string} key - key\n * @return {array} asset object (if not found, resolve with undefined)\n */\nfunction getAsset(key) {\n  return new Promise((resolve, reject) => {\n    return instance.assets.then(db => {\n      const req = db.transaction(db.name)\n        .objectStore(db.name).get(key);\n      req.onsuccess = event => {\n        const undef = event.target.result === undefined;\n        const value = undef ? undefined : event.target.result.value;\n        resolve(value);\n      };\n      req.onerror = event => reject(event);\n    });\n  });\n}\n\n/**\n * Put asset object with a key\n * @param {string} key - key\n * @param {string} content - asset to store\n */\nfunction putAsset(key, content) {\n  return new Promise((resolve, reject) => {\n    return instance.assets.then(db => {\n      const obj = db.transaction(db.name, 'readwrite')\n        .objectStore(db.name);\n      const req = obj.put({key: key, value: content});\n      req.onerror = event => reject(event);\n      req.onsuccess = () => resolve();\n    });\n  });\n}\n\n\nexport default {\n  clear, clearAll, getAllItems, getItem, updateItem, deleteItem,\n  getView, appendView, updateView, deleteView,\n  getAllCollections, getCollection, addCollection, updateCollection,\n  importItem, newDatagrid, addDatagrid, add384Tiles, newNetwork,\n  getAsset, putAsset\n};\n","\n/** @module common/fetcher */\n\n\nconst baseURL = '../req/';\n\nfunction get(url, query={}) {\n  const isEmpty = Object.keys(query).length;\n  const q = isEmpty ? `?query=${JSON.stringify(query)}` : '';\n  return fetch(\n    `${baseURL}${url}${q}`,\n    {\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction json(response) {\n  return response.json();\n}\n\nfunction text(response) {\n  return response.text();\n}\n\nfunction blob(response) {\n  return response.blob();\n}\n\nfunction post(url, formdata) {\n  return fetch(\n    `${baseURL}${url}`,\n    {\n      method: 'POST',\n      body: formdata,\n      credentials: 'include'\n    }\n  ).then(res => {\n    if (res.status !== 200) {\n      return Promise.reject(new Error(res.statusText));\n    }\n    return Promise.resolve(res);\n  });\n}\n\nfunction error(err) {\n  console.error(err);\n  return null;\n}\n\nfunction serverStatus() {\n  const response = {};\n  return get('server')\n    .then(json)\n    .then(res => {\n      response.server = res;\n    })\n    .then(() => get('schema'))\n    .then(json)\n    .then(res => {\n      response.schema = res;\n    })\n    .then(() => response);\n}\n\n\nfunction batchRequest(reqs, interval) {\n  const ress = reqs.map((req, i) => {\n    return new Promise(resolve => {\n      setTimeout(() => resolve(req()), i * interval * 1000);\n    });\n  });\n  return Promise.all(ress);\n}\n\n\nfunction sequentialBatchRequest(reqs, interval) {\n  const ress = [];\n  const batch = reqs.reduce((a, b) => {\n    return a\n      .then(res => {\n        if (res) ress.push(res);\n        return new Promise(resolve => {\n          setTimeout(() => resolve(b()), interval * 1000);\n        });\n      });\n  }, Promise.resolve());\n  return batch.then(() => ress);\n}\n\n\n\nexport default {\n  get, json, text, blob, post, error, serverStatus, batchRequest\n};\n","\n/** @module common/mapper */\n\nimport _ from 'lodash';\n\n\n/**\n * Convert single field mapping to multi field mapping\n * @param {object} mapping - single field mapping\n * @return {object} multi field mapping\n */\nfunction singleToMulti(mapping) {\n  const newMapping = {};\n  Object.entries(mapping.mapping).forEach(m => {\n    newMapping[m[0]] = [m[1]];\n  });\n  return {\n    created: mapping.created,\n    fields: [mapping.field],\n    key: mapping.key,\n    mapping: newMapping\n  };\n}\n\n\n/**\n * Convert field mapping to table\n * @param {object} mapping - field mapping\n * @return {object} table object\n */\nfunction mappingToTable(mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  const keyField = {key: mp.key, format: 'text'};\n  const data = {\n    fields: [keyField].concat(mp.fields),\n    records: Object.entries(mp.mapping).map(entry => {\n      const rcd = {};\n      rcd[mp.key] = entry[0];\n      mp.fields.forEach((f, i) => {\n        rcd[f.key] = entry[1][i];\n      });\n      return rcd;\n    })\n  };\n  return data;\n}\n\n\n/**\n * Convert table to field mapping\n * @param {object} table - table\n * @param {object} key - key\n * @return {object} field mapping\n */\nfunction tableToMapping(table, key, ignore=['index']) {\n  const now = new Date();\n  const mapping = {\n    created: now.toString(),\n    fields: table.fields.filter(e => e.key !== key)\n      .filter(e => !ignore.includes(e.key)),\n    key: key,\n    mapping: {}\n  };\n  table.records.forEach(row => {\n    mapping.mapping[row[key]] = mapping.fields.map(e => row[e.key]);\n  });\n  return mapping;\n}\n\n\n/**\n * Convert csv text to field mapping\n * @param {string} csvString - csv data text\n * @return {object} field mapping\n */\nfunction csvToMapping(csvString) {\n  const lines = csvString.split(/\\n|\\r|\\r\\n/);\n  const header = lines.shift().split(',');\n  const key = header.shift();\n  const now = new Date();\n  const headerIdx = [];\n  const fields = [];\n  header.forEach((h, i) => {\n    if (h === '') return;\n    headerIdx.push(i);\n    fields.push({key: h, format: 'text'});\n  });\n  const mapping = {\n    created: now.toString(),\n    fields: fields,\n    key: key,\n    mapping: {}\n  };\n  lines.forEach(line => {\n    const values = line.split(',');\n    const k = values.shift();\n    mapping.mapping[k] = Array(headerIdx.length);\n    headerIdx.forEach(i => {\n      mapping.mapping[k][i] = values[i];\n    });\n  });\n  return mapping;\n}\n\n\n/**\n * Apply mapping to the data (in-place)\n * @param {object} data - datatable JSON\n * @param {object} mapping - mapping JSON\n * @return {undefined} undefined\n */\nfunction apply(data, mapping) {\n  const mp = mapping.hasOwnProperty('field') ? singleToMulti(mapping) : mapping;\n  data.records\n    .filter(rcd => mp.mapping.hasOwnProperty(rcd[mp.key]))\n    .forEach(rcd => {\n      mp.fields.forEach((fd, i) => {\n        rcd[fd.key] = mp.mapping[rcd[mp.key]][i];\n      });\n    });\n  data.fields =  _(data.fields)\n    .concat(mp.fields)\n    .uniqBy('key')\n    .value();\n}\n\nexport default {\n  singleToMulti, mappingToTable, tableToMapping, csvToMapping, apply\n};\n","\n/** @module common/collection */\n\nimport _ from 'lodash';\n\nimport {default as idb} from './idb.js';\nimport {default as fetcher} from './fetcher.js';\nimport {default as mapper} from './mapper.js';\n\n\nexport default class Collection {\n  /**\n   * Create Collection from a flashflood response datatable\n   * If data is not specified, put datatables later by this.append(data)\n   * @param {object} coll - Collection or response object\n   */\n  constructor(coll) {\n    // Settings\n    this.autoIndex = 'index';  // enumerate records\n\n    this.collectionID = coll.collectionID || null;\n    this.instance = coll.instance || null;\n    this.name = coll.name || null;\n    if (coll.records) {\n      this.contents = [coll];\n      this.fields = [];\n    } else {\n      this.contents = coll.contents;\n      this.fields = coll.fields || [];\n    }\n    this.contents.forEach(content => {\n      content.fields.forEach(e => this.addField(e));\n    });\n  }\n\n  /**\n   * Add fields\n   * @param {array} fs - list of fields\n   */\n  addField(field) {\n    if (this.fields.find(e => e.key === field.key)) return;\n    if (!field.hasOwnProperty('name')) field.name = field.key;\n    if (!field.hasOwnProperty('visible')) field.visible = true;\n    if (field.hasOwnProperty('d3_format')) field.format = 'd3_format';\n    if (!field.hasOwnProperty('format')) field.format = 'raw';\n    this.fields.push(field);\n  }\n\n  /**\n   * Update fields properties\n   * @param {array} fs - list of fields\n   */\n  updateFields(fs) {\n    this.fields = [];\n    fs.forEach(e => this.addField(e));\n  }\n\n  /**\n   * Join fields\n   * @param {object} mapping - column mapper object\n   */\n  joinFields(mapping) {\n    this.contents.forEach(c => {\n      mapper.apply(c, mapping);\n    });\n    if (mapping.hasOwnProperty('fields')) {\n      mapping.fields.forEach(e => this.addField(e));\n    } else {\n      this.addField(mapping.field);\n    }\n  }\n\n  /**\n   * Apply function to the original data records\n   * new fields should be manually added by Collection.addField\n   * @param {function} func - function to be applied\n   */\n  apply(func) {\n    this.contents.forEach(content => {\n      content.records.forEach(rcd => {\n        func(rcd);\n      });\n    });\n  }\n\n  /**\n   * Return all records of the collection\n   * @return {array} records\n   */\n  records() {\n    return _.flatten(this.contents.map(e => e.records));\n  }\n\n  fetch(command) {\n    const fs = this.contents\n      .filter(e => ['running', 'ready', 'interrupted', 'queued'].includes(e.status))\n      .map(content => {\n        const query = {id: content.workflowID, command: command};\n        return fetcher.get('progress', query)\n          .then(fetcher.json)\n          .then(data => {\n            return idb.updateCollection(this.instance, this.collectionID, coll => {\n              const i = coll.contents\n                .findIndex(e => e.workflowID === query.id);\n              if (data.status === 'failure') {  // No data found on server\n                coll.contents[i].status = 'failure';\n              } else {\n                coll.contents[i] = data;\n              }\n            });\n          });\n      });\n    return Promise.all(fs)\n      .then(() => idb.getCollection(this.instance, this.collectionID))\n      .then(coll => {\n        this.contents = coll.contents;\n      });\n  }\n\n  /**\n   * Retrieve workflows and store it into a local store.\n   * @return {Promise}\n   */\n  pull() {\n    return this.fetch('pull');\n  }\n\n  /**\n   * Retrieve workflows, abort all ongoing workflow task\n   * and store it into a local store.\n   * @return {Promise}\n   */\n  abort() {\n    return this.fetch('abort');\n  }\n\n  /**\n   * Return total number of records\n   * @return {float} total number of records\n   */\n  size() {\n    return _.sum(this.contents.map(e => e.records.length));\n  }\n\n  /**\n   * Return status\n   * @return {string} status\n   */\n  status() {\n    if (this.contents.some(e => e.status === 'interrupted')) return 'interrupted';\n    if (this.contents.some(e => e.status === 'running')) return 'running';\n    if (this.contents.some(e => e.status === 'queued')) return 'queued';\n    if (this.contents.some(e => e.status === 'ready')) return 'ready';\n    if (this.contents.some(e => e.status === 'aborted')) return 'aborted';\n    if (this.contents.some(e => e.status === 'failure')) return 'failure';\n    return 'done';\n  }\n\n  /**\n   * Return ongoing or not\n   * @return {bool} ongoing or not\n   */\n  ongoing() {\n    const s = ['ready', 'queued', 'running', 'interrupted'];\n    return s.includes(this.status());\n  }\n\n  /**\n   * Return percentage of workflow progress\n   * @return {float} progress in percent\n   */\n  progress() {\n    return _.min(this.contents.map(e => e.progress));\n  }\n\n  /**\n   * Return total execution time\n   * @return {float} total time\n   */\n  execTime() {\n    return _.sum(this.contents.map(e => e.execTime));\n  }\n\n  /**\n   * Export collection object as JSON\n   * @return {object} collection JSON\n   */\n  // TODO: new method that exports only visible fields\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/collection_v1.0.json\",\n      collectionID: this.collectionID,\n      name: this.name,\n      fields: this.fields,\n      contents: this.contents\n    };\n  }\n}\n","\n/** @module common/transform */\n\nimport d3 from 'd3';\n\n\nexport default class TransformState {\n  constructor(width, height, transform) {\n    this.fieldWidth = width;\n    this.fieldHeight = height;\n\n    this.viewBox = {\n      top: 0,\n      right: this.fieldWidth,\n      bottom: this.fieldHeight,\n      left: 0\n    };\n\n    this.focusArea = {};\n    this.focusAreaMargin = 50;\n\n    this.boundary = {\n      top: 0,\n      right: this.fieldWidth,\n      bottom: this.fieldHeight,\n      left: 0\n    };\n\n    this.transform = transform || {x: 0, y: 0, k: 1};\n    this.prevTransform = {\n      x: this.transform.x,\n      y: this.transform.y,\n      k: this.transform.k\n    };\n\n    this.resizeNotifier = () => {};\n  }\n\n  setFocusArea() {\n    const tx = this.transform.x;\n    const ty = this.transform.y;\n    const tk = this.transform.k;\n    const margin = this.focusAreaMargin;\n    this.focusArea.top = (this.viewBox.top - ty) / tk - margin;\n    this.focusArea.left = (this.viewBox.left - tx) / tk - margin;\n    this.focusArea.bottom = (this.viewBox.bottom - ty) / tk + margin;\n    this.focusArea.right = (this.viewBox.right - tx) / tk + margin;\n    // this.showFocusArea();  // debug\n  }\n\n  setViewBox(width, height) {\n    this.viewBox.right = width;\n    this.viewBox.bottom = height;\n    // this.showViewBox();  // debug\n    this.setFocusArea();\n  }\n\n  setTransform(tx, ty, tk) {\n    this.transform.x = tx;\n    this.transform.y = ty;\n    this.transform.k = tk;\n    // this.showTransform(); // debug\n    this.setFocusArea();\n  }\n\n  fitTransform() {\n    const vh = this.viewBox.bottom;\n    const vw = this.viewBox.right;\n    const vr = vw / vh;\n    const bh = this.boundary.bottom - this.boundary.top;\n    const bw = this.boundary.right - this.boundary.left;\n    const br = bw / bh;\n    const isPortrait = vr >= br;\n    const tk = isPortrait ? vh / bh : vw / bw;\n    const adjustH = isPortrait ? (vw - bw * tk) / 2 : 0;\n    const adjustV = isPortrait ? 0 : (vh - bh * tk) / 2;\n    const tx = -(this.boundary.left) * tk + adjustH;\n    const ty = -(this.boundary.top) * tk + adjustV;\n    this.setTransform(tx, ty, tk);\n  }\n\n  showTransform() {\n    d3.select('#debug-transform')\n      .text(JSON.stringify(this.transform));\n  }\n\n  showFocusArea() {\n    d3.select('#debug-focusarea')\n      .text(JSON.stringify(this.focusArea));\n  }\n\n  showViewBox() {\n    d3.select('#debug-viewbox')\n      .text(JSON.stringify(this.viewBox));\n  }\n}\n","\n/** @module common/scale */\n\nimport d3 from 'd3';\n\n\nconst colorScales = [\n  {key: 'monoblack', type: 'monocolor', colors: ['#333333'], unknown: '#333333'},\n  {key: 'monogray', type: 'monocolor', colors: ['#cccccc'], unknown: '#cccccc'},\n  {key: 'nodeDefault', type: 'monocolor', colors: ['#7fffd4'], unknown: '#7fffd4'},\n  {key: 'aquamarine', type: 'bicolor',\n   colors: ['#778899', '#7fffd4'], unknown: '#f0f0f0'},\n  {key: 'chartreuse', type: 'bicolor',\n   colors: ['#778899', '#7fff00'], unknown: '#f0f0f0'},\n  {key: 'salmon', type: 'bicolor',\n   colors: ['#778899', '#fa8072'], unknown: '#f0f0f0'},\n  {key: 'violet', type: 'bicolor',\n   colors: ['#778899', '#ee82ee'], unknown: '#f0f0f0'},\n  {key: 'temperature', type: 'tricolor',\n   colors: ['#87ceeb', '#fff5ee', '#fa8072'], unknown: '#f0f0f0'},\n  {key: 'spectrum', type: 'tricolor',\n   colors: ['#6495ed', '#ccff66', '#ffa500'], unknown: '#f0f0f0'},\n  {key: 'category10', type: 'categorical',\n   colors: ['#8dd3c7','#ffffb3','#bebada','#fb8072','#80b1d3','#fdb462',\n    '#b3de69','#fccde5','#bc80bd','#ccebc5'], unknown: '#f0f0f0'},\n  {key: 'cbsafe', type: 'categorical',\n   colors: ['#543005','#8c510a','#bf812d','#dfc27d','#f6e8c3','#c7eae5',\n   '#80cdc1','#35978f','#01665e','#003c30'], unknown: '#f0f0f0'},\n  {key: 'category20', type: 'categorical',\n   colors: d3.schemePaired.concat(d3.schemeSet2), unknown: '#f0f0f0'},\n  {key: 'category40', type: 'categorical',\n   colors: d3.schemePaired.concat(d3.schemePastel2, d3.schemeSet2, d3.schemeSet3),\n   unknown: '#f0f0f0'},\n  {key: 'custom', type: 'custom', colors: ['#ffffff'], text: 'custom'}\n];\n\n\nconst types = [\n  {key: 'linear', name: 'Linear', func: d3.scaleLinear},\n  {key: 'log', name: 'Log', func: d3.scaleLog},\n  {key: 'quantize', name: 'Quantize', func: d3.scaleQuantize},\n  {key: 'ordinal', name: 'Ordinal', func: d3.scaleOrdinal}\n];\n\n\nfunction scaleFunction(state) {\n  const cscale = colorScales.find(e => e.key === state.color);\n  let range;\n  let unknown;\n  if (cscale && cscale.key !== 'custom') {\n      range = cscale.colors;\n      unknown = cscale.unknown;\n  } else {\n    range = state.range;\n    unknown = state.unknown;\n  }\n  let domain = null;\n  if (range.length === 3) {\n    const mid = (parseFloat(state.domain[0]) + parseFloat(state.domain[1])) / 2;\n    domain = [state.domain[0], mid, state.domain[1]];\n  } else {\n    domain = state.domain;\n  }\n  // Build\n  let scaleFunc = types.find(e => e.key === state.scale).func();\n  scaleFunc = scaleFunc.domain(domain);\n  scaleFunc = scaleFunc.range(range);\n  if (['linear', 'log'].includes(state.scale)) {\n    scaleFunc = scaleFunc.clamp(true);\n  }\n\n  return d => {\n    // Sanitize\n    if (d === '' || typeof d === 'undefined' || d === null) {\n      return unknown;  // invalid values\n    }\n    if (['linear', 'log'].includes(state.scale) && parseFloat(d) != d) {\n      return unknown;  // texts\n    }\n    if (state.scale === 'log' && d <= 0) {\n      return unknown;  // negative values in log scale\n    }\n    // Apply function\n    const result = scaleFunc(d);\n    if (result === undefined) {\n      return unknown;  // TODO: specify unexpected behavior\n    }\n    return result;\n  };\n}\n\n\nfunction isD3Format(notation) {\n  try {\n    d3.format(notation);\n  } catch (err) {\n    return false;\n  }\n  return true;\n}\n\n\nexport default {\n  colorScales, types, scaleFunction, isD3Format\n};\n","\n/** @module component/badge */\n\nimport d3 from 'd3';\n\nconst assetBaseURL = '../assets/';\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction badge(selection) {\n  selection.classed('badge', true);\n  selection.append('img')\n      .classed('icon', true)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('text', true);\n}\n\n\nfunction updateBadge(selection, text, type, icon) {\n  selection.classed(`badge-${type}`, true);\n  selection.select('.icon')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null);\n  selection.select('.text')\n      .text(text);\n}\n\n\nfunction notify(selection) {\n  selection\n    .style('opacity', 0)\n    .style('display', 'inline')\n    .transition()\n      .duration(500)\n      .ease(d3.easeLinear)\n      .style(\"opacity\", 1.0)\n    .transition()\n      .delay(3000)\n      .duration(1000)\n      .ease(d3.easeLinear)\n      .style(\"opacity\", 0)\n      .on('end', function () {\n        selection.style('display', 'none');\n      });\n}\n\n\nfunction loadingCircle(selection) {\n  selection\n      .style('display', 'none')\n    .append('img')\n      .attr('src', `${assetBaseURL}loading1.gif`)\n      .style('width', '2rem')\n      .style('height', '2rem');\n}\n\n\nfunction alert(selection) {\n  selection.classed('alert', true)\n      .classed('px-1', true)\n      .classed('py-0', true);\n  selection.append('img')\n      .classed('icon', true)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('text', true)\n      .style('font-size', '75%');\n}\n\n\nfunction updateAlert(selection, text, type, icon) {\n  selection.classed(`alert-${type}`, true);\n  selection.select('.icon')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null);\n  selection.select('.text')\n      .text(text);\n}\n\n\nfunction invalidFeedback(selection) {\n  selection.classed('invalid-feedback', true)\n      .style('display', 'none');\n  selection.append('img')\n      .classed('icon', true)\n      .attr('src', `${iconBaseURL}caution-salmon.svg`)\n      .style('width', '1rem')\n      .style('height', '1rem');\n  selection.append('span')\n      .classed('invalid-msg', true);\n}\n\nfunction updateInvalidMessage(selection, msg) {\n  selection.select('.invalid-msg')\n      .text(msg);\n}\n\n\nexport default {\n  badge, updateBadge, notify, loadingCircle,\n  alert, updateAlert, invalidFeedback, updateInvalidMessage\n};\n","\n/** @module component/formBox */\n\nimport d3 from 'd3';\n\nimport {default as badge} from './badge.js';\n\n\nfunction updateFormValue(selection, value) {\n  selection.select('.form-control').property('value', value);\n  selection.call(setValidity, true);  // Clear validity state\n}\n\n\nfunction formValue(selection) {\n  return selection.select('.form-control').property('value');\n}\n\n\nfunction formValid(selection) {\n  return selection.select('.form-control').node().checkValidity();\n}\n\n\nfunction setValidity(selection, valid) {\n  selection.select('.invalid-feedback')\n      .style('display', valid ? 'none': 'inherit');\n  selection.select('.form-control')\n      .style('background-color', valid ? null : '#ffcccc');\n}\n\n\nfunction textBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .on('input', function () {\n        const valid = formValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\n\nfunction readonlyBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control-plaintext', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'text')\n      .attr('readonly', 'readonly');\n}\n\nfunction updateReadonlyValue(selection, value) {\n  selection.select('.form-control-plaintext').property('value', value);\n}\n\nfunction readonlyValue(selection) {\n  return selection.select('.form-control-plaintext').property('value');\n}\n\n\nfunction textareaBox(selection, label, rows, placeholder) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  const formLabel = selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  formLabel.append('div')\n      .call(badge.invalidFeedback);\n  selection.append('textarea')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('rows', rows)\n      .attr('placeholder', placeholder)\n      .on('input', function () {\n        const valid = textareaValid(selection);\n        selection.call(setValidity, valid);\n      });\n}\n\nfunction textareaBoxLines(selection) {\n  const value = selection.select('textarea').property('value');\n  if (value) return value.split('\\n')\n    .map(e => e.replace(/^\\s+|\\s+$/g, ''))  // strip spaces\n    .filter(e => e.length > 0);\n  return [];\n}\n\nfunction textareaValid(selection) {\n  return /\\s*?\\w\\s*?/.test(formValue(selection));\n}\n\n\nfunction checkBox(selection, label) {\n  const box = selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('form-check', true)\n    .append('label')\n      .classed('form-check-label', true)\n      .classed('col-form-label-sm', true);\n  box.append('input')\n      .classed('form-check-input', true)\n      .attr('type', 'checkbox');\n  box.append('span')\n      .text(label);\n}\n\nfunction updateCheckBox(selection, checked) {\n  selection.select('input').property('checked', checked);\n}\n\nfunction checkBoxValue(selection) {\n  return selection.select('input').property('checked');\n}\n\n\nfunction numberBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .attr('type', 'number')\n      .on('input', function () {\n        const valid = formValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\nfunction updateNumberRange(selection, min, max, step) {\n  selection.select('.form-control')\n      .attr('min', min)\n      .attr('max', max)\n      .attr('step', step)\n      .dispatch('input', {bubbles: true});\n}\n\n\n/**\n * Render color scale box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorBox(selection, label) {\n  selection\n      .classed('form-row', true)\n      .classed('align-items-center', true)\n      .on('change', () => {\n        // avoid update by mousemove on the colorpicker\n        d3.event.stopPropagation();\n      });\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n      .text(label);\n  selection.append('div')\n      .classed('form-group', true)\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .classed('mb-1', true)\n    .append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'color');\n}\n\n\nfunction fileInputBox(selection, label, accept) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('form-control-file', true)\n      .classed('col-8', true)\n      .attr('type', 'file')\n      .attr('accept', accept)\n      .on('change', function () {\n        const valid = fileInputValid(selection);\n        selection.call(setValidity, valid);\n      });\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\nfunction clearFileInput(selection) {\n  // TODO: FileList object (input.files) may be a readonly property\n  const label = selection.select('label').text();\n  const accept = selection.select('input').attr('accept');\n  selection.selectAll('*').remove();\n  selection.call(fileInputBox, label, accept);\n}\n\nfunction fileInputValue(selection) {\n  return selection.select('input').property('files')[0];\n}\n\nfunction fileInputValid(selection) {\n  // TODO: attribute 'require' does not work with input type=file\n  return selection.select('input').property('files').length > 0;\n}\n\n\nexport default {\n  updateFormValue, formValue, formValid, setValidity,\n  textBox, readonlyBox, updateReadonlyValue, readonlyValue,\n  textareaBox, textareaBoxLines, textareaValid,\n  numberBox, updateNumberRange,\n  checkBox, updateCheckBox, checkBoxValue,\n  colorBox,\n  fileInputBox, clearFileInput, fileInputValue, fileInputValid\n};\n","\n/** @module component/shape */\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction monocolorBar(selection, colors, text) {\n  const group = selection.append('g');\n  group.append('rect')\n      .attr('x', 0).attr('y', 0)\n      .attr('width', 100).attr('height', 10)\n      .attr('fill', colors[0]);\n  group.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('x', 50).attr('y', 10)\n      .attr('font-size', 12)\n      .text(text);\n}\n\nfunction bicolorBar(selection, colors, text) {\n  const id = misc.uuidv4().slice(0, 8);  // Aboid inline SVG ID dupulicate\n  selection.call(monocolorBar, colors, text);\n  const grad = selection.append('defs')\n    .append('linearGradient')\n      .attr('id', id);\n  grad.append('stop')\n      .attr('offset', 0).attr('stop-color', colors[0]);\n  grad.append('stop')\n      .attr('offset', 1).attr('stop-color', colors[1]);\n  selection.select('rect')\n      .attr('fill', `url(#${id})`);\n}\n\nfunction tricolorBar(selection, colors, text) {\n  const id = misc.uuidv4().slice(0, 8);  // Aboid inline SVG ID dupulicate\n  selection.call(monocolorBar, colors, text);\n  const grad = selection.append('defs')\n    .append('linearGradient')\n      .attr('id', id);\n  grad.append('stop')\n    .attr('offset', 0).attr('stop-color', colors[0]);\n  grad.append('stop')\n    .attr('offset', 0.5).attr('stop-color', colors[1]);\n  grad.append('stop')\n    .attr('offset', 1).attr('stop-color', colors[2]);\n  selection.select('rect')\n      .attr('fill', `url(#${id})`);\n}\n\nfunction categoricalBar(selection, colors, text) {\n  const sw = 100 / colors.length;\n  const group = selection.append('g');\n  colors.forEach((e, i) => {\n    group.append('rect')\n        .attr('x', sw * i).attr('y', 0)\n        .attr('width', sw).attr('height', 10)\n        .attr('fill', colors[i]);\n  });\n  group.append('text')\n      .attr('text-anchor', 'middle')\n      .attr('x', 50).attr('y', 10)\n      .attr('font-size', 12)\n      .text(text);\n}\n\nfunction setSize(selection, width, height) {\n  selection.attr('width', width).attr('height', height);\n}\n\n\nconst colorBar = {\n  'monocolor': monocolorBar,\n  'bicolor': bicolorBar,\n  'tricolor': tricolorBar,\n  'categorical': categoricalBar,\n  'custom': monocolorBar\n};\n\n\nexport default {\n  colorBar, setSize\n};\n","\n/** @module component/formListBox */\n\nimport d3 from 'd3';\n\nimport {default as badge} from './badge.js';\nimport {default as box} from './formBox.js';\nimport {default as shape} from './shape.js';\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction selectBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  selection.append('select')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true)\n      .on('input', function () {\n        const valid = box.formValid(selection);\n        selection.call(box.setValidity, valid);\n      });\n}\n\nfunction updateSelectBoxOptions(selection, items) {\n  const options = selection.select('select')\n    .selectAll('option')\n      .data(items, d => d.key);\n  options.exit().remove();\n  options.enter()\n    .append('option')\n      .attr('value', d => d.key)\n      .text(d => d.name);\n}\n\nfunction selectedRecord(selection) {\n  const value = box.formValue(selection);\n  return selection.selectAll('select option').data()\n      .find(e => e.key === value);\n}\n\n\n/**\n * Render select box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction checklistBox(selection, label) {\n  // TODO: scroll\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  const formLabel = selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label);\n  formLabel.append('div')\n      .call(badge.invalidFeedback);\n  selection.append('ul')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n}\n\nfunction updateChecklistItems(selection, items) {\n  const listitems = selection.select('ul')\n    .selectAll('li')\n      .data(items, d => d.key);\n  listitems.exit().remove();\n  const form = listitems.enter()\n    .append('li')\n      .attr('class', 'form-check')\n    .append('label')\n      .attr('class', 'form-check-label');\n  form.append('input')\n      .attr('type', 'checkbox')\n      .attr('class', 'form-check-input')\n      .property('value', d => d.key);\n  form.append('span')\n      .text(d => d.name);\n}\n\nfunction checkRequired(selection) {\n  selection.selectAll('input')\n      .on('change', function () {\n        const valid = anyChecked(selection);\n        selection.call(setChecklistValidity, valid);\n      });\n}\n\nfunction updateChecklistValues(selection, values) {\n  selection.selectAll('input')\n    .each(function (d) {\n      d3.select(this).property('checked', values.includes(d.key));\n    });\n  selection.call(setChecklistValidity, true);  // Clear validity state\n}\n\nfunction checklistValues(selection) {\n  return selection.selectAll('input:checked').data().map(d => d.key);\n}\n\nfunction anyChecked(selection) {\n  return checklistValues(selection).length > 0;\n}\n\nfunction setChecklistValidity(selection, valid) {\n  selection.select('.invalid-feedback')\n      .style('display', valid ? 'none': 'inherit');\n  selection.select('.form-control')\n      .style('background-color', valid ? null : 'LightPink');\n}\n\n\nfunction colorScaleBox(selection, label) {\n  selection\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('align-items-center', true);\n  selection.append('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('col-4', true)\n      .text(label || 'Colorscale');\n  const form = selection.append('div')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .classed('col-8', true);\n  const dropdown = form.append('div')\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  dropdown.append('button')\n      .classed('btn', true)\n      .classed(`btn-light`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  dropdown.append('div')\n      .classed('dropdown-menu', true)\n      .classed('py-0', true);\n  form.append('span')\n      .classed('selected', true);\n}\n\nfunction colorScaleBoxItems(selection, items) {\n  const listitems = selection.select('.dropdown-menu')\n    .selectAll('a')\n      .data(items, d => d);\n  listitems.exit().remove();\n  listitems.enter()\n    .append('a')\n      .classed('dropdown-item', true)\n      .classed('py-0', true)\n      .attr('href', '#')\n      .attr('title', d => d.key)\n      .on('click', function (d) {\n        selection.call(setSelectedColorScale, d);\n        selection.dispatch('change', {bubbles: true});\n      })\n    .append('svg')\n      .each(function (d) {\n        d3.select(this)\n          .attr('viewBox', '0 0 100 10')\n          .attr('preserveAspectRatio', 'none')\n          .call(shape.colorBar[d.type], d.colors, d.text)\n          .call(shape.setSize, 100, 10);\n      });\n}\n\nfunction setSelectedColorScale(selection, item) {\n  const selected = selection.select('.selected');\n  selected.selectAll('svg').remove();\n  selected.datum(item);  // Bind selected item record\n  selected.append('svg')\n      .attr('viewBox', '0 0 100 10')\n      .attr('preserveAspectRatio', 'none')\n      .call(shape.colorBar[item.type], item.colors, item.text)\n      .call(shape.setSize, 100, 10);\n}\n\nfunction updateColorScaleBox(selection, key) {\n  const data = selection.select('.dropdown-menu')\n    .selectAll('a').data();\n  const item = data.find(e => e.key === key);\n  selection.call(setSelectedColorScale, item);\n}\n\nfunction colorScaleBoxValue(selection) {\n  return selection.select('.selected').datum().key;\n}\n\nfunction colorScaleBoxItem(selection) {\n  return selection.select('.selected').datum();\n}\n\n\nexport default {\n  selectBox, updateSelectBoxOptions, selectedRecord,\n  checklistBox, updateChecklistItems, checkRequired, updateChecklistValues,\n  checklistValues, anyChecked, setChecklistValidity,\n  colorScaleBox, colorScaleBoxItems, updateColorScaleBox,\n  colorScaleBoxValue, colorScaleBoxItem\n};\n","\n/** @module component/formRangeBox */\n\nimport d3 from 'd3';\n\nimport {default as badge} from './badge.js';\n\n\n/**\n * Render range box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction rangeBox(selection, label) {\n  selection\n      .classed('form-row', true)\n      .classed('form-group', true)\n      .classed('align-items-center', true)\n    .append('div')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .text(label);\n\n  const minBox = selection.append('div');\n  minBox.append('label').text('min');\n  minBox.append('input').classed('min', true);\n\n  const maxBox = selection.append('div');\n  maxBox.append('label').text('max');\n  maxBox.append('input').classed('max', true);\n\n  selection.selectAll('div')\n      .classed('form-group', true)\n      .classed('col-4', true)\n      .classed('mb-0', true);\n\n  selection.selectAll('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('py-0', true);\n\n  selection.selectAll('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'number');\n\n  selection.append('div')\n      .classed('col-4', true);\n  selection.append('div')\n      .call(badge.invalidFeedback)\n      .classed('col-8', true);\n}\n\n\nfunction linearRange(selection, min, max, step) {\n  selection.selectAll('.min, .max')\n      .attr('min', min || null)\n      .attr('max', max || null)\n      .attr('step', step || null)\n      .attr('required', 'required')\n      .on('input', function () {\n        const valid = linearValid(this, step);\n        d3.select(this)\n          .style('background-color', valid ? null : '#ffcccc');\n        selection.select('.invalid-feedback')\n          .style('display', linearRangeValid(selection) ? 'none': 'inherit');\n      })\n      .dispatch('input');\n}\n\n\nfunction logRange(selection) {\n  selection.selectAll('.min, .max')\n      .attr('required', 'required')\n      .on('input', function () {\n        const valid = logValid(this);\n        d3.select(this)\n          .style('background-color', valid ? null : '#ffcccc');\n        selection.select('.invalid-feedback')\n          .style('display', logRangeValid(selection) ? 'none': 'inherit');\n      })\n      .dispatch('input');\n}\n\n\nfunction updateRangeValues(selection, range) {\n  selection.select('.min').property('value', range[0]);\n  selection.select('.max').property('value', range[1]);\n  selection.selectAll('.min,.max')\n      .dispatch('input', {bubbles: true});\n}\n\n\nfunction linearValid(node, step) {\n  // If step is not specified, accept stepMismatch\n  const stepm = step ? false : node.validity.stepMismatch;\n  return  node.checkValidity() || stepm;\n}\n\n\nfunction linearRangeValid(selection) {\n  const step = selection.select('.min').attr('step');\n  const minValid = linearValid(selection.select('.min').node(), step);\n  const maxValid = linearValid(selection.select('.max').node(), step);\n  return minValid && maxValid;\n}\n\n\nfunction logValid(node) {\n  // Accept stepMismatch\n  const stepm = node.validity.stepMismatch;\n  return (node.checkValidity() || stepm) && node.value > 0;\n}\n\n\nfunction logRangeValid(selection) {\n  const minPos = logValid(selection.select('.min').node());\n  const maxPos = logValid(selection.select('.max').node());\n  return linearRangeValid(selection) && minPos && maxPos;\n}\n\n\nfunction rangeValues(selection) {\n  return [\n    selection.select('.min').property('value'),\n    selection.select('.max').property('value')\n  ];\n}\n\n\n/**\n * Render color scale box components\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorRangeBox(selection, label) {\n  selection\n      .classed('form-row', true)\n      .classed('form-group', true)\n      .classed('align-items-center', true);\n  selection.append('div')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .text(label);\n\n  const minBox = selection.append('div');\n  minBox.append('label').text('min');\n  minBox.append('input').classed('min', true);\n\n  const midBox = selection.append('div');\n  midBox.append('label').text('mid');\n  midBox.append('input').classed('mid', true);\n\n  const maxBox = selection.append('div');\n  maxBox.append('label').text('max');\n  maxBox.append('input').classed('max', true);\n\n  selection.on('change', () => {\n    // avoid update by mousemove on the colorpicker\n    d3.event.stopPropagation();\n  });\n\n  selection.selectAll('div')\n      .classed('form-group', true)\n      .classed('col-3', true)\n      .classed('mb-0', true);\n\n  selection.selectAll('label')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('py-0', true);\n\n  selection.selectAll('input')\n      .classed('form-control', true)\n      .classed('form-control-sm', true)\n      .attr('type', 'color');\n}\n\n\nfunction updateColorRangeValues(selection, range) {\n  selection.select('.min').property('value', range[0]);\n  selection.select('.mid').property('value', range[1]);\n  selection.select('.max').property('value', range[2]);\n}\n\n\nfunction colorRangeValues(selection) {\n  return [\n    selection.select('.min').property('value'),\n    selection.select('.mid').property('value'),\n    selection.select('.max').property('value')\n  ];\n}\n\n\nexport default {\n  rangeBox, linearRange, logRange, updateRangeValues,\n  rangeValues, linearRangeValid, logRangeValid,\n  colorRangeBox, updateColorRangeValues, colorRangeValues\n};\n","\n/** @module component/dropdown */\n\n\nimport {default as misc} from '../common/misc.js';\n\n\nfunction dropdownFormGroup(selection, label) {\n  const id = misc.uuidv4().slice(0, 8);\n  selection.classed('mb-3', true)\n    .append('div')\n      .classed('form-group', true)\n      .classed('form-row', true)\n      .classed('justify-content-end', true)\n    .append('button')\n      .classed('btn', true)\n      .classed('btn-sm', true)\n      .classed('btn-outline-primary', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'collapse')\n      .attr('data-target', `#${id}-collapse`)\n      .attr('aria-expanded', 'false')\n      .attr('aria-controls', `${id}-collapse`)\n      .text(label);\n  selection.append('div')\n      .classed('collapse', true)\n      .attr('id', `${id}-collapse`)\n    .append('div')\n      .classed('card', true)\n      .classed('card-body', true);\n}\n\n\nexport default {\n  dropdownFormGroup\n};\n","\n/** @module component/formBoxGroup */\n\nimport d3 from 'd3';\n\nimport {default as badge} from './badge.js';\nimport {default as dropdown} from './dropdown.js';\nimport {default as box} from './formBox.js';\nimport {default as lbox} from './formListBox.js';\nimport {default as rbox} from './formRangeBox.js';\n\n\n/**\n * Render color range control box group\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction colorRangeGroup(selection, colorScales) {\n  selection\n      .classed('mb-3', true);\n  selection.append('div')\n      .classed('colorscale', true)\n      .classed('mb-2', true)\n      .call(lbox.colorScaleBox, 'Colorscale')\n      .call(lbox.colorScaleBoxItems, colorScales);\n\n  // Custom colorscale\n  const collapse = selection.append('div')\n      .call(dropdown.dropdownFormGroup, 'Custom color')\n    .select('.card-body')\n      .classed('p-2', true);\n\n  const customColorRanges = [\n    {key: 'continuous', name: 'Continuous'},\n    {key: 'two-piece', name: 'Two-piece'}\n  ];\n  collapse.append('div')\n      .classed('rangetype', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Range type')\n      .call(lbox.updateSelectBoxOptions, customColorRanges);\n  collapse.append('div')\n      .classed('range', true)\n      .classed('mb-1', true)\n      .call(rbox.colorRangeBox, 'Range');\n  collapse.append('div')\n      .classed('unknown', true)\n      .classed('mb-1', true)\n      .call(box.colorBox, 'Unknown');\n}\n\n\nfunction updateColorRangeGroup(selection, cscale, range, unknown) {\n  const customRange = () => {\n    const cs = lbox.colorScaleBoxValue(selection.select('.colorscale'));\n    const rg = box.formValue(selection.select('.rangetype'));\n    const customScale = cs === 'custom';\n    selection.selectAll('.rangetype, .range, .unknown')\n        .selectAll('select, input')\n        .property('disabled', !customScale);\n    selection.select('.range').select('.mid')\n        .property('disabled', !customScale || rg === 'continuous');\n  };\n  selection.select('.colorscale')\n      .call(lbox.updateColorScaleBox, cscale)\n      .on('change', function () {\n        customRange();\n      });\n  const rtype = range.length === 2 ? 'continuous' : 'two-piece';\n  selection.select('.rangetype')\n      .call(box.updateFormValue, rtype)\n      .on('change', function () {\n        customRange();\n      })\n      .dispatch('change');\n  const rboxValues = range.length === 2  ? [range[0], null, range[1]] : range;\n  selection.select('.range')\n      .call(rbox.updateColorRangeValues, rboxValues)\n      .on('focusin', () => {\n        selection.dispatch('change', {bubbles: true});\n      });\n  selection.select('.unknown')\n      .call(box.updateFormValue, unknown)\n      .on('focusin', () => {\n        selection.dispatch('change', {bubbles: true});\n      });\n}\n\n\nfunction colorGroupValues(selection) {\n  const colorScale = lbox.colorScaleBoxItem(selection.select('.colorscale'));\n  const rtype = box.formValue(selection.select('.rangetype'));\n  const range = rbox.colorRangeValues(selection.select('.range'));\n  const unknown = box.formValue(selection.select('.unknown'));\n  return {\n    color: colorScale.key,\n    colorScaleType: colorScale.type,\n    range: rtype === 'continuous' ? [range[0], range[2]] : range,\n    unknown: unknown\n  };\n}\n\n\n/**\n * Render scale and domain control box group\n * @param {d3.selection} selection - selection of box container (div element)\n */\nfunction scaleBoxGroup(selection) {\n  selection.classed('mb-3', true);\n\n  // Scale type\n  const scaleOptions = [\n    {key: 'linear', name: 'Linear'},\n    {key: 'log', name: 'Log'}\n  ];\n  selection.append('div')\n      .classed('scale', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Scale')\n      .call(lbox.updateSelectBoxOptions, scaleOptions)\n      .on('change', function () {\n        const isLog = box.formValue(d3.select(this)) === 'log';\n        selection.select('.domain')\n          .call(isLog ? rbox.logRange : rbox.linearRange)\n          .call(badge.updateInvalidMessage,\n                isLog ? 'Please provide a valid range (larger than 0)'\n                : 'Please provide a valid number');\n      });\n  selection.append('div')\n      .classed('domain', true)\n      .classed('mb-1', true)\n      .call(rbox.rangeBox, 'Domain');\n}\n\n\nfunction updateScaleBoxGroup(selection, scale, domain) {\n  selection.select('.scale')\n      .call(box.updateFormValue, scale)\n      .dispatch('change');\n  selection.select('.domain')\n      .call(rbox.updateRangeValues, domain);\n}\n\n\nfunction scaleBoxGroupValid(selection) {\n  const isLog = box.formValue(selection.select('.scale')) === 'log';\n  const dm = selection.select('.domain');\n  return isLog ? rbox.logRangeValid(dm) : rbox.linearRangeValid(dm);\n}\n\n\nfunction scaleGroupValues(selection) {\n  const scale = box.formValue(selection.select('.scale'));\n  const domain = rbox.rangeValues(selection.select('.domain'));\n  return {\n    scale: scale || 'linear',\n    domain: domain\n  };\n}\n\n\nexport default {\n  colorRangeGroup, updateColorRangeGroup, colorGroupValues,\n  scaleBoxGroup, updateScaleBoxGroup, scaleGroupValues, scaleBoxGroupValid\n};\n","\n/** @module component/controlBox */\n\nimport d3 from 'd3';\n\nimport {default as badge} from '../component/badge.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as rbox} from '../component/formRangeBox.js';\nimport {default as group} from '../component/formBoxGroup.js';\n\n\nfunction colorControlBox(selection, colorScales, fieldName) {\n  // Color field\n  selection.append('div')\n      .classed('field', true)\n      .call(lbox.selectBox, fieldName || 'Field');\n\n  // Colorscale and custom range\n  selection.append('div')\n      .classed('range', true)\n      .call(group.colorRangeGroup, colorScales)\n      .on('change', function () {\n        const values = group.colorGroupValues(d3.select(this));\n        const noScale = ['categorical', 'monocolor']\n          .includes(values.colorScaleType);\n        selection.select('.scale').selectAll('select,input')\n            .property('disabled', noScale);\n      });\n\n  // Scale\n  selection.append('div')\n      .classed('scale', true)\n      .call(group.scaleBoxGroup);\n\n  // Legend\n  selection.append('div')\n      .classed('legend', true)\n      .call(box.checkBox, 'Show legend');\n}\n\n\nfunction updateColorControl(selection, fieldOptions, colorState) {\n  selection.select('.field')\n      .call(lbox.updateSelectBoxOptions, fieldOptions)\n      .call(box.updateFormValue, colorState.field);\n  selection.select('.range')\n      .call(group.updateColorRangeGroup, colorState.color,\n            colorState.range, colorState.unknown);\n  selection.select('.scale')\n      .call(group.updateScaleBoxGroup, colorState.scale, colorState.domain)\n      .dispatch('change');\n  selection.select('.legend')\n      .call(box.updateCheckBox, colorState.legend);\n}\n\n\nfunction colorControlValid(selection) {\n  return group.scaleBoxGroupValid(selection.select('.scale'));\n}\n\n\nfunction colorControlState(selection) {\n  const range = group.colorGroupValues(selection.select('.range'));\n  const scale = group.scaleGroupValues(selection.select('.scale'));\n  return {\n    field: box.formValue(selection.select('.field')),\n    color: range.color,\n    range: range.range,\n    unknown: range.unknown,\n    scale: range.colorScaleType === 'categorical' ? 'ordinal': scale.scale,\n    domain: scale.domain,\n    legend: box.checkBoxValue(selection.select('.legend'))\n  };\n}\n\n\nfunction sizeControlBox(selection, fieldName) {\n  // Size field\n  selection.append('div')\n      .classed('field', true)\n      .call(lbox.selectBox, fieldName || 'Field');\n\n  // Size range\n  selection.append('div')\n      .classed('range', true)\n      .classed('mb-2', true)\n      .call(rbox.rangeBox, 'Range')\n      .call(rbox.linearRange, 0.1, 999, 0.1)\n      .call(badge.updateInvalidMessage,\n            'Please provide a valid range (0.1-999)');\n\n  // Size unknown\n  selection.append('div')\n      .classed('unknown', true)\n      .call(box.numberBox, 'Unknown')\n      .call(box.updateNumberRange, 0.1, 999, 0.1)\n      .call(badge.updateInvalidMessage,\n            'Please provide a valid number (0.1-999)')\n    .select('input')\n      .classed('col-8', false)\n      .classed('col-3', true);\n\n  // Size scale\n  selection.append('div')\n      .classed('scale', true)\n      .call(group.scaleBoxGroup);\n}\n\n\nfunction updateSizeControl(selection, fieldOptions, sizeState) {\n  selection.select('.field')\n      .call(lbox.updateSelectBoxOptions, fieldOptions)\n      .call(box.updateFormValue, sizeState.field);\n  selection.select('.range')\n      .call(rbox.updateRangeValues, sizeState.range);\n  selection.select('.unknown')\n      .call(box.updateFormValue, sizeState.unknown);\n  selection.select('.scale')\n      .call(group.updateScaleBoxGroup, sizeState.scale, sizeState.domain);\n}\n\n\nfunction sizeControlValid(selection) {\n  const rangeValid = rbox.linearRangeValid(selection.select('.range'));\n  const unkValid = box.formValid(selection.select('.unknown'));\n  const scaleValid = group.scaleBoxGroupValid(selection.select('.scale'));\n  return rangeValid && unkValid && scaleValid;\n}\n\n\nfunction sizeControlState(selection) {\n  const scale = group.scaleGroupValues(selection.select('.scale'));\n  return {\n    field: box.formValue(selection.select('.field')),\n    range: rbox.rangeValues(selection.select('.range')),\n    unknown: box.formValue(selection.select('.unknown')),\n    scale: scale.scale,\n    domain: scale.domain\n  };\n}\n\n\nfunction labelControlBox(selection, colorScales) {\n  // nodeLabel.visible\n  selection.append('div')\n    .append('div')\n      .classed('visible', true)\n      .call(box.checkBox, 'Show labels');\n\n  // nodeLabel\n  const labelGroup = selection.append('div')\n      .classed('mb-3', true);\n  labelGroup.append('div')\n      .classed('text', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Text field');\n  labelGroup.append('div')\n      .classed('size', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, 'Font size')\n      .call(box.updateNumberRange, 0.1, 999, 0.1)\n      .call(badge.updateInvalidMessage,\n            'Please provide a valid number (0.1-999)')\n    .select('.form-control')\n      .attr('required', 'required');\n\n  // nodeLabelColor\n  selection.call(colorControlBox, colorScales, 'Color field');\n  // TODO: not implemented yet\n  selection.select('.legend input').property('disabled', true);\n}\n\n\nfunction updateLabelControl(selection, fieldOptions,\n                               labelState, colorState) {\n  selection.select('.visible')\n      .call(box.updateCheckBox, labelState.visible);\n  selection.select('.text')\n      .call(lbox.updateSelectBoxOptions, fieldOptions)\n      .call(box.updateFormValue, labelState.field);\n  selection.select('.size')\n      .call(box.updateFormValue, labelState.size);\n  selection.call(updateColorControl, fieldOptions, colorState);\n}\n\n\nfunction labelControlValid(selection) {\n  const fontValid = box.formValid(selection.select('.size'));\n  return fontValid && colorControlValid(selection);\n}\n\n\nfunction labelControlState(selection) {\n  return {\n    label: {\n      field: box.formValue(selection.select('.text')),\n      size: box.formValue(selection.select('.size')),\n      visible: box.checkBoxValue(selection.select('.visible'))\n    },\n    labelColor: colorControlState(selection)\n  };\n}\n\n\nfunction controlBoxFrame(selection, navID, contentID) {\n  selection.append('nav')\n    .append('div')\n      .classed('nav', true)\n      .classed('nav-tabs', true)\n      .attr('id', navID)\n      .attr('role', 'tablist');\n  selection.append('div')\n      .classed('tab-content', true)\n      .classed('p-2', true)\n      .attr('id', contentID);\n}\n\n\nfunction controlBoxNav(selection, id, label) {\n  selection\n      .classed('nav-item', true)\n      .classed('nav-link', true)\n      .classed('py-1', true)\n      .attr('id', `${id}-tab`)\n      .attr('data-toggle', 'tab')\n      .attr('href', `#${id}`)\n      .attr('role', 'tab')\n      .attr('aria-controls', id)\n      .attr('aria-selected', 'false')\n      .text(label);\n}\n\n\nfunction controlBoxItem(selection, id) {\n  selection\n      .classed('tab-pane', true)\n      .classed('fade', true)\n      .classed('container', true)\n      .classed('px-0', true)\n      .attr('id', id)\n      .attr('role', 'tabpanel')\n      .attr('aria-labelledby', `${id}-tab`);\n}\n\n\nexport default {\n  colorControlBox, updateColorControl, colorControlValid, colorControlState,\n  sizeControlBox, updateSizeControl, sizeControlValid, sizeControlState,\n  labelControlBox, updateLabelControl, labelControlValid, labelControlState,\n  controlBoxFrame, controlBoxNav, controlBoxItem\n};\n","\n/** @module component/button */\n\nimport d3 from 'd3';\n\nconst iconBaseURL = '../assets/icon/';\n\n\nfunction buttonBox(selection, label, type) {\n  selection\n      .classed('form-group', true)\n      .classed('mb-1', true)\n    .append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .text(label);\n}\n\n\nfunction menuButton(selection, label, type) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .text(label);\n}\n\n\nfunction menuButtonLink(selection, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('role', 'button')\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction menuModalLink(selection, target, label, type, icon) {\n  selection\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed(`btn-sm`, true)\n      .classed('mr-1', true)\n      .attr('href', '#')\n      .attr('role', 'button')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  selection.append('span')\n      .classed('label', true)\n      .style('vertical-align', 'middle')\n      .text(label);\n}\n\n\nfunction dropdownMenuButton(selection, label, type, icon) {\n  selection\n      .classed('btn-group', true)\n      .classed('mr-1', true);\n  const button = selection.append('button')\n      .classed('btn', true)\n      .classed(`btn-${type}`, true)\n      .classed('btn-sm', true)\n      .classed('dropdown-toggle', true)\n      .attr('data-toggle', 'dropdown');\n  button.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .style('width', '1.25rem')\n      .style('height', '1.25rem');\n  button.append('span')\n      .style('vertical-align', 'middle')\n      .text(label);\n  selection.append('div')\n      .classed('dropdown-menu', true);\n}\n\n\nfunction dropdownMenuItem(selection, label, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#');\n  selection.append('img')\n      .attr('src', icon ? `${iconBaseURL}${icon}.svg` : null)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\nfunction dropdownMenuModal(selection, label, target, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .attr('data-toggle', 'modal')\n      .attr('data-target', `#${target}`);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFile(selection, label, accept, icon) {\n  selection.classed('dropdown-item', true)\n      .attr('href', '#')\n      .on('click', function () {\n        d3.select(this).select('input').node().click();\n      });\n  selection.append('form')\n      .style('display', 'none')\n    .append('input')\n      .attr('type', 'file')\n      .attr('accept', accept);\n  selection.append('img')\n      .attr('src', `${iconBaseURL}${icon}.svg`)\n      .classed('mr-1', true)\n      .style('width', '2rem')\n      .style('height', '2rem');\n  selection.append('span')\n      .text(label);\n}\n\n\nfunction dropdownMenuFileValue(selection) {\n  return selection.select('input').node().files[0];\n}\n\n\nexport default {\n  iconBaseURL, buttonBox, menuButton, menuButtonLink, menuModalLink,\n  dropdownMenuButton, dropdownMenuItem, dropdownMenuModal,\n  dropdownMenuFile, dropdownMenuFileValue\n};\n","\n/** @module component/legend */\n\nimport {default as scale} from '../common/scale.js';\n\nimport {default as shape} from './shape.js';\n\n\nfunction colorBarLegend(selection) {\n  selection.append('rect')\n      .classed('bg', true)\n      .attr('x', 0).attr('y', 0)\n      .attr('width', 120).attr('height', 50)\n      .attr('fill', 'white')\n      .attr('opacity', 0.9);\n  selection.append('text')\n      .classed('title', true)\n      .attr('text-anchor', 'middle')\n      .attr('x', 60).attr('y', 15)\n      .style('font-size', 12);\n  selection.append('g')\n      .classed('colorbar', true)\n      .attr('transform', 'translate(10, 20)');\n  const domains = selection.append('g')\n      .classed('label', true)\n      .attr('transform', 'translate(10, 40)')\n      .style('font-size', 12);\n  domains.append('text')\n      .classed('min', true)\n      .attr('text-anchor', 'start')\n      .attr('x', 0).attr('y', 0);\n  domains.append('text')\n      .classed('max', true)\n      .attr('text-anchor', 'end')\n      .attr('x', 100).attr('y', 0);\n}\n\n\nfunction updateColorBarLegend(selection, colorState) {\n  const field = scale.colorScales.find(e => e.key === colorState.color);\n  const colorBar = shape.colorBar[field.type];\n  const range = field.key === 'custom' ? colorState.range : field.colors;\n  selection.select('.title').text(colorState.field);\n  selection.select('.colorbar').selectAll('g,defs').remove();\n  selection.select('.colorbar').call(colorBar, range);\n  selection.select('.min')\n    .attr('visibility',\n          ['bicolor', 'tricolor'].includes(field.type) ? 'inherit' : 'hidden')\n    .text(colorState.domain[0]);\n  selection.select('.max')\n    .attr('visibility',\n          ['bicolor', 'tricolor'].includes(field.type) ? 'inherit' : 'hidden')\n    .text(colorState.domain[1]);\n}\n\n\n/**\n * Legend group component\n * @param {d3.selection} selection - selection of group container (svg:g)\n */\nfunction updateLegendGroup(selection, viewBox, orient) {\n  const widthFactor = 0.2;\n  const scaleF = viewBox.right * widthFactor / 120;\n  const o = orient.split('-');\n  const viewW = viewBox.right;\n  const viewH = viewBox.bottom;\n  const legW = viewW * widthFactor;\n  const legH = legW * 50 / 120;\n  const posX = {left: legW / 10, right: viewW - legW - (legW / 10)}[o[1]];\n  const posY = {top: legH / 10, bottom: viewH - legH - (legH / 10)}[o[0]];\n  selection.attr('transform',\n                 `translate(${posX}, ${posY}) scale(${scaleF})`);\n}\n\n\nexport default {\n  colorBarLegend, updateColorBarLegend, updateLegendGroup\n};\n","\n/** @module component/transform */\n\nimport {default as legend} from '../component/legend.js';\n\n\nfunction transform(selection, tx, ty, tk) {\n  selection.select('.field')\n    .attr('transform', `translate(${tx}, ${ty}) scale(${tk})`);\n}\n\n\nfunction resize(selection, state) {\n  const area = selection.node();\n  const width = area.offsetWidth;\n  const height = area.offsetHeight;\n  selection.select('.view')\n      .attr('viewBox', `0 0 ${width} ${height}`)\n    .select('.boundary')\n      .attr('width', width)\n      .attr('height', height);\n  state.setViewBox(width, height);\n  state.resizeNotifier();\n}\n\n\nfunction viewFrame(selection, state) {\n  selection\n    .style('width', '100%')\n    .style('height', '100%');\n  selection.select('.view').remove(); // Clean up\n  selection.append('svg')\n    .classed('view', true);\n  selection.call(resize, state);\n}\n\n\nfunction view(selection, state) {\n  selection\n    .attr('preserveAspectRatio', 'xMinYMin meet')\n    .attr('pointer-events', 'all')\n    .attr('viewBox', `0 0 ${state.viewBox.right} ${state.viewBox.bottom}`)\n    .style('width', '100%')\n    .style('height', '100%');\n\n  // Clean up\n  selection.selectAll('g, rect').remove();\n\n  // Boundary\n  selection.append('rect')\n      .classed('boundary', true)\n      .attr('x', 0)\n      .attr('y', 0)\n      .attr('width', state.viewBox.right)\n      .attr('height', state.viewBox.bottom)\n      .attr('fill', '#ffffff')\n      .attr('stroke-width', 1)\n      .attr('stroke', '#cccccc');\n  // Field\n  selection.append('g')\n      .classed('field', true)\n      .style('opacity', 1e-6)\n    .transition()\n      .duration(1000)\n      .style('opacity', 1);\n}\n\n\nexport default {\n  transform, resize, viewFrame, view\n};\n","\n/** @module network/similarity */\n\nimport _ from 'lodash';\n\n\nfunction explorativeNetwork(nodes, edges) {\n  let baseFactor = 0;\n  let adjField = 'adjacency';\n  let sourceField = 'source';\n  let targetField = 'target';\n  let weightField = 'weight';\n\n  function expnet() {\n    const elevations = {};\n    nodes.forEach((n, i) => {\n      if (!n.adjacency.length) return 0;\n      elevations[i] = _.max(n.adjacency.map(e => edges[e[1]].weight));\n    });\n    const pathWeights = {};\n    edges.forEach((e, i) => {\n      const mn = _.min([elevations[e.source], elevations[e.target]]);\n      pathWeights[i] = (e.weight - baseFactor) / (mn - baseFactor);\n    });\n    return {\n      elevations: elevations, pathWeights: pathWeights\n    };\n  }\n\n  expnet.baseFactor = function (bf) {\n    baseFactor = bf;\n    return expnet;\n  };\n\n  return expnet;\n}\n\n\nexport default {\n  explorativeNetwork\n};\n","\n/** @module network/component */\n\nimport d3 from 'd3';\n\nimport {default as scale} from '../common/scale.js';\nimport {default as misc} from '../common/misc.js';\n\nimport {default as legend} from '../component/legend.js';\nimport {default as transform} from '../component/transform.js';\n\nimport {default as expnet} from './explorativeNetwork.js';\n\nconst svgWidth = 180;  //TODO\nconst svgHeight = 180;  //TODO\n\n\nfunction updateNodes(selection, records, showStruct) {\n  const nodes = selection.selectAll('.node')\n    .data(records, d => d.index);\n  nodes.exit().remove();\n  const entered = nodes.enter()\n    .append('g')\n      .attr('class', 'node')\n      .call(updateNodeCoords);\n  entered.append('circle')\n      .attr('class', 'node-symbol');\n  entered.append('g')\n      .attr('class', 'node-content')\n      .attr('transform', `translate(${-svgWidth / 2},${-svgHeight / 2})`);\n  entered.append('text')\n      .attr('class', 'node-label')\n      .attr('x', 0)\n      .attr('text-anchor', 'middle');\n  entered.append('foreignObject')\n      .attr('class', 'node-html')\n    .append('xhtml:div');\n  const merged = entered.merge(nodes);\n  if (showStruct) {\n    merged.select('.node-content').html(d => d.structure);\n  } else {\n    merged.select('.node-content').select('svg').remove();\n  }\n}\n\n\nfunction updateEdges(selection, records) {\n  const edges = selection.selectAll('.link')\n    .data(records, d => `${d.source.index}_${d.target.index}`);\n  edges.exit().remove();\n  const entered = edges.enter()\n    .append('g')\n      .attr('class', 'link');\n  entered.append('line')\n      .attr('class', 'edge-line')\n      .style('stroke-opacity', 0.6);\n  entered.append('text')\n      .attr('class', 'edge-label')\n      .attr('text-anchor', 'middle');\n  // draw all components and then\n  entered.call(updateEdgeCoords);\n}\n\n\nfunction updateNodeAttrs(selection, state) {\n  const colorConv = scale.scaleFunction(state.nodeColor);\n  const sizeConv = scale.scaleFunction(state.nodeSize);\n  const labelColorConv = scale.scaleFunction(state.nodeLabelColor);\n  const field = state.nodes.fields\n    .find(e => e.key === state.nodeLabel.field);\n  const textConv = value => {\n    return field.format === 'd3_format'\n      ? misc.formatNum(value, field.d3_format) : value;\n  };\n  selection.selectAll('.node').select('.node-symbol')\n      .attr('r', d => sizeConv(d[state.nodeSize.field]))\n      .style('fill', d => colorConv(d[state.nodeColor.field]));\n  // TODO: tidy up (like rowFactory?)\n  if (field.format === 'html') {\n    const htwidth = 200;\n    const fo = selection.selectAll('.node').select('.node-html');\n    fo.attr('x', -htwidth / 2)\n      .attr('y', d => state.focusedView ? svgWidth / 2 - 10\n        : parseFloat(sizeConv(d[state.nodeSize.field])))\n      .attr('width', htwidth)\n      .attr('height', 1)\n      .attr('overflow', 'visible');\n    fo.select('div')\n      .style('font-size', `${state.nodeLabel.size}px`)\n      .style('color', d => labelColorConv(d[state.nodeLabelColor.field]))\n      .style('text-align', 'center')\n      .style('display', state.nodeLabel.visible ? 'block' : 'none')\n      .html(d => d[state.nodeLabel.field]);\n    selection.selectAll('.node').select('.node-label').text('');\n  } else {\n    selection.selectAll('.node').select('.node-label')\n        .attr('font-size', state.nodeLabel.size)\n        .attr('y', d => state.focusedView ? svgWidth / 2 - 10\n          : parseFloat(sizeConv(d[state.nodeSize.field])))\n        .attr('visibility', state.nodeLabel.visible ? 'inherit' : 'hidden')\n        .style('fill', d => labelColorConv(d[state.nodeLabelColor.field]))\n        .text(d => textConv(d[state.nodeLabel.field]));\n    selection.selectAll('.node').select('.node-html div').html('');\n  }\n}\n\n\nfunction updateEdgeAttrs(selection, state) {\n  const colorConv = scale.scaleFunction(state.edgeColor);\n  const widthConv = scale.scaleFunction(state.edgeWidth);\n  const labelColorConv = scale.scaleFunction(state.edgeLabelColor);\n  const field = state.edges.fields\n    .find(e => e.key === state.edgeLabel.field);\n  const textConv = value => {\n    return field.format === 'd3_format'\n      ? misc.formatNum(value, field.d3_format) : value;\n  };\n  selection.selectAll('.link').select('.edge-line')\n    .style('stroke', d => colorConv(d[state.edgeColor.field]))\n    .style('stroke-width', d => widthConv(d[state.edgeWidth.field]));\n  selection.selectAll('.link').select('.edge-label')\n    .attr('font-size', state.edgeLabel.size)\n    .attr('visibility', state.edgeLabel.visible ? 'inherit' : 'hidden')\n    .style('fill', d => labelColorConv(d[state.edgeLabelColor.field]))\n    .text(d => textConv(d[state.edgeLabel.field]));\n}\n\n\nfunction updateNodeCoords(selection) {\n  selection.attr('transform', d => `translate(${d.x}, ${d.y})`);\n}\n\n\nfunction updateEdgeCoords(selection) {\n  selection.attr('transform', d => `translate(${d.sx}, ${d.sy})`);\n  selection.select('.edge-line')\n    .attr('x1', 0)\n    .attr('y1', 0)\n    .attr('x2', d => d.tx - d.sx)\n    .attr('y2', d => d.ty - d.sy);\n  selection.select('.edge-label')\n    .attr('x', d => (d.tx - d.sx) / 2)\n    .attr('y', d => (d.ty - d.sy) / 2);\n}\n\n\nfunction updateAttrs(selection, state) {\n  selection.call(updateNodeAttrs, state);\n  selection.call(updateEdgeAttrs, state);\n}\n\n\nfunction updateComponents(selection, state) {\n  const nodesToRender = state.nodesToRender();\n  const numNodes = nodesToRender.length;\n  if (state.enableFocusedView) {\n    state.focusedView = numNodes < state.focusedViewThreshold;\n  }\n  if (state.enableOverlookView) {\n    state.overlookView = numNodes > state.overlookViewThreshold;\n  }\n  const edgesToRender = state.overlookView ? [] : state.edgesToRender();\n  selection.select('.node-layer')\n    .call(updateNodes, nodesToRender, state.focusedView);\n  selection.select('.edge-layer')\n    .call(updateEdges, edgesToRender);\n  selection.call(updateAttrs, state);\n}\n\n\nfunction moveNode(selection, x, y) {\n  selection.attr('transform', `translate(${x}, ${y})`);\n}\n\n\nfunction moveEdge(selection, sx, sy, tx, ty) {\n  selection.attr('transform', `translate(${sx}, ${sy})`);\n  selection.select('.edge-line')\n    .attr('x1', 0)\n    .attr('y1', 0)\n    .attr('x2', tx - sx)\n    .attr('y2', ty - sy);\n  selection.select('.edge-label')\n    .attr('x', (tx - sx) / 2)\n    .attr('y', (ty - sy) / 2);\n}\n\n\nfunction move(selection, node, x, y) {\n  const n = d3.select(node).call(moveNode, x, y).datum();\n  selection.select('.edge-layer')\n    .selectAll(\".link\")\n    .filter(d => n.adjacency.map(e => e[1]).includes(d.num))\n    .each(function (d) {\n      if (n.index === d.source.index) {\n        d3.select(this).call(moveEdge, x, y, d.tx, d.ty);\n      } else if (n.index === d.target.index) {\n        d3.select(this).call(moveEdge, d.sx, d.sy, x, y);\n      }\n    });\n}\n\n\nfunction networkView(selection, state) {\n  selection.call(transform.view, state);\n  const field = selection.select('.field');\n  const edges = field.append('g').classed('edge-layer', true);\n  const nodes = field.append('g').classed('node-layer', true);\n  const legendGroup = selection.append('g')\n      .classed('legends', true);\n  legendGroup.append('g')\n      .classed('nodecolor', true)\n      .call(legend.colorBarLegend);\n\n  // Apply changes in datasets\n  state.updateAllNotifier = () => {\n    state.updateWorkingCopy();\n    // Explorative network\n    if (!state.nodes.fields.includes('elevation')) {\n      const expn = expnet.explorativeNetwork(state.ns, state.es)\n        .baseFactor(state.minConnThld)();\n      const elevmap = {\n        key: 'index',\n        field: {key: 'elevation', name: 'Elevation', d3_format: '.3f'},\n        mapping: expn.elevations\n      };\n      state.nodes.joinFields(elevmap);\n      const pathmap = {\n        key: 'index',\n        field: {key: 'pweight', name: 'Path weight', d3_format: '.3f'},\n        mapping: expn.pathWeights\n      };\n      // TODO:\n      state.edges.contents[0].records.forEach((e, i) => {\n        e.pweight = expn.pathWeights[i];\n      });\n      if (!state.edges.contents[0].fields.find(e => e.key === 'pweight')) {\n        state.edges.contents[0].fields.push(pathmap.field);\n      }\n      state.edges.addField(pathmap.field);\n      state.updateWorkingCopy();\n    }\n    state.updateControlBoxNotifier();  // Update selectBox options\n    state.setForceNotifier();\n    state.updateComponentNotifier();\n  };\n  // Apply changes in nodes and edges displayed\n  state.updateComponentNotifier = () => {\n    state.updateLegendNotifier();\n    const coords = state.ns.map(e => ({x: e.x, y: e.y}));\n    state.setAllCoords(coords);\n    selection.call(updateComponents, state);\n    state.updateInteractionNotifier();  // Apply drag events to each nodes\n  };\n  state.updateNodeNotifier = () => {\n    nodes.call(updateNodes, state.nodesToRender());\n    state.updateLegendNotifier();\n  };\n  state.updateEdgeNotifier = () => {\n    edges.call(updateEdges, state.edgesToRender());\n  };\n  state.updateNodeAttrNotifier = () => {\n    nodes.call(updateNodeAttrs, state);\n    state.updateLegendNotifier();\n  };\n  state.updateEdgeAttrNotifier = () => {\n    edges.call(updateEdgeAttrs, state);\n  };\n  state.updateLegendNotifier = () => {\n    legendGroup.call(legend.updateLegendGroup,\n                     state.viewBox, state.legendOrient);\n    legendGroup.select('.nodecolor')\n        .attr('visibility', state.nodeColor.legend ? 'inherit' : 'hidden')\n        .call(legend.updateColorBarLegend, state.nodeColor);\n  };\n}\n\n\nexport default {\n  updateNodes, updateEdges, updateNodeCoords, updateEdgeCoords,\n  updateNodeAttrs, updateEdgeAttrs, updateAttrs, updateComponents,\n  move, moveEdge, networkView\n};\n","\n/** @module network/interaction */\n\nimport _ from 'lodash';\nimport d3 from 'd3';\n\nimport {default as transform} from '../component/transform.js';\n\nimport {default as component} from './component.js';\n\n\nfunction dragListener(selection, state) {\n  return d3.drag()\n    .on('drag', function () {\n      selection.call(component.move, this, d3.event.x, d3.event.y);\n    })\n    .on('end', function (d) {\n      state.setCoords(d.index, d3.event.x, d3.event.y);\n    });\n}\n\n\nfunction multiDragListener(selection, state) {\n  const origin = {x: 0, y: 0};\n  return d3.drag()\n    .on('start', function () {\n      origin.x = d3.event.x;\n      origin.y = d3.event.y;\n    })\n    .on('drag', function () {\n      const dx = d3.event.x - origin.x;\n      const dy = d3.event.y - origin.y;\n      d3.select(this).attr('transform', `translate(${dx}, ${dy})`);\n      selection.selectAll('.selected-nodes .node')\n        .each(function (n) {\n          const newX = n.x + dx;\n          const newY = n.y + dy;\n          selection.selectAll('.edge-layer .link')\n            .filter(d => n.adjacency.map(e => e[1]).includes(d.num))\n            .each(function (d) {\n              if (n.index === d.source.index) {\n                d3.select(this)\n                    .call(component.moveEdge, newX, newY, d.tx, d.ty);\n              } else if (n.index === d.target.index) {\n                d3.select(this)\n                    .call(component.moveEdge, d.sx, d.sy, newX, newY);\n              }\n            });\n        });\n    })\n    .on('end', function () {\n      const dx = d3.event.x - origin.x;\n      const dy = d3.event.y - origin.y;\n      selection.selectAll('.selected-nodes .node')\n        .each(function (n) {\n          const newX = n.x + dx;\n          const newY = n.y + dy;\n          state.setCoords(n.index, newX, newY);\n          d3.select(this).attr('transform', `translate(${newX}, ${newY})`);\n        });\n      selection.selectAll('.selected-edges .link')\n          .attr('transform', d => `translate(${d.sx}, ${d.sy})`);\n      d3.select(this).attr('transform', `translate(0, 0)`);\n    });\n}\n\n\nfunction zoomListener(selection, state) {\n  let prevTransform = {x: 0, y: 0, k: 1};\n  selection\n      .on(\"dblclick.zoom\", null)  // disable double-click zoom\n      .on('.drag', null);  // disable rectSelect\n  return d3.zoom()\n    .on('zoom', function() {\n      const t = d3.event.transform;\n      selection.call(transform.transform, t.x, t.y, t.k);\n      // Smooth transition\n      if (!state.focusedView) {\n        const p = prevTransform;\n        const xMoved = t.x > p.x + 20 || t.x < p.x - 20;\n        const yMoved = t.y > p.y + 20 || t.y < p.y - 20;\n        const zoomIn = t.k > p.k;\n        if (xMoved || yMoved && !zoomIn) {\n          state.setTransform(t.x, t.y, t.k);\n          prevTransform = {x: t.x, y: t.y, k: t.k};\n          state.updateComponentNotifier();\n        }\n      }\n    })\n    .on('end', function() {\n      const t = d3.event.transform;\n      state.setTransform(t.x, t.y, t.k);\n      prevTransform = {x: t.x, y: t.y, k: t.k};\n      state.updateComponentNotifier();\n    });\n}\n\n\nfunction rectSelectListener(selection, state) {\n  selection.on('.zoom', null);  // disable zoom\n  const rect = selection.select('.interactions .rect-select');\n  const origin = {x: 0, y: 0};\n  let initSel = [];\n  return d3.drag()\n    .on('start', function () {\n      origin.x = d3.event.x;\n      origin.y = d3.event.y;\n      initSel = state.ns.map(e => e.selected);\n      rect.attr('visibility', 'visible')\n          .attr('x', origin.x).attr('y', origin.y);\n    })\n    .on('drag', function () {\n      const left = Math.min(origin.x, d3.event.x);\n      const width = Math.abs(origin.x - d3.event.x);\n      const top = Math.min(origin.y, d3.event.y);\n      const height = Math.abs(origin.y - d3.event.y);\n      const tf = state.transform;\n      const xConv = x => (x - tf.x) / tf.k;\n      const yConv = y => (y - tf.y) / tf.k;\n      selection.selectAll('.node')\n        .each(function(d) {\n          const selected = d3.select(this.parentNode).classed('selected-nodes');\n          const inside = d.x > xConv(left) && d.y > yConv(top)\n              && d.x < xConv(left + width) && d.y < yConv(top + height);\n          const sel = selected !== inside;\n          d3.select(this)\n            .select('.node-symbol')\n              .attr('stroke', sel ? 'red' : null)\n              .attr('stroke-width', sel ? 10 : null)\n              .attr('stroke-opacity', sel ? 0.5 : 0);\n        rect.attr('x', left).attr('y', top)\n            .attr('width', width).attr('height', height);\n\n      });\n    })\n    .on('end', function () {\n      const left = Math.min(origin.x, d3.event.x);\n      const width = Math.abs(origin.x - d3.event.x);\n      const top = Math.min(origin.y, d3.event.y);\n      const height = Math.abs(origin.y - d3.event.y);\n      const tf = state.transform;\n      const xConv = x => (x - tf.x) / tf.k;\n      const yConv = y => (y - tf.y) / tf.k;\n      state.ns.filter(\n        n => n.x > xConv(left) && n.y > yConv(top)\n          && n.x < xConv(left + width) && n.y < yConv(top + height)\n      ).forEach(n => {\n        n.selected = !initSel[n.index];\n        // Selection should be an induced subgraph of the network\n        n.adjacency.forEach(adj => {\n          state.es[adj[1]].selected = (\n            state.ns[n.index].selected && state.ns[adj[0]].selected);\n        });\n      });\n      state.updateComponentNotifier();\n      rect.attr('visibility', 'hidden')\n          .attr('width', 0).attr('height', 0);\n    });\n}\n\n\nfunction selectListener(selection, state) {\n  return sel => {\n    sel.on('touchstart', function () { d3.event.preventDefault(); })\n        .on('touchmove', function () { d3.event.preventDefault(); })\n        .on('click.select', function () {\n          d3.event.stopPropagation();\n          const n = d3.select(this).datum().index;\n          const isSel = state.ns[n].selected;\n          state.ns.forEach(e => { e.selected = false; });\n          state.es.forEach(e => { e.selected = false; });\n          state.ns[n].selected = !isSel;\n          state.updateComponentNotifier();\n        });\n  };\n}\n\n\nfunction multiSelectListener(selection, state) {\n  return sel => {\n    sel.on('touchstart', function () { d3.event.preventDefault(); })\n        .on('touchmove', function () { d3.event.preventDefault(); })\n        .on('click.select', function () {\n          d3.event.stopPropagation();\n          const data = d3.select(this).datum();\n          const n = data.index;\n          state.ns[n].selected = !state.ns[n].selected;\n          // Selection should be an induced subgraph of the network\n          data.adjacency.forEach(adj => {\n            state.es[adj[1]].selected = (\n              state.ns[n].selected && state.ns[adj[0]].selected);\n          });\n          state.updateComponentNotifier();\n        });\n  };\n}\n\n\nfunction resume(selection, tf) {\n  selection\n      .call(transform.transform, tf.x, tf.y, tf.k)\n      .call(\n        d3.zoom().transform,\n        d3.zoomIdentity.translate(tf.x, tf.y).scale(tf.k)\n      );\n}\n\n\n// TODO: refactor\n// Custom updater for interactive mode\nfunction updateComponents(selection, state) {\n  const nodesToRender = state.nodesToRender();\n  const [nodesSelected, nodesNotSelected] = _.partition(\n    nodesToRender, d => d.selected);\n  const numNodes = nodesToRender.length;\n  if (state.enableFocusedView) {\n    state.focusedView = numNodes < state.focusedViewThreshold;\n  }\n  if (state.enableOverlookView) {\n    state.overlookView = numNodes > state.overlookViewThreshold;\n  }\n  const edgesToRender = state.overlookView ? [] : state.edgesToRender();\n  const [edgesSelected, edgesNotSelected] = _.partition(\n      edgesToRender, d => d.selected);\n  selection.select('.node-layer')\n      .call(component.updateNodes, nodesNotSelected, state.focusedView)\n    .selectAll('.node .node-symbol')\n      .attr('stroke-opacity', 0);\n  selection.select('.edge-layer')\n      .call(component.updateEdges, edgesNotSelected);\n  selection.select('.selected-nodes')\n      .call(component.updateNodes, nodesSelected, state.focusedView)\n    .selectAll('.node .node-symbol')\n      .attr('stroke', 'red')\n      .attr('stroke-width', 10)\n      .attr('stroke-opacity', 0.5);\n  selection.select('.selected-edges')\n      .call(component.updateEdges, edgesSelected);\n  selection.call(component.updateAttrs, state);\n}\n\n\nfunction setInteraction(selection, state) {\n  // Object selection layer\n  const selectedObj = selection.select('.field')\n    .append('g').classed('selected-obj', true);\n  selectedObj.append('g').classed('selected-edges', true);\n  selectedObj.append('g').classed('selected-nodes', true);\n\n  // Rectangle selection layer\n  selection.append('g')\n      .classed('interactions', true)\n    .append('rect')\n      .classed('rect-select', true)\n      .attr('fill', 'none')\n      .attr('stroke', 'black')\n      .attr('stroke-width', 1)\n      .attr('stroke-dasharray', '5,5')\n      .attr('visibility', 'hidden');\n\n  // Background click to clear selection\n  selection\n      .on('touchstart', function () { d3.event.preventDefault(); })\n      .on('touchmove', function () { d3.event.preventDefault(); })\n      .on('click', function () {\n        if (event.shiftKey) d3.event.preventDefault();\n        state.ns.forEach(e => { e.selected = false; });\n        state.es.forEach(e => { e.selected = false; });\n        state.updateComponentNotifier();\n      });\n\n  // Enter multiple select mode\n  document.addEventListener('keydown', event => {\n    if (event.key !== 'Shift') return;\n    selection.style(\"cursor\", \"crosshair\");\n    state.zoomListener = rectSelectListener(selection, state);\n    state.selectListener = multiSelectListener(selection, state);\n    state.updateInteractionNotifier();\n  });\n\n  // Exit multiple select mode\n  document.addEventListener('keyup', event => {\n    if (event.key !== 'Shift') return;\n    selection.style(\"cursor\", \"auto\");\n    state.zoomListener = zoomListener(selection, state);\n    state.selectListener = selectListener(selection, state);\n    state.updateInteractionNotifier();\n  });\n\n  // Event listeners\n  state.zoomListener = zoomListener(selection, state);\n  state.dragListener = dragListener(selection, state);\n  state.selectListener = selectListener(selection, state);\n\n  // Update interaction events\n  state.updateInteractionNotifier = () => {\n    selection.call(state.zoomListener);\n    selection.selectAll('.node')\n        .call(state.selectListener);\n    selection.selectAll('.node-layer .node')\n        .call(state.dragListener);\n    selection.selectAll('.selected-obj')\n        .call(multiDragListener(selection, state));\n    selection.call(resume, state.transform);\n  };\n\n  // Update components\n  state.updateComponentNotifier = () => {\n    state.updateLegendNotifier();\n    const coords = state.ns.map(e => ({x: e.x, y: e.y}));\n    state.setAllCoords(coords);\n    selection.call(updateComponents, state);  // Custom updater\n    state.updateInteractionNotifier();  // Apply drag events to each nodes\n  };\n\n  // Fit to the viewBox\n  state.fitNotifier = () => {\n    state.fitTransform();\n    state.updateComponentNotifier();\n    selection.call(resume, state.transform);\n  };\n}\n\n\nexport default {\n  dragListener, zoomListener, setInteraction\n};\n","\n/** @module network/force */\n\nimport d3 from 'd3';\n\nimport {default as component} from './component.js';\nimport {default as interaction} from './interaction.js';\n\n\nconst forceType = [\n  {\n    key: 'aggregate',\n    name: 'Aggregate',\n    force: d3.forceSimulation()\n      .force('link', d3.forceLink().id(d => d.index).distance(60).strength(1))\n      .force('charge',\n        d3.forceManyBody().strength(-600).distanceMin(15).distanceMax(720))\n      .force('collide', d3.forceCollide().radius(90))\n      .force('x', d3.forceX().strength(0.002))\n      .force('y', d3.forceY().strength(0.002))\n  },\n  {\n    key: 'tree',\n    name: 'Tree',\n    force: d3.forceSimulation()\n      .force('link', d3.forceLink().id(d => d.index).distance(60).strength(2))\n      .force('charge',\n        d3.forceManyBody().strength(-6000).distanceMin(15).distanceMax(720))\n      .force('collide', d3.forceCollide().radius(90))\n      .force('x', d3.forceX().strength(0.0002))\n      .force('y', d3.forceY().strength(0.0002))\n  },\n  {\n    key: 'sparse',\n    name: 'Sparse',\n    force: d3.forceSimulation()\n      .force('link', d3.forceLink().id(d => d.index).distance(60).strength(2))\n      .force('charge',\n        d3.forceManyBody().strength(-6000).distanceMin(15).distanceMax(3600))\n      .force('collide', d3.forceCollide().radius(90))\n      .force('x', d3.forceX().strength(0.0002))\n      .force('y', d3.forceY().strength(0.0002))\n  }\n];\n\n\nfunction forceSimulation(type, width, height) {\n  return forceType.find(e => e.key === type).force\n    .force('center', d3.forceCenter(width / 2, height / 2))\n    .stop();\n}\n\n\nfunction forceDragListener(selection, simulation, state) {\n  return d3.drag()\n    .on('start', () => {\n      if (!d3.event.active) state.relaxNotifier();\n    })\n    .on('drag', d => {\n      d.fx = d3.event.x;\n      d.fy = d3.event.y;\n    })\n    .on('end', d => {\n      if (!d3.event.active) simulation.alphaTarget(0);\n      d.fx = null;\n      d.fy = null;\n    });\n}\n\n\nfunction stick(selection, simulation, state) {\n  simulation.alpha(0).stop();\n  selection.selectAll('.node')\n    .each(d => {\n      d.fx = d.x;\n      d.fy = d.y;\n    });\n  state.dragListener = interaction.dragListener(selection, state);\n  state.forceActive = false;\n}\n\n\nfunction unstick(selection, simulation, state) {\n  selection.selectAll('.node')\n    .each(d => {\n      d.fx = null;\n      d.fy = null;\n    });\n  state.dragListener = forceDragListener(selection, simulation, state);\n  state.forceActive = true;\n}\n\n\nfunction activate(selection, state) {\n  state.setForceNotifier = () => {\n    const simulation = forceSimulation(\n        state.forceType, state.fieldWidth, state.fieldHeight);\n    simulation.nodes(state.ns)\n      .force('link').links(state.currentEdges());\n    simulation\n      .on('tick', () => {\n        const coords = state.ns.map(e => ({x: e.x, y: e.y}));\n        state.setAllCoords(coords);\n        selection.selectAll(\".node\")\n          .call(component.updateNodeCoords);\n        selection.selectAll(\".link\")\n          .call(component.updateEdgeCoords);\n        state.tickCallback(simulation);\n      })\n      .on('end', () => {\n        state.updateComponentNotifier();\n        state.tickCallback(simulation);\n      });\n    if (state.forceActive) {\n      state.coords ? state.relaxNotifier() : state.restartNotifier();\n    } else {\n      state.stickNotifier();\n    }\n\n    state.stickNotifier = () => {\n      selection.call(stick, simulation, state);\n    };\n    state.relaxNotifier = () => {\n      selection.call(unstick, simulation, state);\n      simulation.alpha(0.1).restart();\n    };\n    state.restartNotifier = () => {\n      selection.call(unstick, simulation, state);\n      simulation.alpha(1).restart();\n    };\n  };\n}\n\n\nexport default {\n  forceType, forceSimulation, activate\n};\n","\n/** @module network/controlBox */\n\nimport _ from 'lodash';\nimport d3 from 'd3';\n\nimport {default as misc} from '../common/misc.js';\nimport {default as cscale} from '../common/scale.js';\n\nimport {default as badge} from '../component/badge.js';\nimport {default as box} from '../component/formBox.js';\nimport {default as cbox} from '../component/controlBox.js';\nimport {default as lbox} from '../component/formListBox.js';\nimport {default as button} from '../component/button.js';\n\nimport {default as force} from './force.js';\n\n\nfunction mainControlBox(selection, state) {\n  // Zoom\n  selection.append('div')\n      .classed('mb-3', true)\n    .append('div')\n      .classed('fit', true)\n      .call(button.buttonBox, 'Fit to screen', 'primary');\n  // View modes\n  const viewModes = selection.append('div')\n      .classed('mb-3', true);\n    viewModes.append('div')\n      .classed('focused', true)\n      .classed('mb-1', true)\n      .call(box.checkBox, 'Enable focused view');\n    viewModes.append('div')\n      .classed('overlook', true)\n      .classed('mb-1', true)\n      .call(box.checkBox, 'Enable overlook view');\n\n  // Legend\n  const legendOptions = [\n    {key: 'top-left', name: 'Top-left'},\n    {key: 'top-right', name: 'Top-right'},\n    {key: 'bottom-left', name: 'Bottom-left'},\n    {key: 'bottom-right', name: 'Bottom-right'},\n  ];\n  selection.append('div')\n      .classed('legend', true)\n      .classed('mb-3', true)\n      .call(lbox.selectBox, 'Legend')\n      .call(lbox.updateSelectBoxOptions, legendOptions)\n      .on('change', function () {\n        state.legendOrient = box.formValue(d3.select(this));\n        state.updateLegendNotifier();\n      });\n\n  // Network threshold\n  const thldGroup = selection.append('div')\n      .classed('thld-group', true)\n      .classed('mb-3', true);\n  thldGroup.append('div')\n      .classed('field', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Connection');\n  thldGroup.append('div')\n      .classed('thld', true)\n      .classed('mb-1', true)\n      .call(box.numberBox, 'Threshold')\n      .call(box.updateNumberRange, state.minConnThld, 1, 0.01)\n      .call(badge.updateInvalidMessage,\n            `Please provide a valid range (${state.minConnThld}-1.00)`)\n    .select('.form-control')\n      .attr('required', 'required');\n  thldGroup.append('div')\n      .classed('logd', true)\n      .classed('mb-1', true)\n      .call(box.readonlyBox, 'logD');\n  // Force layout\n  const forceBox = selection.append('div')\n      .classed('form-group', true)\n      .classed('form-row', true);\n  forceBox.append('div')\n      .classed('col-12', true)\n    .append('div')\n      .classed('forcetype', true)\n      .classed('mb-1', true)\n      .call(lbox.selectBox, 'Force')\n      .call(lbox.updateSelectBoxOptions, force.forceType)\n      .on('change', function () {\n        const value = box.formValue(d3.select(this));\n        state.forceType = value;\n        state.setForceNotifier();\n      });\n  forceBox.append('div')\n      .classed('col-6', true)\n    .append('span')\n      .classed('col-form-label', true)\n      .classed('col-form-label-sm', true)\n      .classed('mb-1', true)\n      .text('Temperature');\n  forceBox.append('div')\n      .classed('col-12', true)\n    .append('div')\n      .classed('temperature', true)\n      .classed('progress', true)\n    .append('div')\n      .classed('progress-bar', true)\n      .classed('w-30', true)\n      .attr('id', 'temperature')\n      .attr('role', 'progressbar')\n      .attr('aria-valuemin', 0)\n      .attr('aria-valuemax', 100);\n  forceBox.append('div')\n      .classed('col-12', true)\n    .append('div')\n      .classed('stick', true)\n      .classed('mb-1', true)\n      .call(box.checkBox, 'Stick nodes');\n  forceBox.append('div')\n      .classed('col-12', true)\n    .append('div')\n      .classed('restart', true)\n      .classed('mb-1', true)\n      .call(button.buttonBox, 'Activate', 'warning');\n}\n\n\nfunction updateMainControl(selection, state) {\n  // Zoom\n  selection.select('.fit')\n      .on('click', function () { state.fitNotifier(); });\n  // Focused view\n  selection.select('.focused')\n      .call(box.updateCheckBox, state.enableFocusedView)\n      .on('change', function () {\n        state.enableFocusedView = box.checkBoxValue(d3.select(this));\n        state.focusedView = box.checkBoxValue(d3.select(this));\n        state.updateComponentNotifier();\n      });\n  // Overlook view\n  selection.select('.overlook')\n      .call(box.updateCheckBox, state.enableOverlookView)\n      .on('change', function () {\n        state.enableOverlookView = box.checkBoxValue(d3.select(this));\n        state.overlookView = box.checkBoxValue(d3.select(this));\n        state.updateComponentNotifier();\n      });\n  // Network threshold\n  const thldGroup = selection.select('.thld-group');\n  const thldFields = state.edges.fields\n    .filter(e => misc.sortType(e.format) !== 'none')\n    .filter(e => !['source', 'target'].includes(e.key));\n  thldGroup.select('.field')\n      .call(lbox.updateSelectBoxOptions, thldFields)\n      .call(box.updateFormValue, state.connThldField);\n  thldGroup.select('.thld')\n      .call(box.updateFormValue, state.currentConnThld);\n  thldGroup.selectAll('.field, .thld')\n      .on('change', function () {\n        if(!box.formValid(thldGroup.select('.thld'))) return;\n        const field = box.formValue(thldGroup.select('.field'));\n        const thld = box.formValue(thldGroup.select('.thld'));\n        state.connThldField = field;\n        state.currentConnThld = thld;\n        thldGroup.select('.logd').dispatch('update');\n        state.setForceNotifier();\n        state.updateComponentNotifier();\n      });\n  thldGroup.select('.logd')\n      .on('update', function () {\n        // Calculate edge density\n        const field = state.connThldField;\n        const thld = state.currentConnThld;\n        const numEdges = state.es.filter(e => e[field] >= thld).length;\n        const n = state.ns.length;\n        const combinations = n * (n - 1) / 2;\n        const logD = d3.format('.2f')(Math.log10(numEdges / combinations));\n        d3.select(this).call(box.updateReadonlyValue, logD);\n      })\n      .dispatch('update');\n\n  // Force layout\n  state.tickCallback = (simulation) => {\n    const alpha = simulation.alpha();\n    const isStopped = alpha <= simulation.alphaMin();\n    const progress = parseInt(isStopped ? 0 : alpha * 100);\n    selection.select('.temperature')\n      .select('.progress-bar')\n        .classed('bg-success', isStopped)\n        .classed('bg-warning', !isStopped)\n        .style('width', `${progress}%`)\n        .attr('aria-valuenow', progress);\n  };\n  selection.select('.stick')\n      .call(box.updateCheckBox, !state.forceActive)\n      .on('change', function () {\n        const value = box.checkBoxValue(d3.select(this));\n        state.forceActive = !value;\n        selection.select('.temperature')\n            .style('background-color', value ? '#a3e4d7' : '#e9ecef')\n          .select('.progress-bar')\n            .style('width', `0%`)\n            .attr('aria-valuenow', 0);\n        value ? state.stickNotifier() : state.relaxNotifier();\n        state.updateComponentNotifier();\n      });\n  selection.select('.restart')\n      .on('click', function () {\n        selection.select('.stick')\n            .call(box.updateCheckBox, false)\n            .dispatch('change');\n        state.restartNotifier();\n      });\n}\n\n\nfunction updateNodeColorControl(selection, state) {\n  const fieldOptions = state.nodes.fields\n    .filter(e => misc.sortType(e.format) !== 'none');\n  selection\n      .call(cbox.updateColorControl, fieldOptions, state.nodeColor)\n      .on('change', function() {\n        if (!cbox.colorControlValid(selection)) return;\n        state.nodeColor = cbox.colorControlState(selection);\n        if (state.nodeColor.scale === 'ordinal') {\n          const keys = state.nodes.records().map(e => e[state.nodeColor.field]);\n          state.nodeColor.domain = _.uniq(keys).sort();\n        }\n        state.updateNodeAttrNotifier();\n      });\n}\n\n\nfunction updateEdgeColorControl(selection, state) {\n  const fieldOptions = state.edges.fields\n    .filter(e => misc.sortType(e.format) !== 'none')\n    .filter(e => !['source', 'target'].includes(e.key));\n  selection\n      .call(cbox.updateColorControl, fieldOptions, state.edgeColor)\n      .on('change', function() {\n        if (!cbox.colorControlValid(selection)) return;\n        state.edgeColor = cbox.colorControlState(selection);\n        if (state.edgeColor.scale === 'ordinal') {\n          const keys = state.edges.records().map(e => e[state.edgeColor.field]);\n          state.edgeColor.domain = _.uniq(keys).sort();\n        }\n        state.updateEdgeAttrNotifier();\n      });\n\n  // TODO: not implemented yet\n  selection.select('.legend input').property('disabled', true);\n}\n\n\nfunction updateNodeSizeControl(selection, state) {\n  const fieldOptions = state.nodes.fields\n    .filter(e => misc.sortType(e.format) !== 'none');\n  selection\n      .call(cbox.updateSizeControl, fieldOptions, state.nodeSize)\n      .on('change', function() {\n        if (!cbox.sizeControlValid(selection)) return;\n        state.nodeSize = cbox.sizeControlState(selection);\n        state.updateNodeAttrNotifier();\n      });\n}\n\n\nfunction updateEdgeWidthControl(selection, state) {\n  const fieldOptions = state.edges.fields\n    .filter(e => misc.sortType(e.format) !== 'none')\n    .filter(e => !['source', 'target'].includes(e.key));\n  selection\n      .call(cbox.updateSizeControl, fieldOptions, state.edgeWidth)\n      .on('change', function() {\n        if (!cbox.sizeControlValid(selection)) return;\n        state.edgeWidth = cbox.sizeControlState(selection);\n        state.updateEdgeAttrNotifier();\n      });\n}\n\n\nfunction updateNodeLabelControl(selection, state) {\n  const fieldOptions = state.nodes.fields\n    .filter(e => misc.sortType(e.format) !== 'none');\n  selection\n      .call(cbox.updateLabelControl, fieldOptions,\n            state.nodeLabel, state.nodeLabelColor)\n      .on('change', function() {\n        if (!cbox.labelControlValid(selection)) return;\n        const values = cbox.labelControlState(selection);\n        state.nodeLabel = values.label;\n        state.nodeLabelColor = values.labelColor;\n        if (state.nodeLabelColor.scale === 'ordinal') {\n          const keys = state.nodes.records()\n            .map(e => e[state.nodeLabelColor.field]);\n          state.nodeLabelColor.domain = _.uniq(keys).sort();\n        }\n        state.updateNodeAttrNotifier();\n      });\n}\n\n\nfunction updateEdgeLabelControl(selection, state) {\n  const fieldOptions = state.edges.fields\n    .filter(e => misc.sortType(e.format) !== 'none')\n    .filter(e => !['source', 'target'].includes(e.key));\n  selection\n      .call(cbox.updateLabelControl, fieldOptions,\n            state.edgeLabel, state.edgeLabelColor)\n      .on('change', function() {\n        if (!cbox.labelControlValid(selection)) return;\n        const values = cbox.labelControlState(selection);\n        state.edgeLabel = values.label;\n        state.edgeLabelColor = values.labelColor;\n        if (state.edgeLabelColor.scale === 'ordinal') {\n          const keys = state.edges.records()\n            .map(e => e[state.edgeLabelColor.field]);\n          state.edgeLabelColor.domain = _.uniq(keys).sort();\n        }\n        state.updateEdgeAttrNotifier();\n      });\n}\n\n\nfunction controlBox(selection, state) {\n  // Clean up\n  selection.select('nav').remove();\n  selection.select('.tab-content').remove();\n\n  selection.call(\n    cbox.controlBoxFrame, 'control-frame-nav', 'control-frame-content');\n  const tabs = selection.select('.nav-tabs');\n  const content = selection.select('.tab-content');\n\n  // Main\n  tabs.append('a')\n      .classed('active', true)\n      .attr('aria-selected', 'true')\n      .call(cbox.controlBoxNav, 'control-main', 'Main');\n  content.append('div')\n      .classed('show', true)\n      .classed('active', true)\n      .classed('control-main', true)\n      .call(cbox.controlBoxItem, 'control-main')\n      .call(mainControlBox, state);\n\n  // Color\n  tabs.append('a')\n      .call(cbox.controlBoxNav, 'control-color', 'Color');\n  content.append('div')\n      .classed('control-color', true)\n      .call(cbox.controlBoxItem, 'control-color')\n      .call(cbox.colorControlBox, cscale.colorScales);\n\n  // Size\n  tabs.append('a')\n      .call(cbox.controlBoxNav, 'control-size', 'Size');\n  content.append('div')\n      .classed('control-size', true)\n      .call(cbox.controlBoxItem, 'control-size')\n      .call(cbox.sizeControlBox);\n\n  // Label\n  tabs.append('a')\n      .call(cbox.controlBoxNav, 'control-label', 'Label');\n  content.append('div')\n      .classed('control-label', true)\n      .call(cbox.controlBoxItem, 'control-label')\n      .call(cbox.labelControlBox, cscale.colorScales);\n\n  // Edge color\n  tabs.append('a')\n      .call(cbox.controlBoxNav, 'control-edgecolor', 'eColor');\n  content.append('div')\n      .classed('control-edgecolor', true)\n      .call(cbox.controlBoxItem, 'control-edgecolor')\n      .call(cbox.colorControlBox, cscale.colorScales);\n\n  // Edge width\n  tabs.append('a')\n      .call(cbox.controlBoxNav, 'control-edgewidth', 'eWidth');\n  content.append('div')\n      .classed('control-edgewidth', true)\n      .call(cbox.controlBoxItem, 'control-edgewidth')\n      .call(cbox.sizeControlBox);\n\n  // Edge label\n  tabs.append('a')\n      .call(cbox.controlBoxNav, 'control-edgelabel', 'eLabel');\n  content.append('div')\n      .classed('control-edgelabel', true)\n      .call(cbox.controlBoxItem, 'control-edgelabel')\n      .call(cbox.labelControlBox, cscale.colorScales);\n\n  state.updateControlBoxNotifier = () => {\n    selection.call(updateControlBox, state);\n  };\n}\n\n\nfunction updateControlBox(selection, state) {\n  selection.select('.control-main')\n      .call(updateMainControl, state);\n  selection.select('.control-color')\n      .call(updateNodeColorControl, state);\n  selection.select('.control-size')\n      .call(updateNodeSizeControl, state);\n  selection.select('.control-label')\n      .call(updateNodeLabelControl, state);\n  selection.select('.control-edgecolor')\n      .call(updateEdgeColorControl, state);\n  selection.select('.control-edgewidth')\n      .call(updateEdgeWidthControl, state);\n  selection.select('.control-edgelabel')\n      .call(updateEdgeLabelControl, state);\n}\n\n\nexport default {\n  controlBox, updateControlBox\n};\n","\n/** @module network */\n\n\nimport NetworkState from './network/state.js';\nimport {default as control} from './network/controlBox.js';\nimport {default as component} from './network/component.js';\nimport {default as force} from './network/force.js';\nimport {default as interaction} from './network/interaction.js';\n\n\nexport default {\n  NetworkState, control, component, force, interaction\n};\n","\n/** @module network/state */\n\nimport Collection from '../common/collection.js';\nimport TransformState from  '../common/transform.js';\nimport {default as idb} from '../common/idb.js';\n\n\nexport default class NetworkState extends TransformState {\n  constructor(view, nodes, edges) {\n    super(1200, 1200, view.fieldTransform);\n\n    /* Settings */\n\n    // Focused view mode (num of nodes displayed are less than the thld)\n    // Show node contents\n    // Disable smooth transition\n    this.focusedViewThreshold = 100;\n    this.enableFocusedView = true;\n    this.focusedView = false;\n    // Overlook view mode (num of nodes displayed are less than the thld)\n    // Hide edges\n    this.overlookViewThreshold = 500;\n    this.enableOverlookView = true;\n    this.overlookView = false;\n\n    // Legend orientation\n    this.legendOrient = 'top-left';\n\n    /* Attributes */\n\n    this.viewID = view.viewID || null;\n    this.instance = view.instance || null;\n    this.name = view.name;\n\n    this.nodes = new Collection(nodes);\n    this.edges = new Collection(edges);\n\n    /* Appearance */\n    const defaultNodeField = 'index';\n    const defaultEdgeField = 'weight';\n\n    this.nodeColor = {\n      field: defaultNodeField, color: 'nodeDefault',\n      scale: 'linear', domain: [0, 1],\n      range: ['#7fffd4', '#7fffd4'], unknown: '#7fffd4',\n      legend: true\n    };\n    Object.assign(this.nodeColor, view.nodeColor || {});\n\n    this.nodeSize = {\n      field: defaultNodeField, scale: 'linear', domain: [1, 1],\n      range: [40, 40], unknown: 40, legend: false\n    };\n    Object.assign(this.nodeSize, view.nodeSize || {});\n\n    this.nodeLabel = {\n      field: defaultNodeField, size: 20, visible: false\n    };\n    Object.assign(this.nodeLabel, view.nodeLabel || {});\n\n    this.nodeLabelColor = {\n      field: defaultNodeField, color: 'monoblack',\n      scale: 'linear', domain: [1, 1],\n      range: ['#333333', '#333333'], unknown: '#cccccc',\n      legend: false\n    };\n    Object.assign(this.nodeLabelColor, view.nodeLabelColor || {});\n\n    this.edgeColor = {\n      field: defaultEdgeField, color: 'monogray',\n      scale: 'linear', domain: [0, 1],\n      range: ['#999999', '#999999'], unknown: '#cccccc'\n    };\n    Object.assign(this.edgeColor, view.edgeColor || {});\n\n    this.edgeWidth = {\n      field: defaultEdgeField, scale: 'linear', domain: [0.5, 1],\n      range: [10, 10], unknown: 1\n    };\n    Object.assign(this.edgeWidth, view.edgeWidth || {});\n\n    this.edgeLabel = {\n      field: defaultEdgeField, size: 12, visible: false\n    };\n    Object.assign(this.edgeLabel, view.edgeLabel || {});\n\n    this.edgeLabelColor = {\n      field: defaultEdgeField, color: 'monoblack',\n      scale: 'linear', domain: [1, 1],\n      range: ['#333333', '#333333'], unknown: '#cccccc'\n    };\n    Object.assign(this.edgeLabelColor, view.edgeLabelColor || {});\n\n    // Connection threshold\n    this.connThldField = view.connThldField || defaultEdgeField;\n    this.minConnThld = view.minConnThld;\n    this.currentConnThld = view.currentConnThld || view.minConnThld;\n\n    // Force\n    this.coords = view.coords;\n    this.forceActive = !this.coords;\n    this.forceType = view.forceType || 'aggregate';\n\n    // Event listeners\n    this.zoomListener = null;\n    this.dragListener = null;\n\n    // Event notifiers\n    this.updateAllNotifier = null;\n    this.updateComponentNotifier = null;\n    this.updateNodeNotifier = null;\n    this.updateEdgeNotifier = null;\n    this.updateNodeAttrNotifier = null;\n    this.updateEdgeAttrNotifier = null;\n    this.updateLegendNotifier = null;\n    this.updateControlBoxNotifier = () => {};\n    this.updateInteractionNotifier = () => {};\n    this.fitNotifier = () => {};\n    this.setForceNotifier = () => {};\n    this.stickNotifier = () => {};\n    this.relaxNotifier = () => {};\n    this.restartNotifier = () => {};\n    this.tickCallback = () => {};\n\n    // Working copies\n    // D3.force does some destructive operations\n    this.ns = null;\n    this.es = null;\n  }\n\n  updateWorkingCopy() {\n    if (this.ns) {\n      this.coords = this.ns.map(e => ({x: e.x, y: e.y}));\n    }\n    this.ns = JSON.parse(JSON.stringify(this.nodes.records()));\n    this.ns.forEach(n => { n.adjacency = []; });\n    this.es = JSON.parse(JSON.stringify(this.edges.records()));\n    this.es.forEach((e, i) => {\n      e.num = i;  // e.index will be overwritten by d3-force\n      this.ns[e.source].adjacency.push([e.target, i]);\n      this.ns[e.target].adjacency.push([e.source, i]);\n    });\n    if (this.coords) {\n      this.setAllCoords(this.coords);\n    }\n  }\n\n  setBoundary() {\n    const xs = this.ns.map(e => e.x);\n    const ys = this.ns.map(e => e.y);\n    this.boundary.top = Math.min.apply(null, ys);\n    this.boundary.left = Math.min.apply(null, xs);\n    this.boundary.bottom = Math.max.apply(null, ys);\n    this.boundary.right = Math.max.apply(null, xs);\n    // this.showBoundary(); // debug\n  }\n\n  setAllCoords(coordsList) {\n    this.ns.forEach(n => {\n      n.x = coordsList[n.index].x;\n      n.y = coordsList[n.index].y;\n      // this.es can be changed by forceSimulation so use adjacency\n      n.adjacency.forEach(e => {\n        const nbr = e[0];\n        const edge = e[1];\n        if (n.index < nbr) {\n          this.es[edge].sx = coordsList[n.index].x;\n          this.es[edge].sy = coordsList[n.index].y;\n        } else {\n          this.es[edge].tx = coordsList[n.index].x;\n          this.es[edge].ty = coordsList[n.index].y;\n        }\n      });\n    });\n    this.setBoundary();\n  }\n\n  setCoords(n, x, y) {\n    this.ns[n].x = x;\n    this.ns[n].y = y;\n    this.ns[n].adjacency.forEach(e => {\n      const nbr = e[0];\n      const edge = e[1];\n      if (n < nbr) {\n        this.es[edge].sx = x;\n        this.es[edge].sy = y;\n      } else {\n        this.es[edge].tx = x;\n        this.es[edge].ty = y;\n      }\n    });\n    this.setBoundary();\n  }\n\n  nodesToRender() {\n    return this.ns.filter(\n      e => e.y > this.focusArea.top && e.x > this.focusArea.left\n        && e.y < this.focusArea.bottom && e.x < this.focusArea.right\n    );\n  }\n\n  currentEdges() {\n    return this.es.filter(e => e[this.connThldField] >= this.currentConnThld);\n  }\n\n  edgesToRender() {\n    return this.currentEdges().filter(\n      e => this.focusArea.top < Math.max(e.sy, e.ty)\n        && this.focusArea.left < Math.max(e.sx, e.tx)\n        && this.focusArea.bottom > Math.min(e.sy, e.ty)\n        && this.focusArea.right > Math.min(e.sx, e.tx)\n    );\n  }\n\n  save() {\n    this.coords = this.ns.map(n => ({x: n.x, y: n.y}));\n    return idb.updateItem(this.instance, item => {\n      const ni = item.dataset\n        .findIndex(e => e.collectionID === this.nodes.collectionID);\n      item.dataset[ni] = this.nodes.export();\n      const ei = item.dataset\n        .findIndex(e => e.collectionID === this.edges.collectionID);\n      item.dataset[ei] = this.edges.export();\n      const vi = item.views\n        .findIndex(e => e.viewID === this.viewID);\n      item.views[vi] = this.export();\n    });\n  }\n\n  export() {\n    return {\n      $schema: \"https://mojaie.github.io/kiwiii/specs/network_v1.0.json\",\n      viewID: this.viewID,\n      name: this.name,\n      viewType: \"network\",\n      nodes: this.nodes.collectionID,\n      edges: this.edges.collectionID,\n      nodeColor: this.nodeColor,\n      nodeSize: this.nodeSize,\n      nodeLabel: this.nodeLabel,\n      nodeLabelColor: this.nodeLabelColor,\n      edgeColor: this.edgeColor,\n      edgeWidth: this.edgeWidth,\n      edgeLabel: this.edgeLabel,\n      edgeLabelColor: this.edgeLabelColor,\n      connThldField: this.connThldField,\n      currentConnThld: this.currentConnThld,\n      minConnThld: this.minConnThld,\n      fieldTransform: this.transform,\n      coords: this.coords\n    };\n  }\n}\n"],"names":["sortType","fmt","includes","formatNum","value","d3format","undefined","Number","isNaN","parseFloat","d3","format","partialMatch","query","target","toString","toUpperCase","indexOf","uuidv4","replace","c","r","Math","random","statusConv","Queued","In progress","Aborting","Aborted","Completed","Failure","dataTypeConv","datatable","connection","v07_to_v08_nodes","json","fields","columns","map","e","sort","id","name","dataType","schemaVersion","revision","status","records","taskCount","searchCount","doneCount","searchDoneCount","resultCount","recordCount","progress","execTime","created","startDate","responseDate","v10_nodes","reference","convertNetwork","data","edges","hasOwnProperty","nodes","nodeFields","snp","fieldTransform","snapshot","nodePositions","nodeColor","nodeSize","nodeLabel","edge","scale","field","find","key","column","domain","range","unknown","size","text","visible","nodeContent","structure","label","nodeTableId","networkThreshold","v07_to_v08_edges","nodesID","idx_converter","forEach","i","index","_structure","_index","source","v08_graph","nodeContentVisible","schemeCategory20","nodeLabelColor","edgeVisible","edgeWidth","edgeLabel","threshold","coords","params","v10_edges","$schema","convertPackage","specs","now","Date","isNW","v08_nodes","width","height","convertTable","views","dataset","push","collectionID","contents","workflowID","workflow","viewID","viewType","rows","sortOrder","filterText","checkpoints","type","date","description","networkThresholdCutoff","filter","view","minConnThld","currentConnThld","edgeColor","color","edgeLabelColor","connect","version","createObj","Promise","resolve","reject","request","window","indexedDB","open","onsuccess","this","result","onerror","event","onupgradeneeded","currentTarget","instance","pkgs","db","createObjectStore","keyPath","assets","clear","dbid","then","req","transaction","objectStore","getAllItems","res","openCursor","cursor","continue","getItem","get","putItem","put","updateItem","updater","obj","upd","clearAll","all","deleteItem","delete","getView","pkg","appendView","viewObj","item","pos","findIndex","splice","updateView","_","isFunction","deleteView","bin","Object","entries","entry","getAllCollections","items","flatten","coll","getCollection","collID","addCollection","collObj","updateCollection","importItem","legacy","misc","slice","sessionStarted","newDatagrid","response","toLocaleString","timeZone","addDatagrid","add384Tiles","rowCount","columnCount","chunksPerRow","newNetwork","nodesName","edgesID","getAsset","putAsset","content","baseURL","url","q","keys","length","JSON","stringify","fetch","credentials","Error","statusText","blob","post","formdata","method","body","error","err","console","serverStatus","server","schema","batchRequest","reqs","interval","ress","setTimeout","singleToMulti","mapping","newMapping","m","mappingToTable","mp","concat","rcd","f","tableToMapping","table","ignore","row","csvToMapping","csvString","lines","split","header","shift","headerIdx","h","line","values","k","Array","apply","fd","uniqBy","Collection","[object Object]","autoIndex","addField","fs","mapper","func","command","fetcher","idb","sum","some","min","TransformState","transform","fieldWidth","fieldHeight","viewBox","top","right","bottom","left","focusArea","focusAreaMargin","boundary","x","y","prevTransform","resizeNotifier","tx","ty","tk","margin","setFocusArea","vh","vw","vr","bh","bw","isPortrait","adjustH","adjustV","setTransform","select","colorScales","colors","schemePaired","schemeSet2","schemePastel2","schemeSet3","types","scaleLinear","scaleLog","scaleQuantize","scaleOrdinal","scaleFunction","state","cscale","mid","scaleFunc","clamp","d","isD3Format","notation","assetBaseURL","iconBaseURL","badge","selection","classed","append","style","updateBadge","icon","attr","notify","transition","duration","ease","easeLinear","delay","on","loadingCircle","alert","updateAlert","invalidFeedback","updateInvalidMessage","msg","formValue","property","formValid","node","checkValidity","setValidity","valid","textareaValid","test","fileInputBox","accept","fileInputValid","call","updateFormValue","textBox","readonlyBox","updateReadonlyValue","readonlyValue","textareaBox","placeholder","textareaBoxLines","numberBox","updateNumberRange","max","step","dispatch","bubbles","checkBox","box","updateCheckBox","checked","checkBoxValue","colorBox","stopPropagation","clearFileInput","selectAll","remove","fileInputValue","monocolorBar","group","colorBar","monocolor","bicolor","grad","tricolor","categorical","sw","custom","setSize","checklistValues","anyChecked","setChecklistValidity","setSelectedColorScale","selected","datum","shape","selectBox","updateSelectBoxOptions","options","exit","enter","selectedRecord","checklistBox","updateChecklistItems","listitems","form","checkRequired","updateChecklistValues","each","colorScaleBox","dropdown","colorScaleBoxItems","updateColorScaleBox","colorScaleBoxValue","colorScaleBoxItem","linearValid","stepm","validity","stepMismatch","linearRangeValid","minValid","maxValid","logValid","logRangeValid","minPos","maxPos","rangeBox","minBox","maxBox","linearRange","logRange","updateRangeValues","rangeValues","colorRangeBox","midBox","updateColorRangeValues","colorRangeValues","dropdownFormGroup","colorRangeGroup","lbox","collapse","rbox","updateColorRangeGroup","customRange","cs","rg","customScale","rtype","rboxValues","colorGroupValues","colorScale","colorScaleType","scaleBoxGroup","isLog","updateScaleBoxGroup","scaleGroupValues","scaleBoxGroupValid","dm","colorControlBox","fieldName","noScale","updateColorControl","fieldOptions","colorState","legend","colorControlValid","colorControlState","sizeControlBox","updateSizeControl","sizeState","sizeControlValid","rangeValid","unkValid","scaleValid","sizeControlState","labelControlBox","labelGroup","updateLabelControl","labelState","labelControlValid","labelControlState","labelColor","controlBoxFrame","navID","contentID","controlBoxNav","controlBoxItem","buttonBox","menuButton","menuButtonLink","menuModalLink","dropdownMenuButton","button","dropdownMenuItem","dropdownMenuModal","dropdownMenuFile","click","dropdownMenuFileValue","files","colorBarLegend","domains","updateColorBarLegend","updateLegendGroup","orient","scaleF","o","viewW","viewH","legW","legH","posX","posY","resize","area","offsetWidth","offsetHeight","setViewBox","viewFrame","explorativeNetwork","baseFactor","expnet","elevations","n","adjacency","weight","pathWeights","mn","bf","svgWidth","svgHeight","updateNodes","showStruct","entered","updateNodeCoords","merged","merge","html","updateEdges","updateEdgeCoords","updateNodeAttrs","colorConv","sizeConv","labelColorConv","htwidth","fo","focusedView","d3_format","textConv","updateEdgeAttrs","widthConv","sx","sy","updateAttrs","updateComponents","nodesToRender","numNodes","enableFocusedView","focusedViewThreshold","enableOverlookView","overlookView","overlookViewThreshold","edgesToRender","moveNode","moveEdge","move","num","networkView","legendGroup","updateAllNotifier","updateWorkingCopy","expn","ns","es","elevmap","joinFields","pathmap","pweight","updateControlBoxNotifier","setForceNotifier","updateComponentNotifier","updateLegendNotifier","setAllCoords","updateInteractionNotifier","updateNodeNotifier","updateEdgeNotifier","updateNodeAttrNotifier","updateEdgeAttrNotifier","legendOrient","dragListener","drag","component","setCoords","zoomListener","zoom","t","p","xMoved","yMoved","zoomIn","selectListener","sel","preventDefault","isSel","resume","tf","zoomIdentity","translate","nodesSelected","nodesNotSelected","partition","edgesSelected","edgesNotSelected","setInteraction","selectedObj","shiftKey","document","addEventListener","rect","origin","initSel","abs","xConv","yConv","parentNode","adj","rectSelectListener","multiSelectListener","dx","dy","newX","newY","multiDragListener","fitNotifier","fitTransform","forceType","force","forceSimulation","forceLink","distance","strength","forceManyBody","distanceMin","distanceMax","forceCollide","radius","forceX","forceY","forceCenter","stop","stick","simulation","alpha","fx","fy","interaction","forceActive","unstick","active","relaxNotifier","alphaTarget","forceDragListener","activate","links","currentEdges","tickCallback","restartNotifier","stickNotifier","restart","mainControlBox","viewModes","thldGroup","forceBox","updateMainControl","thldFields","connThldField","thld","numEdges","combinations","logD","log10","isStopped","alphaMin","parseInt","updateNodeColorControl","cbox","uniq","updateEdgeColorControl","updateNodeSizeControl","updateEdgeWidthControl","updateNodeLabelControl","updateEdgeLabelControl","updateControlBox","NetworkState","super","assign","parse","xs","ys","coordsList","nbr","setBoundary","ni","export","ei","vi","control","controlBox","tabs"],"mappings":"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"}